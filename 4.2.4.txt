>---start---.api.js======var kid,scrolltop=0,sign='23474',zyapi={urls:['http://cj.bajiecaiji.com/inc/feifei3bjm3u8/index.php','http://www.kuaibocaiji.com/api.php/provide/vod/from/kbm3u8/at/xml/','apiManager'],name:['BJ资源','KB资源','-- 资源API地址管理 --']},downloadApi={'OK资源':"http://cj.okzy.tv/inc/apidown.php",'ZD资源':"http://www.zdziyuan.com/inc/apidown.php"},apiSelected=zyapi.urls[0];apiready=function(){api.sendEvent({name:'frameOnload',extra:{name:api.frameName}});local2dataBase();initApi();Smovie();doubanRequest();};function doubanRequest(){$('#movie').html('数据载入中…');if(api.getGlobalData({key:'TcMovie'})){TcMovie(1);return;}api.ajax({url:'http://front-gateway.mtime.com/ticket/schedule/showing/movies.api?locationId=290',method:'get',tag:'TcMovie',timeout:15,dataType:'json'},function(ret,err){if(ret){TcMovie(ret);}else{$('#movie').html('<span style="color:#fff;padding:10px;" onclick="doubanRequest();">点击重新获取</span>');}});}(function (doc, win) {var docEl = doc.documentElement,resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',recalc = function () {var clientWidth = docEl.clientWidth;if (!clientWidth) return;if(clientWidth>=640){docEl.style.fontSize = '177px';}else{docEl.style.fontSize = 177.78*(clientWidth / 640) + 'px';}};if (!doc.addEventListener) return;win.addEventListener(resizeEvt, recalc, false);doc.addEventListener('DOMContentLoaded', recalc, false);})(document, window);function html(){var ar=['<div id="ifr" style="position:relative;background-color:#0a1a2a;overflow:hidden;padding:10px 0;"><div id="ptitle" style="display:none;"><div class="top-box"><a class="to-xuanji">选集</a><span class="title"></span><a id="download" data-url="">下载/播放</a></div></div><div id="movie" style="line-height:0.2rem;width:100%;font-size:0.12rem;color:#00FF7F;text-align:center;"></div></div><div id="ads" style="clear:both;padding:2px 0;position:relative;"></div>','<div class="search-box"><a id="tp" class="search-line"></a><input id="s_word" class="search-input" placeholder="输入关键词搜索" onkeydown="FSubmit(event.keyCode||event.which);"/><a onclick="tp()" class="search-btn">搜索</a></div><input id="pd" style="display:none;" value=""/><input id="purl" style="display:none;" value=""/><div id="fenlei" style="overflow:hidden;padding:0.05rem;font-size:0.12rem;"></div><div id="ss" style="clear:left;"></div><span id="pl"></span><p style="padding:50px 0;clear:both;font-size:0.12rem;text-align:center;color:#aaa;">资源采集于网络.微信公众号:kongbuyy</p><textarea id="data" style="display:none;">{}</textarea><div id="api_gl" style="width:100%;height:100%;position:fixed;top:0;left:0;display:none;z-index:10001;"><div style="width:100%;height:100%;position:fixed;top:0;left:0;display:-webkit-flex;display:flex;align-items:center;justify-content:center;"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1;" onclick="api_gl_close()"></div><div id="zidingyi" style="position:relative;overflow-y:auto;max-height:100%;width:100%;background-color:yellow;border:0;z-index:9999999999;padding:0.1rem 0;"><div style="position:relative;padding:0.1rem 0 0.2rem;font-size:0.14rem;text-align:center;">影视资源API管理</div><div style="position:relative;"><div style="display:block;margin-right:0.6rem;"><input id="line_url" style="box-sizing:border-box;height:0.4rem;font-size:0.14rem;width:100%;border:0;padding:0.05rem;" type="text" placeholder="长按粘贴API地址"/></div><div style="position:absolute;right:0;top:0;width:0.6rem;"><a href="javascript:line_add();" style="display:block;width:0.6rem;height:0.4rem;line-height:0.4rem;font-size:0.14rem;text-align:center; background:green;color:#fff;">添加</a></div></div><div id="url_list"></div><p style="font-size:0.12rem;padding:0 2px;color:gray;line-height:0.2rem;text-align:center;">获取更多API，请关注微信公众号kongbuyy</p><span class="closebtn" style="position:absolute;top:0;right:0;color:#555;font-size:0.22rem;padding:0.1rem;" onclick="api_gl_close()">&times</span></div></div></div>'];$('body').prepend(ar[0]);$('body').append(ar[1]);}function isToday(str){var d = new Date(str.replace(/-/g,"/"));var t = new Date();return d.setHours(0,0,0,0) == t.setHours(0,0,0,0);}function isBottom(){if($(this).scrollTop()+$(this).height()==$(document).height()){return true;}return false;}function toggleBody(isPin){if(isPin){scrolltop=document.body.scrollTop;$('#fenlei').hide();$('#ss').hide();return;}$('#fenlei').show();$('#ss').show();document.body.scrollTop=scrolltop;}function api_gl_show(){toggleBody(1);$('#api_gl').show();$('#url_list').css("max-height",api.winHeight/2+"px");$(this).scrollTop()==0&&window.scrollBy(0,1);isBottom()&&window.scrollBy(0,-1);}function api_gl_close(){toggleBody(0);$("#api_gl").hide();api.hideProgress();api.cancelAjax({tag:'apiAdd'});}function s_reset(){$("#pifr").remove();$("#ptitle").hide();api.cancelAjax({tag:'search'});}function FSubmit(e){if(e==13){document.getElementById('s_word').blur();tp();}}function setCurrentLine(curApi){$('#tp').attr("data-line",curApi).text(zyapi.name[zyapi.urls.indexOf(curApi)]);}function tp(){var api=$('#tp').attr("data-line");apiSelected=api;$('#pd').val(0);search(1);$("#fenlei a").css({"background-color":"#ddd","color":"#333"}).first().css({"background-color":"#000","color":"#eee"});}function search(p){var word=$('#s_word').val(),type=apiDecode($('#tp').attr("data-line")),pd=$('#pd').val();s_reset();api.showProgress({title: '搜索中...',text:'',modal: false});$('#ss').html('<p style="clear:both;color:#000;background-color:#eee;font-size:0.14rem;text-align:center;padding:0.1rem 0;">数据加载中…</p>');var bodyTop=document.body.scrollTop,url=type+'?ac=list&ids=&wd='+word+'&t='+pd+'&h=&pg='+p+'&cid='+pd+'&p='+p;api.ajax({url:url,method:'get',dataType:'text',tag:'search',timeout:10},function(ret,err){if(!ret||err){api.hideProgress();$('#ss').html('<p style="text-align:center;clear:left;color:#f00;padding:5px 0;">'+(err.code==0?'连接错误':err.msg)+'</p>'+(p>1?'<div id="pg" style="text-align:center;"><span onclick="search('+p+')" style="background-color:#000;color:white;width:0.5rem;height:0.35rem;line-height:0.35rem;text-align:center;margin:0.02rem;display:inline-block;">点击重试</span></div>':''));return;}if(ret.indexOf('{"')==0){api.hideProgress();ret=JSON.parse(ret);if(ret.page.recordcount==0){splitWords(word);return;}jsonData(ret);}else{if(ret.indexOf('<video>')==-1){api.hideProgress();splitWords(word);return;}getIdsAndXmlData(ret);}document.body.scrollTop=bodyTop;});}function splitWords(word){api.toast({msg:"暂无相关视频"});var noVideoTips='<p style="text-align:center;clear:left;padding:5px 0;">暂无<span style="color:#f00;">'+word+'</span>相关视频！</p>';var mt=word.match(/[\u4E00-\u9FFF\d\w]+/g);if(mt&&mt.length>1){for(var m,i=0,str='';m=mt[i];i++){str+='<a href="javascript:;" onclick="$(\'#s_word\').val(\''+m+'\');$(\'#tp\').val(apiSelected);tp();" style="padding:5px;margin:5px;">'+m+'</a>';}noVideoTips+='<p style="text-align:center;padding:5px 0;font-size:16px;">试试搜索：'+str+'</p>';}$('#ss').html(noVideoTips);}function getBasicWidth(str){str=str+'';var len=str.length;var slen=str.replace(/[\s\d\w]+/g,'').length;len=slen+parseInt((len-slen)/2);var w=api.winWidth,cw=len<3?68:(len+1)*12+20;cw=w/parseInt(w/cw)-2;return cw;}function jsonData(ret){var key=$('#tp').text(),xuanji=key in downloadApi ? '<span class="m3u8-type">m3u8格式</span><span class="mp4-type">mp4格式</span>' : '<span class="m3u8-type">选集</span>';var ss=[],ar=ret.data,apikey=apiDecode($('#tp').attr("data-line")).replace(/[^\w]*/g,''),pstr=localStorage.getItem('api_play')||'[]';var cw=46;for(var i=0,m;m=ar[i];i++){var urls=m.vod_url,curkey=apikey+m.vod_id;if(urls.indexOf('$$$')!==-1){var ar1=urls.split('$$$');if(urls.indexOf('.m3u8')!==-1){for(var j=0,n;n=ar1[j];j++){if(n.indexOf('.m3u8')!==-1){urls=n;break;}}}else{urls=ar1[0];}}var ar1=urls.split('\r\n');for(var e='',k=0,v;v=ar1[k];k++){var ar2=v.split('$');if(k==0){cw=getBasicWidth(ar2[0]);}e+='<a data-url="'+ar2[1]+'" style="width:'+cw+'px;">'+ar2[0]+'</a> ';}var playName='';if(pstr.indexOf(curkey)!=-1){var re =new RegExp(curkey+'":"([^"]*)"');var url=pstr.match(re)[1];e=e.replace(new RegExp('(data-url="'+url+'"\\s+style="[^"]+)'),'$1color:#f00;');playName=e.match(new RegExp('data-url="'+url+'"[^>]+>(.*?)<'))[1]||"";}ss.push('<div class="main-box" data-id="'+m.vod_id+'"><div class="content-box"><div class="img-box">'+imgHtml(m.vod_pic)+'<span>'+m.vod_continu+'</span></div><div class="title-box"><span class="atitle">'+m.vod_name+'</span><date>'+(m.vod_year*1||'')+'</date><channel>'+m.list_name+'</channel><actor>'+m.vod_actor+'</actor><div class="xuanji" style="color:#f00;">'+xuanji+playName+'</div></div></div><div class="urls-box"><div class="m3u8-data" style="display:none;">'+e+'</div><div class="mp4-data" style="display:none;"></div></div></div>');}var pg=ret.page;$('#ss').html(ss.join('')+pageHtml(pg.pageindex*1,pg.pagecount*1));$('#fenlei').html()==''&&getType(ret.list);}function getMp4(El){El.parent().find('.m3u8-type').css("color","gray");var mainEl=El.closest(".main-box"),mEl=mainEl.find('.mp4-data');if(mEl.is(':hidden')){El.css("color","green");}else{El.css("color","gray");}mainEl.find('.m3u8-data').hide();if(mEl.find('a').length>0){mEl.slideToggle(500);return;}api.showProgress({title: '载入中...',text:'',modal: false});var key=$('#tp').text(),url=downloadApi[key]+'?ac=videolist&ids='+mainEl.attr("data-id");api.ajax({url:url,method:'get',dataType:'text',timeout:10},function(ret,err){api.hideProgress();if(!ret || err){api.toast({msg:err.msg});return;}if(ret.indexOf('<video>')==-1){api.toast({msg:'暂无mp4格式'});return;}var m=ret.match(/\<dd flag="([^"]*)"\>\<\!\[CDATA\[(.*?)\]\]\>/);var s=(m[2]+'#').replace(new RegExp('\\$'+m[1],"gm"),'').replace(/(.*?)\$(.*?)\#/g,'<a class="pg" data-url="$2">$1</a> ');var curkey=apiDecode($('#tp').attr("data-line")).replace(/[^\w]*/g,'')+mainEl.attr("data-id"),pstr=localStorage.getItem('api_play')||'[]';if(pstr.indexOf(curkey)!=-1){var re =new RegExp(curkey+'":"([^"]*)"');var url=pstr.match(re)[1];s=s.replace(new RegExp('(data-url="'+url+'"\\s+style="[^"]+)'),'$1color:#f00;');}mEl.html(s).slideToggle(500);});}function noImg(event){var img=event.srcElement ? event.srcElement : event.target;img.οnerror=null;var  url=img.src;img.src=url.replace(/^https?:/,function(a){return a=='http:'&&'https:'||'http:';});}/*jsonData end*/function getIdsAndXmlData(data){var ids=data.match(/\d+(?=<\/id>)/g).join(',');var url=apiDecode($('#tp').attr("data-line"))+'?ac=videolist&ids='+ids+'&wd=&t=&h=&pg=1&cid=&p=1';api.ajax({url:url,method:'get',dataType:'text',tag:'search',timeout:10},function(ret,err){api.hideProgress();if(!ret||ret.indexOf('<video>')==-1||err){xmlData(data);return;}$('#fenlei').html()==''&&getType(data);xmlData(ret);var pg=data.match(/page="(\d+)" pagecount="(\d+)"/);$('#ss').append(pageHtml(pg[1]*1,pg[2]*1));});}function xmlData(ret){var arr=ret.match(/<video>[\s\S]*?<\/video>/g),isPic=/<dd flag="[^"]*">/.test(ret)&&'pic'||'noPic',mt={pic:{pat:/<video><last>([\s\S]*?)<\/last><id>([\s\S]*?)<\/id><tid>([\s\S]*?)<\/tid><name><\!\[CDATA\[([\s\S]*?)\]\]><\/name><type>([\s\S]*?)<\/type><pic>([\s\S]*?)<\/pic>[\s\S]*?<area>([\s\S]*?)<\/area><year>([\s\S]*?)<\/year>[\s\S]*?<note><\!\[CDATA\[([\s\S]*?)\]\]><\/note><actor><\!\[CDATA\[([\s\S]*?)\]\]><\/actor>[\s\S]*?<dl>([\s\S]*?)<\/dl>[\s\S]*?<\/video>/,fn:function(ar){return xmlHtmlWithPic(ar);}},noPic:{pat:/<video><last>(.*?)<\/last><id>(.*?)<\/id><tid>(.*?)<\/tid><name><\!\[CDATA\[([\s\S]*?)\]\]><\/name><type>(.*?)<\/type><dt>(.*?)<\/dt><note><\!\[CDATA\[([\s\S]*?)\]\]><\/note>[\s\S]*?<\/video>/,fn:function(ar){return xmlHtml(ar);}}};for(var i=0,m,ss=[];m=arr[i];i++){try{var ar=m.match(mt[isPic].pat);ss.push(mt[isPic].fn(ar));}catch(e){}}var pg=ret.match(/page="(\d+)" pagecount="(\d+)"/);$('#ss').html(ss.join('')+pageHtml(pg[1]*1,pg[2]*1));$('#fenlei').html()==''&&getType(ret);}function xmlHtml(ar){return '<div class="main-box" data-id="'+ar[2]+'" data-time="'+ar[1]+'"><div class="title-box" style="-webkit-flex:none;flex:none;color:gray;font-size:0.12rem;"><span class="atitle">'+ar[4]+'</span>'+(ar[5]&&'<span style="padding:0 3px;">'+ar[5]+'</span>'||'')+(ar[7]&&'<span style="padding:0 3px;">'+ar[7]+'</span>'||'')+(ar[1]&&'<span style="padding:0 3px;color:'+(isToday(ar[1])&&'red'||'gray')+';">'+ar[1].replace(/\d+[/-](\d+)[/-](\d+).*/,'$1.$2')+'</span>'||'')+'</div><div class="urls-box"></div></div>';}function xmlHtmlWithPic(ar){var urls=ar[11].match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?\.m3u8[^\]]*?)\]\]><\/dd>/)||ar[11].match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?)\]\]><\/dd>/);if(!urls){return;}var s=urlHtml(urls[1]),curkey=apiDecode($('#tp').attr("data-line")).replace(/[^\w]*/g,'')+ar[2],pstr=localStorage.getItem('api_play')||'[]',playName='';if(pstr.indexOf(curkey)!=-1){var re =new RegExp(curkey+'":"([^"]*)"');var url=pstr.match(re)[1];s=s.replace(new RegExp('(data-url="'+url+'"\\s+style=")([^"]+)'),'$1$2color:#f00;');playName=s.match(new RegExp('data-url="'+url+'"[^>]+>(.*?)<'))[1]||"";}return '<div class="main-box" data-id="'+ar[2]+'"><div class="content-box"><div class="img-box">'+imgHtml(ar[6])+'<span>'+ar[9]+'</span></div><div class="title-box"><span class="atitle">'+ar[4]+'</span><date>'+(ar[8]!=0&&ar[8].substr(0,4)||'')+'</date><channel>'+ar[5]+'</channel><actor>'+ar[10]+'</actor><div class="xuanji" style="color:#f00;"><span class="m3u8-type">选集</span>'+playName+'</div></div></div><div class="urls-box"><div class="m3u8-data" style="display:none;">'+s+'</div><div class="mp4-data" style="display:none;"></div></div></div>';}/*xmlData end*/function imgHtml(url){return '<img onerror="noImg(event)" src="'+url+'" />';}function getType(ret){if(typeof(ret)=='string'){var type=ret.match(/<class>([\s\S]*?)<\/class>/);if(type==null){var apiUrl=apiDecode($('#tp').attr("data-line")),url=apiUrl+'?ac=list&ids=&wd=888888&t=&h=&pg=1';api.ajax({url:url,method:'get',dataType:'text',timeout:10},function(ret,err){if(!ret||err){api.toast({msg:'未能获取分类，请重试'});return;}getType(ret);});return;}type=type[1].replace(/<ty id="\d*">(电影|电视|剧集|连续剧|小说|图片).*?<\/ty>/g,'');type=('<ty id="0">全部</ty>'+type).replace(/<ty id="(\d*)">(.*?)<\/ty>/g,'<a tid="$1">$2</a>');$('#fenlei').html(type);}else{var e='';ret.unshift({list_id:0,list_name:'全部'});for(var i=0,m;m=ret[i];i++){if(/电影|电视|剧集|连续剧|小说|图片/.test(m.list_name)){continue;}e+='<a tid="'+m.list_id+'">'+m.list_name+'</a>';}$('#fenlei').html(e);}$('#fenlei a').first().css({"background-color":"#000","color":"#eee"});}function clickListener(){$("#fenlei").on("click","a",function(){$("#fenlei a").css({"background-color":"#ddd","color":"#333"});$(this).css({"background-color":"#000","color":"#eee"});pd_($(this).attr("tid"));});$("#ss").on("click",".m3u8-type",function(){$(this).parent().find('.mp4-type').css("color","gray");var mainEl=$(this).closest(".main-box");if(mainEl.find('.m3u8-data').is(':hidden')){$(this).css("color","green");}else{$(this).css("color","gray");}mainEl.find('.mp4-data').hide();mainEl.find('.m3u8-data').slideToggle(500);return false;});$("#ss").on("click",".mp4-type",function(){getMp4($(this));return false;});$("#ss").on("click",".mp4-data a , .m3u8-data a,.data a",function(){var mainEl=$(this).closest(".main-box");kid=apiDecode($('#tp').attr("data-line")).replace(/[^\w]*/g,'')+mainEl.attr("data-id");$("#ss a[name=playing]").css({"background-color":"#ddd","color":"#333"}).removeAttr("name");$(this).css({"background-color":"#000","color":"#eee"}).attr("name","playing");var url=$(this).attr("data-url"),name=mainEl.find('.atitle').text(),title=name+' <span style="color:#f00;">'+$(this).text()+'</span>';$('#purl').val(url);$("#ptitle").show();$("#download").attr("data-url",url);$("#ptitle .title").html(title);if(/\d+/.test($(this).text())&&$(this).parent().find('a').length>1){local_(url);}play();return false;});$("#ss").on("click",".main-box",function(){var thisEl=$(this);if(thisEl.find('.xuanji').length>0){return false;}var id=thisEl.attr("data-id"),time=thisEl.attr("data-time");thisEl.find('.atitle').css({"color":"#f00"});if(thisEl.find('.m3u8-data').length==0){s_reset();api.showProgress({title:'数据载入中...',text:'',modal: false});var apiUrl=apiDecode($('#tp').attr("data-line")),url=apiUrl+'?ac=videolist&ids='+id+'&wd=&t=&h=&pg=1';api.ajax({url:url,method:'get',dataType:'text',timeout:10},function(ret,err){api.hideProgress();if(!ret||err){api.toast({msg:err.msg});return;}var urls=ret.match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?\.m3u8[^\]]*?)\]\]><\/dd>/)||ret.match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?)\]\]><\/dd>/);if(!urls){api.toast({msg:'暂无数据'});return;}var data=ret.match(/<tid>([\s\S]*?)<\/tid><name><\!\[CDATA\[([\s\S]*?)\]\]><\/name><type>([\s\S]*?)<\/type><pic>([\s\S]*?)<\/pic>[\s\S]*?<area>([\s\S]*?)<\/area><year>([\s\S]*?)<\/year>[\s\S]*?<actor><\!\[CDATA\[([\s\S]*?)\]\]><\/actor>/);if(thisEl.find('.m3u8-data').length==0){kid=apiUrl.replace(/[^\w]*/g,'')+id;var s=urlHtml(urls[1]),pstr=localStorage.getItem('api_play')||'[]';if(pstr.indexOf(kid)!=-1){var re =new RegExp(kid+'":"([^"]*)"');var url=pstr.match(re)[1];s=s.replace(new RegExp('(data-url="'+url+'"\\s+style="[^"]+)'),'$1color:#f00;');}thisEl.find('.urls-box').append('<div class="m3u8-data" data-title="'+data[2]+'" data-pic="'+data[4]+'" data-year="'+data[6]+'" data-actors="'+data[7]+'" data-area="'+data[5]+'">'+s+'</div>');}});}else{thisEl.find('.urls-box').slideToggle();}return false;});$('#tp').on("click",function(){var el=$(this),i=zyapi.urls.indexOf(el.attr("data-line")),names=zyapi.name.slice();names.splice(i,1,'*  '+zyapi.name[i]);api.actionSheet({title:'资源API地址',cancelTitle: '取消',buttons:names},function(ret,err){var index=ret.buttonIndex-1;if(index<zyapi.name.length){var url=zyapi.urls[index];if(url==el.attr("data-line")){return;}if(url=='apiManager'){api_gl_show();return;}el.text(zyapi.name[index]).attr("data-line",zyapi.urls[index]);$('#fenlei').empty();tp();}});return false;});$('#movie').on("click","a",function(){$('#s_word').val($(this).text());$('#tp').val(apiSelected);tp();return false;});$('#download').on("click",function(){var url=$(this).attr("data-url"),title=$('#ptitle .title').text(),type=url.indexOf('.m3u8')!==-1?'m3u8':'mp4';api.actionSheet({title:title,cancelTitle: '取消',buttons: ["下载","播放","复制链接","用浏览器打开"]}, function(ret, err){var index=ret.buttonIndex;switch (index){case 1:startDownload(url,title,type);break;case 2:startPlay(url);break;case 3:copyText(url,true);break;case 4:openBrowser(url);break;default:break;}});return false;});$("#url_list").on("click","a",function(){var url=$(this).parent().attr("data-url");$('#line_url').val(url.replace('?xml=',''));}).on("click",".delete-btn",function(){var el=$(this).parent();var url=el.attr("data-url"),name=el.find('a').text(),a=$('#tp').attr("data-line");if (confirm("确定删除API："+name+" ？")==false){return false;}if(a==url){apiSelected=zyapi.urls[0];$('#tp').attr("data-line",zyapi.urls[0]).text(zyapi.name[0]);$('#ss').empty();$('#fenlei').empty();}executeSqlSync('delete from apiInfo where url = "'+url+'"');updateList(getApiInfo('SELECT * FROM apiInfo'));var i=zyapi.urls.indexOf(url);zyapi.urls.splice(i,1);zyapi.name.splice(i,1);});$("#ptitle").on("click",".to-xuanji",function(){$('#ss a[name=playing]').parent().show();document.getElementsByName('playing')[0].scrollIntoView();window.scrollBy(0,api.winHeight/-2);});window.onscroll=function(){var t=document.documentElement.scrollTop||document.body.scrollTop;$('#ptitle').css({"top":(t>10&&"0rem"||"-1rem")});};}function pageHtml(p,total){if(total==1){return '';}for(var j=1,e=[],k=total+1;j<k;j++){e.push('<option value="'+j+'">第 '+j+' 页</option>');}return '<div id="pg" style="-webkit-display:flex;-webkit-justify-content:center;-webkit-align-items:center;display:flex;justify-content:center;align-items:center;height:0.4rem;"><span'+(p==1?'':' onclick="search('+(p-1)+')"')+' style="background-color:gray;color:'+(p==1?'#999':'#fff')+';width:0.5rem;height:0.4rem;line-height:0.4rem;text-align:center;margin:0.02rem;display:inline-block;">上一页</span><select style="width:auto;height:0.4rem;font-size:0.12rem;color:#000;border:1px solid gray;" onchange="search(this.value)">'+e.join('').replace('value="'+p+'"','value="'+p+'" selected')+'</select><span'+(p<total?' onclick="search('+(p+1)+')"':'')+' style="background-color:gray;color:'+(p<total?'#fff':'#999')+';width:0.5rem;height:0.4rem;line-height:0.4rem;text-align:center;margin:0.02rem;display:inline-block;">下一页</span></div>';}function urlHtml(urls){var cw=46,urlHtml=[];if(urls.indexOf('#')!==-1){var ar=urls.split('#');for(var i=0,m;m=ar[i];i++){var arr=[];if(m.indexOf('$')!==-1){arr=m.split('$');(m.indexOf('http')==0)&&(arr=[i+1,arr[0]]);}else{arr=[i+1,m];}if(i==0){cw=getBasicWidth(arr[0]);}urlHtml.push('<a data-url="'+arr[1]+'" style="width:'+cw+'px;">'+arr[0]+'</a>');}}else{var arr=[];if(urls.indexOf('$')!==-1){arr=urls.split('$');(urls.indexOf('http')==0)&&(arr=['高清',arr[0]]);}else{arr=['高清',urls];}cw=getBasicWidth(arr[0]);urlHtml.push('<a data-url="'+arr[1]+'" style="width:'+cw+'px;">'+arr[0]+'</a>');}return urlHtml.join('');}function pd_(ty){$('#pd').val(ty);$('#s_word').val('');search(1);}$(document).ready(function(){html();clickListener();});function TcMovie(json){if(json==1){var str=api.getGlobalData({key:'TcMovie'});sessionStorage.getItem('TcMovie');}else{var str=JSON.stringify(json);str=(str.match(/"t":\s?"[^"]*"/g)||[]).slice(0,18).join('').replace(/"t":\s?"([^"]*)"/g,'<a href="javascript:;">$1</a>');api.setGlobalData({key:'TcMovie',value:str});}$('#movie').html('影院热映：'+str);}function Smovie(){var movie=sessionStorage.getItem('Movie');if(movie){var m=movie.split('$');$('#s_word').val(m[1]);$('#tp').val(apiSelected);sessionStorage.removeItem('Movie');tp();}}/*****play****/function downloadShow(url){$("#download").attr("data-url",url);}function play(){api.showProgress({title: '解析中...',text:'',modal: false});var vp=$("#purl").val();if(/^https?:/.test(vp)==false){getPlayUrl(vp);return;}if(/\.m3u8/.test(vp)==false){vp=encodeURI(vp);}api.hideProgress();downloadShow(vp);startPlay(vp);}function getPlayUrl(vid){api.ajax({url:'https://api.leduotv.com/wp-api/getvodurl.php?vid='+vid,method:'get',dataType:'text',timeout:5},function(ret,err){api.hideProgress();if(err){api.toast({msg:err.msg});return;}var data=JSON.parse(ret);if(data.hasOwnProperty('url')&&data.url){var url=data.url;downloadShow(url);startPlay(url);}else{api.toast({msg:'解析出错'});}});}function img_(url,w,h1){var imgid=Math.random(),frameid ='frameimg' + imgid;window['img'+imgid] = '<iframe src=\''+url+'\' style="display:none;width:100%;height:100%;" onload="document.getElementsByTagName(\'img\')[0].src=\''+url+'\';"></iframe><img src="" style="width:100%;height:100%;" onload="document.getElementsByTagName(\'iframe\')[0].src=\''+url+'\';">';return '<iframe id="'+frameid+'" src="javascript:parent[\'img'+imgid+'\'];" frameborder="0" scrolling="no" border="0" marginwidth="0" marginheight="0" style="width:'+w+';height:'+h1+';margin-bottom:-5px;"></iframe>';}function local_(vp){var json={},str=localStorage.getItem('api_play');json[kid]=vp;var arr=JSON.parse(str||'[]');var i=arr.indexOf(json);i!=-1&&arr.splice(i,1);arr.unshift(json);arr.length>20&&(arr.length=20);localStorage.setItem('api_play',JSON.stringify(arr));}function toview(id){document.getElementById(id).scrollIntoView();window.scrollBy(0, -100);}function jsurl(puri){var script = document.createElement('script');script.setAttribute("type","text/javascript");script.setAttribute('src', puri);document.getElementsByTagName('body')[0].appendChild(script);}function isAndroid(){var u = navigator.userAgent;return u.indexOf('Android') > -1 || u.indexOf('Adr') > -1;}var storage={"set":function (key,value){var data=JSON.parse($('#data').val());data[key]=value;$('#data').val(JSON.stringify(data));},"get":function (key){var data=JSON.parse($('#data').val());return (key in data?data[key]:false);}};/** API **/function getHostNameByUrl(url){return url.split('\/')[2].split('.').slice(-2)[0];}function local2dataBase(){try{var str=localStorage.getItem('api'),ar=JSON.parse(str);if(str&&ar.length>0){for(var i=0,m;m=ar[i];i++){executeSqlSync('INSERT INTO apiInfo (url,name) VALUES ("'+m+'","'+getHostNameByUrl(apiDecode(m))+'")');}localStorage.removeItem('api');}}catch(e){}}function executeSqlSync(sql){var db = api.require('db');var ret = db.executeSqlSync({ name: 'downloader', sql: sql});ret.status==false&&api.toast({msg:ret.msg});}function executeSql(sql){var db = api.require('db');db.executeSql({name: 'downloader', sql: sql}, function(ret, err){if(ret.status==false){api.toast({msg:err.msg});}});}function getApiInfo(sql){var db = api.require('db');var ret = db.selectSqlSync({ name: 'downloader', sql: sql});return ret.data;}function apiDecode(str){str=/^\\x/.test(str)?eval('"'+str+'"'):unescape(str);str=str.replace(/\?.*$/,'').replace(/(provide\/vod).*$/i,'$1/at/xml/');return str;}function line_add(){var urlStr=$('#line_url').val();var apiUrl=apiDecode(urlStr);if(/^https?:.+/.test(apiUrl)==false){alert('接口格式错误！');return;}api.showProgress({title: 'API添加中',text:'',modal:false});var url=apiUrl+'?ac=list&wd=&t=&h=&ids=&pg=1&cid=&p=1';api.ajax({url:url,method:'get',dataType:'text',tag:'apiAdd',timeout:10},function(ret,err){api.hideProgress();if(!ret || err){alert(err.code==0?'无法连接，请重试':err.msg);return;}if(/vod_id|<video>/.test(ret)==false){alert('数据未匹配，请检查API地址');return;}var data=getApiInfo('SELECT * FROM apiInfo where url="'+urlStr+'"');if(data.length>0){executeSqlSync('delete from apiInfo where url = "'+urlStr+'"');}var name=getHostNameByUrl(apiDecode(urlStr));executeSqlSync('INSERT INTO apiInfo (url,name) VALUES ("'+urlStr+'","'+name+'")');apiSelected=urlStr;$('#tp').attr("data-line",urlStr).text('资源:'+name);var i=zyapi.urls.indexOf(urlStr);if(i!=-1){zyapi.urls.splice(i,1);zyapi.name.splice(i,1);}zyapi.urls.push(urlStr);zyapi.name.push('资源:'+name);updateList(getApiInfo('SELECT * FROM apiInfo'));$('#ss').empty();$('#fenlei').empty();alert('添加成功，开始搜索吧');});}function updateList(data){var list=[];if(data.length>0){for(var i=0,m;m=data[i];i++){list.push('<div style="display:-webkit-flex;display:flex;height:0.4rem;line-height:0.4rem;margin:10px 0;background:#fff;color:#000;font-size:0.14rem;" data-url="'+m.url+'"><span style="padding:0 5px;color:#070;">'+(i+1)+'</span><a style="-webkit-flex:1;flex:1;text-align:center;">﻿﻿'+m.name+'</a><span style="padding:0 10px;color:#f55;" class="delete-btn">﻿﻿删除</span></div>');}$("#url_list").html(list.reverse().join(''));}else{$("#url_list").html('<span style="color:#f00;">你还没添加API地址</span>');}}function initApi(){var data=getApiInfo('SELECT * FROM apiInfo');updateList(data);if(data.length>0){for(var i=0,m;m=data[i];i++){zyapi.urls.push(m.url);zyapi.name.push('资源:'+m.name);}}$('#tp').attr("data-line",apiSelected).text(zyapi.name[zyapi.urls.indexOf(apiSelected)]);}######.vip.html======<!DOCTYPE html><html style="font-size:100px;"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><title>VIP视频点播</title><script src="file:///android_asset/widget/script/jquery.min.js"></script><script src=".vip.js"></script><style>body{margin: 0;padding:0;color:#333;background-color:#fff;font-size:0.12rem; font-family:"微软雅黑";}a{text-decoration:none;}#pt{display:none;position:fixed;top:0;left:0;background-color:#f3f3f3;color:#070;width:100%;font-size:0.14rem;height:0.4rem;line-height:0.4rem;overflow:hidden;z-index:9999999999999;}.top-box{display:-webkit-flex;display:flex;}#download{padding:0 3px;}#line{padding:0 5px;}#ptitle{padding:0 3px;-webkit-flex:1;flex:1;color:#0a1a2a;text-align:center;}.xuanji{padding:0 5px;}#download:active,#line:active,.xuanji:active{color:white;background-color:#4CAF50;}#movie{font-size:0.12rem;color:#00FF7F;text-align:center;z-index:99999;}#movie a{display:inline-block;color:#fff;border:1px solid #333;margin:0.05rem 0.03rem;padding:0.05rem 0.1rem;border-radius: 0.1rem;}.search-box{display:-webkit-flex;display:flex;padding:1px 0;height:0.44rem;line-height:0.44rem;text-align:center;background-color:#0a0;color:#fff;font-size:0.14rem;}.search-input{-webkit-flex:1;flex:1;width:100%;padding:0 10px;box-sizing:border-box;background-color:#fff;color:#0a1a2a;border:none;text-align:center;}.search-history{padding:0 5px;border:none;}.search-btn{padding:0 10px;border:none;}.search-history:active,.search-btn:active{background-color:#4CAF50;}#search_record{position:absolute;top:0;z-index:999;overflow:hidden;width:100%;display:none;background-color:#ddd;padding:0.1rem 0;}.tab-item-selected{color:green;border-bottom:2px green solid;}.fuli{padding:5px;font-size:0.12rem;background-color:green;color:white;}.main-box{display:flex;flex-direction:column;overflow:hidden;margin:10px 0;padding:10px 0;border:none;background-color:#eee;}.content-box{display:flex;align-items:center;}.img-box{position:relative;width:0.9rem;height:1.2rem;}.update-info{box-sizing:border-box;width:100%;padding:0.03rem;display:block;text-align:center;font-size:0.12rem;color:#fff;background:rgba(0,0,0,0.3);position:absolute;bottom:0;right:0;}.update-schedule{padding:0.03rem;display:none;font-size:0.12rem;color:#fff;background:rgba(0,0,0,0.4);position:absolute;top:0;left:0;}.title-box{flex:1;padding:0 5px;font-size:0.14rem;}.atitle{display:block;color:green;font-size:0.16rem;}.ainfos{display:block;color:gray;padding:0.05rem 0;}.site{display:inline-block;color:gray;}.site select{border: 0.01rem solid gray;color:gray;height:0.3rem;font-size:0.14rem;}.xuanji-btn{display:inline-block;padding:8px 15px;margin:5px 10px;border:1px solid gray;color:gray;border-radius:15px;}.playrecord{display:inline-block;font-size:0.14rem;color:#f00;margin:5px 0;}.urls-box{display:none;padding-top:10px;}.urls-btn{float:left;width:70px;padding:15px 0;border:1px solid #fff;text-decoration:none;color:#333;background-color:#ddd;text-align:center;font-size:12px;}.cover-layer{display:block;color:#fff;background:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;}.duration{position:absolute;bottom:0;right:0;padding:0.03rem;display:block;font-size:0.12rem;color:#fff;background:rgba(0,0,0,0.3);}.footer{font-size:0.12rem;font-family:\'微软雅黑\';line-height:0.2rem;color:gray;clear:left;margin-bottom:0.35rem;}.footer span{color:#080;}.top{opacity:0.9;border:0;font-size: 0.12rem;z-index:99;width:auto;right:0.01rem;bottom: 0.01rem;position:fixed;}.top a{display:none;width:0.5rem;float:left;text-align:center;height:0.35rem;line-height: 0.35rem;color:#fff;background-color:green;}.top a:last-child{margin-left:0.01rem;}#url_list{max-height:320px;width:100%;border:1px solid #e5e5e5;border-width:1px 0;overflow:auto;-webkit-overflow-scrolling: touch;padding:8px 0;margin:5px 0;text-align:center;overflow-y: auto;-webkit-overflow-scrolling: touch;}</style></head><body></body></html>######.downloader.html======<!DOCTYPE html><html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>下载管理</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><style type="text/css">html,body{margin:0;padding:0;overflow-x: hidden;background-color:#fff;}.center{padding-left:5px;margin-right:0.27rem;text-align:left;}.left{ width:0.6rem;left: 0;margin-top:-0.1rem;color:#fff;background-color:#777;}.right{width:0.22rem;right: 0;margin-top:-0.11rem;color:#999;}.left,.right{position: absolute;top:50%;text-align:center;}.main{position:relative;margin:0.1rem 0;font-size:0.12rem;overflow:hidden;background-color:#eee;display:-webkit-flex;display:flex; align-items:center;padding:8px 0;}.status,.progress,.reason{line-height:0.2rem;}.title{display:block;word-wrap: break-word;word-break: normal;line-height:0.2rem;font-size:0.16rem;color:#000;margin-bottom:5px;}.progress,.reason{margin-left:10px;color:#777;}.deleteBtn{height:0.22rem;width:0.22rem;line-height:0.22rem;font-size:0.2rem;color:#999;}#space,#location{position:fixed;left:0;bottom:0;padding:0.1rem 0;width:100%;font-size:0.12rem;text-align:center;color:#999;background-color:#fff;}.error{color:#f00;font-size:0.12rem;}</style></head><body><div id="downloadList" style="margin-bottom:0.32rem;"></div><div id="space"></div><script>var state={s0:['下载中','#0a0'],s1:['完成','#f0f'],s2:['下载失败','#f00'],s3:['暂停','#aaa'],s4:['获取数据中','#0a0'],s5:['等待下载','#aaa']};(function (doc, win) {var docEl = doc.documentElement,resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',recalc = function () {var clientWidth = docEl.clientWidth;if (!clientWidth) return;if(clientWidth>=640){docEl.style.fontSize = '177px';}else{docEl.style.fontSize = 177.78*(clientWidth / 640) + 'px';}};if (!doc.addEventListener) return;win.addEventListener(resizeEvt, recalc, false);doc.addEventListener('DOMContentLoaded', recalc, false);})(document, window);apiready=function(){addListener();api.sendEvent({name:'frameOnload',extra:{name:api.frameName}});api.addEventListener({name:'online'},function(ret,err){var El=$('#downloadList div[data-reason=1]');if(El.length>0){El.click();}El.length<2&&downloadPendingData(2-El.length);});window.apiFs=api.require('fs');window.apiDb=api.require('db');window.downloadPath=api.fsDir+"/download";updateTableAndDelete();downloadList();paramAdd();spaceLeft();$('body').append('<span id="location">存储位置：/UZMap/A6003463152993/download/</span>');setTimeout(function(){$('#location').remove();},10000);};function updateTableAndDelete(){var arr=getDownloadInfo('SELECT * FROM downloadInfo order by id asc');if(arr.length==0){return;}var str=JSON.stringify(getDownloadInfo('SELECT url FROM downloadsInfo order by id asc'));var statusArr=[3,0,1,2,4];for(var i=0,m;m=arr[i];i++){if(m.type=='m3u8'){var ret=apiFs.existSync({path:downloadPath+"/"+m.path});if(ret.exist==false){continue;}var data=api.readFile({sync:true,path:downloadPath+"/"+m.path+"/index.m3u8"});if(data){api.writeFile({path:downloadPath+"/"+m.title+".m3u8",data:data.replace(/[0-9a-z]{32}/g,'.$&')},function(ret,err){});}apiFs.removeSync({path:downloadPath+"/"+m.path+"/index.m3u8"});apiFs.renameSync({oldPath:downloadPath+"/"+m.path,newPath:downloadPath+"/."+m.path});}if(str.indexOf(m.url)!=-1){continue;}executeSql('INSERT INTO downloadsInfo (url,title,type,size,status,pid) VALUES ("'+m.url+'","'+m.title+'","'+m.type+'",0,'+statusArr[m.status]+',0)');}executeSql('drop table downloadInfo');}function paramAdd(){var param=api.getGlobalData({key:'downloaderParam'});if(param){addToList(param.url,param.title,param.type);return;}$('#downloadList').html()==''&&api.toast({msg:'空空如也'});}function spaceLeft(){api.getFreeDiskSpace(function(ret,err){$('#space').text('可用空间：'+bytesToSize(ret.size));});}function bytesToSize(size){var unit;var units=['B','KB','MB','GB','TB'];while ((unit=units.shift())&&size>1024){size=size/1024;}return (unit==='B'?size:size.toFixed(2))+unit;}function executeSql(sql){apiDb.executeSql({name:'downloader',sql:sql},function(ret,err){if(!ret||ret.status==false){api.toast({msg:err.msg});}});}function getDownloadInfo(sql){var ret = apiDb.selectSqlSync({name:'downloader',sql:sql});return ret.data||[];}function addToList(url,title,type){var data=getDownloadInfo('SELECT * FROM downloadsInfo where url = "'+url+'"');if(data.length>0){api.toast({msg:'已存在',global:true});return;}api.toast({msg:'已添加至"下载管理"',global:true});title=title.replace(/\//g,',');for(var i=1,newTitle=title;i<20;i++){data=getDownloadInfo('SELECT status FROM downloadsInfo where title = "'+newTitle+'" and type = "'+type+'"');if(data.length>0){newTitle=title+'('+i+')';continue;}break;}var option={url:url,title:newTitle,type:type,size:0,status:0,pid:0};var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 0');if(arr.length>1){option.status=5;var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 5 order by pid desc limit 1');if(arr.length>0){option.pid=arr[0].pid+1;}}executeSql('INSERT INTO downloadsInfo (url,title,type,size,status,pid) VALUES ("'+url+'","'+newTitle+'","'+type+'",0,'+option.status+','+option.pid+')');$('#downloadList').prepend(listHtml(option));if(option.status==5){return;}queueDownload(option);}function downloadList(){var arr=getDownloadInfo('SELECT * FROM downloadsInfo order by id desc');if(arr.length==0){return;}for(var i=0,ar=[],m;m=arr[i];i++){ar.push(listHtml(m));}$('#downloadList').html(ar.join(''));initState(arr);}function initState(arr){var loadingArr=getDownloadInfo('SELECT status FROM downloadsInfo where status = 0');if(loadingArr.length<2){downloadPendingData(2-loadingArr.length);}for(var i=0,m;m=arr[i];i++){if(m.status==0){queueDownload(m);}if(m.type=='m3u8'){m3u8State(m);}else{mp4State(m);}}}function m3u8State(m){var path=downloadPath+'/.'+hex_md5(m.url);apiFs.getAttribute({path:path},function(ret,err){if(!ret.status){return;}var El=$('#downloadList div[data-url="'+m.url+'"]');var size=ret.attribute.size;if(m.status==1){El.find('.progress').text(bytesToSize(size));return;}var data=api.readFile({sync:true,path:path+'/tsfile.txt'});if(data==''){return;}var arr=JSON.parse(data);var ret=apiFs.readDirSync({path:path});if(!ret.status){return;}var k=ret.data.length-2;var keyExist=apiFs.existSync({path:path+'/key.key'});keyExist.exist&&k--;k<0&&(k=0);apiFs.getAttribute({path:path+'/'+k+'.ts.tmp'},function(ret,err){if(ret&&ret.status){El.find('.progress').text(bytesToSize(size)+'/-- | '+((k+ret.attribute.size/m.size)*100/arr.length).toFixed(2)+'%');}});});}function mp4State(m){var El=$('#downloadList div[data-url="'+m.url+'"]');var totalSize=m.size;if(m.status==1){El.find('.progress').text(bytesToSize(totalSize));return;}apiFs.getAttribute({path:'fs://download/'+m.title+'.'+m.type+'.tmp'},function(ret,err){if(ret&&ret.status){var dsize=ret.attribute.size;El.find('.progress').text(totalSize!=0?bytesToSize(dsize)+'/'+bytesToSize(totalSize)+' | '+(dsize*100/totalSize).toFixed(2)+'%':'0%');}});}function listHtml(m){return '<div data-url="'+m.url+'" data-path="'+hex_md5(m.url)+'" data-title="'+m.title+'" data-size="'+m.size+'" data-status="'+m.status+'" data-type="'+m.type+'" class="main"><div class="center"><div class="title">'+m.title+'.'+m.type+'</div><span style="color:'+state["s"+m.status][1]+';" class="status">'+state["s"+m.status][0]+'</span><span class="progress"></span><span class="reason"></span></div><div class="deleteBtn right">&times;</div></div>';}function downloadPendingData(len){if(api.connectionType=='none'){api.toast({msg:'请先联网'});return;}var arr=getDownloadInfo('SELECT * FROM downloadsInfo where status = 5 order by pid asc limit '+len);if(arr.length==0){return;}for(var i=0,m;m=arr[i];i++){queueDownload(m);}spaceLeft();}function queueDownload(option){if(api.connectionType=='none'){api.toast({msg:'请先联网'});return;}executeSql('update downloadsInfo set status=0,pid=0 where url="'+option.url+'"');var El=$('#downloadList div[data-url="'+option.url+'"]');updateStatusText(El,0);El.attr("data-reason",-1);if(option.type=='m3u8'){option.path=option.url;var path=downloadPath+"/."+hex_md5(option.url);var data=api.readFile({sync:true,path:path+'/tsfile.txt'});if(data==''){getM3u8Info(option);return;}var arr=JSON.parse(data);var ret=apiFs.readDirSync({path:path});if(!ret.status){executeSql('update downloadsInfo set status=2 where url="'+option.url+'"');updateStatusText(El,2);downloadPendingData(1);return;}var tsCount=ret.data.length-1;var keyExist=apiFs.existSync({path:path+'/key.key'});keyExist.exist&&tsCount--;var k=tsCount>0?tsCount-1:0;startM3u8Download({url:arr[k],savePath:path+"/"+k+".ts",tag:option.url});return;}api.accessNative({name:"getRealUrl",extra:{url:option.url}},function(ret,err){api.accessNative({name:"httpDownload",extra:{url:ret.hasOwnProperty("url")&&ret.url||option.url,tag:option.url,savePath:downloadPath+"/"+option.title+"."+option.type,allowResume:true,report:true}},function(ret,err){mp4Status(ret);});});}function startM3u8Download(m){api.accessNative({name:"httpDownload",extra:{url:m.url,savePath:m.savePath,tag:m.tag,allowResume:false,report:true}},function(ret,err){m3u8Status(ret);});}function m3u8Status(m){if(m.hasOwnProperty("url")==false){return;}var status=m.status;var tsSize=m.fileSize;var savePath=m.savePath;var mPath=savePath.match(/\.([0-9a-z]{32})\/\d+\.ts$/);var El=$('#downloadList div[data-path="'+mPath[1]+'"]');if(El.attr("data-size")==0&&tsSize!=0){El.attr("data-size",tsSize);executeSql('update downloadsInfo set size='+tsSize+' where url="'+El.attr("data-url")+'"');}var path=downloadPath+"/."+mPath[1];apiFs.getAttribute({path:path},function(ret,err){if(!ret.status){return;}var tsData=api.readFile({sync:true,path:path+'/tsfile.txt'});if(tsData==''){return;}var tsArr=JSON.parse(tsData);var k=tsArr.indexOf(m.url);k<0&&(k=0);var nextK=k+1;var size=ret.attribute.size;if(status==1){if(nextK==tsArr.length){executeSql('update downloadsInfo set status=1 where url="'+El.attr("data-url")+'"');updateStatusText(El,1);El.find('.progress').text(bytesToSize(size));downloadPendingData(1);}else{El.attr("data-size",0);updateStatusText(El,0);El.find('.progress').text(bytesToSize(size)+'/-- | '+(nextK*100/tsArr.length).toFixed(2)+'%');El.attr("data-size",0);startM3u8Download({url:tsArr[nextK],savePath:path+"/"+nextK+".ts",tag:m.tag});}}else if(status==0){if(El.attr("data-status")==3){api.accessNative({name:"cancelHttpDownload",extra:{url:m.tag}},function(ret,err){});return;}updateStatusText(El,0);El.find('.progress').text(bytesToSize(size)+'/-- | '+((k+m.percent/100)*100/tsArr.length).toFixed(2)+'%');}else if(status==2){executeSql('update downloadsInfo set status=2 where url="'+El.attr("data-url")+'"');updateStatusText(El,2);El.attr("data-reason",m.reason);m.reason!=1&&downloadPendingData(1);}});}function mp4Status(m){if(m.hasOwnProperty("url")==false){return;}var tag=m.tag;var status=m.status;var totalSize=m.fileSize;var El=$('#downloadList div[data-url="'+tag+'"]');if(El.attr("data-size")==0&&totalSize!=0){El.attr("data-size",totalSize);executeSql('update downloadsInfo set size='+totalSize+' where url="'+tag+'"');}if(status==1){updateStatusText(El,status);executeSql('update downloadsInfo set status='+status+' where url="'+tag+'"');El.find('.progress').text(bytesToSize(totalSize));downloadPendingData(1);}else if(status==0){if(El.attr("data-status")==3){api.accessNative({name:"cancelHttpDownload",extra:{url:m.tag}},function(ret,err){});return;}updateStatusText(El,status);var percent=m.percent;var curSize=totalSize*percent/100;El.find('.progress').text(bytesToSize(curSize)+'/'+bytesToSize(totalSize)+' | '+percent+'%');}else if(status==2){updateStatusText(El,status);executeSql('update downloadsInfo set status='+status+' where url="'+tag+'"');El.attr("data-reason",m.reason);m.reason!=1&&downloadPendingData(1);}}function updateStatusPid(url){var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 5 order by pid desc limit 1');var pid=arr.length==0&&1||arr[0].pid+1;executeSql('update downloadsInfo set status=5,pid='+pid+' where url="'+url+'"');}function updateStatusText(El,status){El.attr("data-status",status);El.find('.status').text(state["s"+status][0]).css("color",state["s"+status][1]);}function pauseDownload(El){var url=El.attr("data-url");updateStatusText(El,3);executeSql('update downloadsInfo set status=3,pid=0 where url="'+url+'"');api.accessNative({name:"cancelHttpDownload",extra:{url:url}},function(ret,err){downloadPendingData(1);});}function pengdingOrLoading(El){var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 0');if(arr.length>1){updateStatusText(El,5);updateStatusPid(El.attr("data-url"));return;}queueDownload({url:El.attr("data-url"),title:El.attr("data-title"),type:El.attr("data-type")});}function addListener(){$('#downloadList').on("click",".main",function(){var thisEl=$(this);switch(thisEl.attr("data-status")*1){case 0:pauseDownload(thisEl);break;case 1:startPlay(api.fsDir+'/download/'+thisEl.attr("data-title")+'.'+thisEl.attr("data-type"));break;case 2:pengdingOrLoading(thisEl);break;case 3:pengdingOrLoading(thisEl);break;case 5:updateStatusText(thisEl,3);executeSql('update downloadsInfo set status=3,pid=0 where url="'+thisEl.attr("data-url")+'"');break;}});$('#downloadList').on("click",".deleteBtn",function(){var mainEl=$(this).parent();var url=mainEl.attr("data-url"),path=mainEl.attr("data-path"),title=mainEl.attr("data-title"),type=mainEl.attr("data-type"),status=mainEl.attr("data-status");api.confirm({title:'确定删除',msg:title+'.'+type,buttons:['取消','确定']},function(ret,err){if(ret.buttonIndex!=2){return;}mainEl.hide();if(status==0){api.accessNative({name:"cancelHttpDownload",extra:{url:url}},function(ret,err){apiFs.remove({path:downloadPath+'/'+title+'.'+type+'.tmp'},function(ret,err){});apiFs.rmdir({path:downloadPath+'/.'+path},function(ret,err){});setTimeout(function(){apiFs.rmdir({path:downloadPath+'/.'+path},function(ret,err){});},3000);downloadPendingData(1);});}apiFs.remove({path:downloadPath+'/'+title+'.'+type},function(ret,err){});apiFs.remove({path:downloadPath+'/'+title+'.'+type+'.tmp'},function(ret,err){});apiFs.rmdir({path:downloadPath+'/.'+path},function(ret,err){});executeSql('delete from downloadsInfo where url = "'+url+'"');setTimeout(spaceLeft,1000);});return false;});}function getM3u8Info(option){var url=option.url,path=hex_md5(option.path);var El=$('#downloadList div[data-path="'+path+'"]');El.find('.status').text(state["s4"][0]).css("color",state["s4"][1]);api.ajax({url:(url.indexOf('?')!==-1?url:url+'?56798'),method:'get',dataType:'text',timeout:15},function(ret,err){if(!ret||err){updateStatusText(El,2);executeSql('update downloadsInfo set status=2 where url="'+option.path+'"');downloadPendingData(1);return;}var mArr=ret.match(/\s+([^#\s]+)(#+\w+)?/),m3u8=mArr[1]||"";if(/^(https?:)/.test(m3u8)||m3u8==""){var baseUrl="";}else if(m3u8.indexOf("/")==0){var baseUrl=url.match(/^.{8}[^\/]+/);}else if(m3u8.indexOf("../")==0){var ml=m3u8.split("/")[1],baseUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);ret=ret.replace(/(\s+)\.\.\//g,"$1");}else{var baseUrl=url.substr(0,url.lastIndexOf("/")+1);(m3u8.indexOf("./")==0)&&(ret=ret.replace(/(\s+)\.\//g,"$1"));}if(ret.indexOf("ENDLIST")==-1){option.url=baseUrl+m3u8;getM3u8Info(option);return;}path=downloadPath+'/.'+path+'/';var m3u8FilePath=downloadPath+'/'+option.title+'.m3u8';ret=ret.replace(/(uri\s?=\s?")([^"]+)/i,function(a,a1,a2){if(/^https?:/.test(a2)){var baseKeyUrl='';}else if(a2.indexOf("/")==0){var baseKeyUrl=url.match(/^.{8}[^\/]+/);}else if(a2.indexOf("../")==0){var ml=a2.split("/")[1],baseKeyUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);a2=a2.substr(3);}else{var baseKeyUrl=url.substr(0,url.lastIndexOf("/")+1);(a2.indexOf("./")==0)&&(a2=a2.substr(2));}a2=baseKeyUrl+a2;api.accessNative({name:'httpDownload',extra:{url:a2,savePath:path+'key.key',allowResume:false,report:false}},function(ret,err){});return a1+path+'key.key';});var arr=ret.split('\n'),str=[],m3u8file=[];for(var i=0,m;m=arr[i];i++){if(m.indexOf('#')==0){m3u8file.push(m);continue;}if(m==''){continue;}str.push(baseUrl+m);m3u8file.push(path+(str.length-1)+'.ts');}api.writeFile({path:path+'tsfile.txt',data:JSON.stringify(str).replace(/("|')https:/g,'$1http:')},function(ret,err){if(err||!ret.status){api.toast({msg:err.msg});updateStatusText(El,2);executeSql('update downloadsInfo set status=2 where url="'+option.path+'"');downloadPendingData(1);return;}startM3u8Download({url:str[0],savePath:path+"0.ts",tag:option.path});});api.writeFile({path:m3u8FilePath,data:m3u8file.join("\n")},function(ret,err){if(err||!ret.status){api.toast({msg:err.msg});}});});}</script></body></html>######.api.html======<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><script src=".api.js"></script><title>影视资源API</title><style>html,body{margin:0;padding:0;overflow-x: hidden;font-size:0.12rem;background-color:#fff;}a{text-decoration:none;}a:visited{color:red;}#bt{background-color:gray;float:left;width:33.3%;height:0.35rem;line-height:0.35rem;color:white;display:block;text-align:center;}#ptitle{position:fixed;top:0;left:0;width:100%;height:0.35rem;line-height:0.35rem;background-color:#f3f3f3;color:#070;font-size:0.14rem;z-index:999;overflow:hidden;}.top-box{display:-webkit-flex;display:flex;}.title{-webkit-flex:1;flex:1;padding:0 5px;text-align:center;color:#0a1a2a;}#download{padding:0 5px;text-decoration:none;}.to-xuanji{padding:0 10px;}#download:active,.to-xuanji:active{color:white;background-color:#4CAF50;}#movie a{display:inline-block;color:#fff;border:1px solid #333;margin:0.05rem 0.03rem;padding:0.05rem 0.1rem;border-radius: 0.1rem;}.search-box{display:-webkit-flex;display:flex;padding:1px 0;height:0.44rem;line-height:0.44rem;text-align:center;background-color:#0a0;font-size:0.14rem;}.search-input{-webkit-flex:1;flex:1;width:100%;padding:0 10px;box-sizing:border-box;background-color:#fff;color:#000;border:none;text-align:center;}.search-line{padding:0 5px;color:#fff;}.search-btn{padding:0 10px;color:#fff;}.search-line:active,.search-btn:active{background-color:#4CAF50;}#fenlei a{float:left;color:#333;background-color:#ddd;margin:0.02rem 0.03rem;padding:0.05rem 0.1rem;display:block;}.pg{background-color:gray;float:left;width:auto;color:white;display:block;text-align:center;margin:0.05rem;padding:0.1rem 0.2rem;}.main-box{overflow:hidden;display:-webkit-flex;-webkit-flex-direction:column;display:flex;flex-direction:column;background-color:#eee;margin:10px 0;padding:10px 0;}.content-box{display:-webkit-flex;display:flex;overflow:hidden;align-items:center;}.img-box{width:0.9rem;height:1.2rem;position:relative;}.img-box img{width:100%;height:1.2rem;}.img-box span{overflow:hidden;box-sizing:border-box;width:100%;line-height:0.14rem;position:absolute;bottom:0;right:0;padding:0 0.03rem;display:block;font-size:0.12rem;color:#fff;background:rgba(0,0,0,0.3);text-align:center;}.title-box{-webkit-flex:1;flex:1;text-align:center;padding:0 5px;}.atitle{display:block;color:green;font-size:0.16rem;margin-bottom:0.05rem;}.title-box date,.title-box channel,.title-box actor{color:gray;}.title-box channel{margin:0 5px;}.xuanji span{display:inline-block;padding:0.08rem 0.15rem;margin:0.05rem 0.1rem;border: 0.01rem solid gray;color:gray;border-radius: 0.15rem;}.m3u8-data,.mp4-data{overflow:hidden;padding-top:10px;}.m3u8-data a,.mp4-data a{float:left;text-align:center;padding:15px 0;border:1px solid #fff;background-color:#ddd;color:#333;}#url_list{max-height:320px;width:100%;border:1px solid #e5e5e5;border-width:1px 0;overflow:auto;-webkit-overflow-scrolling: touch;padding:8px 0;margin:5px 0;text-align:center;overflow-y: auto;-webkit-overflow-scrolling: touch;}.tiptext:after {bottom: -10px;right: 0.8rem;border: 5px solid transparent;border-top-color: #00f;content: '';position: absolute;}</style></head><body></body></html>######.music.html======<!doctype html><html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>高品音乐</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><style>*{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;}body{margin:0;padding:0;background-color:#fff;}.not-scroll{height:100%;position:fixed;top:0;}.top-box{position:fixed;top:0;left:0;width:100%;z-index:3;background-color:#fff;}.search-box{width:100%;z-index:3;display:-webkit-flex;display:flex;padding:1px 0;height:44px;line-height:44px;text-align:center;background-color:#0a0;font-size:14px;}.search-input{-webkit-flex:1;flex:1;width:100%;padding:0 10px;box-sizing:border-box;background-color:#fff;color:#000;border:none;text-align:center;}.search-line,.search-btn{padding:0 10px;color:#fff;}.search-line:active,.search-btn:active{background-color:#4CAF50;}.tab-box{display:-webkit-flex;display:flex;width:100%;background-color:#f9f9f9;color:#666;}.tab-item{display:block;-webkit-flex:1;flex:1;text-align:center;height:34px;line-height:34px;font-size:14px;}.tab-item-selected{color:green;border-bottom:2px green solid;}.search-history{padding:10px 0;color:#999;overflow-y:auto;-webkit-overflow-scrolling:touch;}.search-history-item{display:inline-block;color:#666;border:1px solid #eee;margin:5px 3px;padding:5px 10px;border-radius:10px;}ul{list-style:none;padding:0;margin:0;}.loadmore{text-align:center;font-size:14px;background:rgba(0,0,0,0.3);color:#fff;padding:10px;margin:5px 0;}.nomore{background-color:#fff;color:#999;}#html{margin:10px 0 40px;}#html sup{color:#999;}#html li{background-color:#fff;position:relative;height:53px;padding:8px 0 5px;overflow:hidden;}#html li::after{content:"";position:absolute;height:1px;bottom:0;left:0;right:0;background:#e5e5e5;}#html .song_name{line-height:18px;font-size:16px;font-weight:400;color:#000;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}#html .singer_name{margin-top:5px;font-size:14px;color:grey;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}#song-info{width:100%;position:absolute;top:30%;left:0;background-color:#fff;padding-top:10px;}#song-info .title{text-align:center;}#song-info .song_name{font-size:16px;display:block;text-align:center;color:#000;}#song-info .singer,#song-info .song_time,#song-info .song_album{margin:5px;font-size:12px;color:#999;}#song-info .urls{width:100%;border:1px solid #e5e5e5;border-width:1px 0;overflow:hidden;padding:5px 0;margin:5px 0;}#song-info .urls a{float:left;padding:5px 8px;margin:5px 3px;color:#fff;background-color:#000;font-size:14px;}#song-info .urls a:hover{background:#00f;}#song-info .close{text-align:center;font-size:14px;color:#000;padding:10px;}#song-info .close:hover{color:#f00;}.show-box{background:rgba(0,0,0,0.3);position:fixed;top:0;left:0;margin:0;padding:0;width:100%;height:100%;display:-webkit-box;-webkit-box-pack:center;-webkit-box-align:center;}.show-box img{z-index:1;height:50%;}#lrc-box{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;background-color:#eee;z-index:9;}.box-title{overflow:hidden;height:40px;line-height:40px;color:#999;font-size:16px;text-align:center;}#lrc{-webkit-flex:1;flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;width:100%;background-color:#eee;color:#000;}.closebtn{z-index:2;width:100%;text-align:center;font-size:14px;color:#fff;background:rgba(0,0,0,0.3);}audio::-webkit-media-controls-mute-button{display:none;}audio::-webkit-media-controls{overflow:hidden !important;}audio::-webkit-media-controls-enclosure{width:calc(100%+40px);margin-left:auto;}</style></head><body><div class="top-box"><div class="search-box"><a class="search-line" id="source" data-source="YQB">B 线</a><input id="wd" class="search-input" placeholder="搜索歌曲/歌单/歌手/专辑" onkeydown="FSubmit(event.keyCode||event.which);"/><a class="search-btn">搜索</a></div> <div class="tab-box"><a class="tab-item" data-show="#html" data-hide=".search-history,.music-player">搜索结果</a><a class="tab-item" data-show=".search-history" data-hide=".music-player">搜索记录</a><a class="tab-item" data-show=".music-player" data-hide=".search-history">播放器</a></div><div class="search-history" style="display:none;"></div><div class="music-player" style="display:none;"><div id="lrc-box"><div class="box-title"></div><div id="lrc"></div><div id="player" style="z-index:99999;"><div id="lyricContainer" style="padding:5px 0;text-align:center;background:rgba(0,0,0,0.5);color:#fff;">暂无歌词</div><audio controls controlsList="nodownload" id="audio" style="width:100%;outline:none;">audio not supported!</audio></div></div></div></div> <div id="html"><p style="text-align:center;color:#999;font-size:16px;">搜出你的最爱</p></div> <div id="cur-info" style="display:none;"></div><script>var scrolltop=0,curPage=1,isReady=0,musicSource;var audio=document.getElementById('audio'),lyricContainer = document.getElementById('lyricContainer'),lyric=[];apiready=function(){api.sendEvent({name:'frameOnload',extra:{name:api.frameName}});getSearchHistory(0);var topSpace=$('.search-box').height()+$('.tab-box').height();$('#html').css({"padding-top":topSpace+"px"});$('#lrc-box,.search-history').css({"height":(api.frameHeight-topSpace)+"px"});$('.tab-box').on('click','.tab-item',function(){var el=$(this);var showEl=el.attr("data-show"),hideEl=el.attr("data-hide");if(showEl=='#html'){document.body.scrollTop=scrolltop;scrolltop=0;}else if(scrolltop==0){scrolltop=document.body.scrollTop;}$(hideEl).fadeOut(200);$(showEl).fadeIn(200);$('.tab-item').removeClass('tab-item-selected');el.addClass('tab-item-selected');});$('.search-history').on('click','.search-history-item',function(){$('#wd').val($(this).text());search(1);});$('body').on('click','#lrc p',function(){var i=$(this).attr("id").match(/\d+/);audio.currentTime=lyric[i][0];});$('#lyricContainer').on("click",function(){var i=$(this).attr("data-key");document.getElementById('lrc'+i).scrollIntoView();});$('#audio').on('timeupdate',function(){var curKey=0;for(var i=0,m;m=lyric[i];i++){if(this.currentTime+0.5>m[0]){curKey=$('#lyricContainer').attr("data-key");if(curKey==i){continue;}$('#lyricContainer').attr("data-key",i);lyricContainer.textContent=m[1];$('#lrc'+curKey).css({"color":"#000"});$('#lrc'+i).css({"color":"#f00"});}}}).on('error',function(){audioRetry++;audioRetry<2&&/^http/.test(this.src)&&this.load()||(audioRetry==2&&api.toast({msg:'播放失败'}));});if(JSON.stringify(api.frames()).indexOf('MS')!==-1){switch2MS();}else{switch2LMY();}$('.search-btn').on("click",function(){search(1);});$('#source').on("click",function(){var el=$(this);var i=musicSource.value.indexOf(el.attr("data-source"));var texts=musicSource.text.slice();texts.splice(i,1,'*  '+musicSource.text[i]);api.actionSheet({title: '音乐源',cancelTitle: '取消',buttons: texts}, function(ret, err) {var index = ret.buttonIndex;if(index<musicSource.text.length+1){index--;if(el.attr("data-source")==musicSource.value[index]){return;}el.attr("data-source",musicSource.value[index]).text(musicSource.text[index]);$('#wd').val()&&search(1);}return false;});return false;});$('#html').on("click","li",function(){$('#html li').css("background-color","#fff");$(this).css("background-color","#f4f4f4");if(musicSource.site=="LMY"){return false;}getInfo($(this));return false;});$('#html').on("click","li a",function(){$(this).parent().click().find('a').css({"color":"#777","border-color":"#777"});$(this).css({"color":"green","border-color":"green"});var mainEl=$(this).parent().parent(),url=$(this).attr("data-url"),suffix=$(this).attr("data-suffix"),name=mainEl.attr("data-name"),singer=mainEl.attr("data-singer"),cover=mainEl.attr("data-cover"),lrc=mainEl.attr("data-lrc");$('#cur-info').attr("data-url",url).attr("data-name",name).attr("data-singer",singer).attr("data-suffix",suffix).attr("data-lrc",lrc).attr("data-cover",cover);if(/https?:\/\/59\.110\.45\.28\//.test(url)){api.showProgress({title:"解析中...",text:"",modal:false});api.accessNative({name:'getRealUrl',extra:{url:url}},function(ret,err){api.hideProgress();var realUrl=ret.url;if(!realUrl){api.toast({msg:'解析出错'});return;}if(suffix=="lrc"){window.audioRetry=0;lyric=[];audio.src=realUrl;audio.play();getLrc2Player(lrc);return;}play_download({url:realUrl,name:name+' - '+singer,suffix:getSuffixByUrl(realUrl,suffix)});});return;}if(suffix=="lrc"){window.audioRetry=0;lyric=[];audio.src=url;audio.play();getLrc2Player(lrc);return;}play_download({url:url,name:name+' - '+singer,suffix:getSuffixByUrl(url,suffix)});return false;});api.addEventListener({name:'MSReady'},function(ret,err){isReady=ret.value.ok;api.hideProgress();isReady==-1&&initError();});api.getGlobalData({key:'LMYReady'})&&api.execScript({frameName:musicSource.site,script:'retryTimer==null&&musicReady();'});setTimeout(function(){isReady==0&&api.showProgress({title:"初始化...",text:"",modal:false});},300);};function setSearchHistory(word){var str=localStorage.getItem('musicSearchHistory')||'[]';var arr=JSON.parse(str);var i=arr.indexOf(word);if(i!=-1){arr.splice(i,1);}arr.unshift(word);if(arr.length>30){arr.length=30;}localStorage.setItem('musicSearchHistory',JSON.stringify(arr));getSearchHistory(arr);}function getSearchHistory(arr){if(arr==0){var str=localStorage.getItem('musicSearchHistory')||'[]';arr=JSON.parse(str);}$('.search-history').html(arr[0]?'<a class="search-history-item">'+arr.join('</a><a class="search-history-item">')+'</a>':'<p style="text-align:center;color:#999;">暂无记录</p>');}function getSuffixByUrl(url,defaultSuffix){var m=url.match(/\.([a-z0-9]{3,5})($|\?)/);return m&&m[1]||defaultSuffix;}function getLrc2Player(url){lyricContainer.textContent="LRC loading…";$('.tab-item').get(2).click();showLrc(['[00:00.00]LRC loading…']);api.ajax({url:url,method:"get",dataType:"text",timeout:10},function(ret,err){lyric=parseLyric(/\[[\d\:\.]+\]/.test(ret)&&ret||'[00:00.00]暂无歌词');});}function parseLyric(text){if(/<\d+>/.test(text)){text=text.replace(/<\d+>/g,'');}text=text.replace(/\:(\d)(\.|\])/g,':0$1$2');var lines=text.match(/(\[[\d\:\.]+\])+.+/g),pattern=/\[[\d\:\.]+\]/g,is100=/\:[6-9]\d(\.|\])/.test(text),result=[];showLrc(lines);lines.forEach(function(v,i,a){var time=v.match(pattern),value=v.replace(pattern,'');time.forEach(function(v1,i1,a1){var t=v1.slice(1,-1).split(':');var m=parseInt(t[0],10),s=parseFloat(t[1]);result.push([m*60+(is100&&m>0&&s*0.6||s),value]);});});result.sort(function(a,b){return a[0]-b[0];});lyricContainer.textContent=$('#cur-info').attr("data-name")+' - '+$('#cur-info').attr("data-singer");return result;}function initError(){api.confirm({title:'提示',msg:'音乐模块初始化出错',buttons:['重新初始化','取消']},function(ret,err){if(ret.buttonIndex==1){api.closeFrame({name:"LMY"});api.execScript({name:'root',script:'openHideFrame("LMY",LMY);'});api.showProgress({title:"初始化...",text:"",modal:false});isReady=0;}});}function switch2LMY(){musicSource={site:"LMY",value:["YQB","YQD","migu","jooxhk","ximalaya","djyule"],text:["B 线","D 线","咪 咕","小 鸡","喜马拉雅","DJ音乐盒"]};$('#source').attr("data-source",musicSource.value[0]).text(musicSource.text[0]);}function switch2MS(){musicSource={site:"MS",value:["mg","it4g"],text:["咪咕","爱听4G"]};$('#source').attr("data-source",musicSource.value[0]).text(musicSource.text[0]);}function FSubmit(e){if(e==13){document.getElementById('wd').blur();search(1);}}function request(url,method,values,type){api.showProgress({title:"搜索中...",text:"",modal:false});var js='musicRequest(\''+url+'\',\''+method+'\',\''+JSON.stringify(values)+'\',\''+type+'\');';api.execScript({frameName:musicSource.site,script:js});}function getLrc(url){api.showProgress({title:"解析中...",text:"",modal:false});api.ajax({url:url,method:"get",dataType:"text",timeout:10},function(ret,err){api.hideProgress();if(ret){if(/暂无歌词/.test(ret)){api.toast({msg:'暂无歌词'});return;}showLrc(ret);return;}api.toast({msg:'未能获取歌词'});});}function resultLMY(str,type){api.hideProgress();var data=JSON.parse(unescape(str));searchTextLMY(data,curPage);}function result(str,type){api.hideProgress();str=unescape(str);if(str.indexOf('<html>')===0){api.toast({msg:'长时间未操作，请刷新一次'});return;}if(type=='getUrl'&&(str.indexOf('[')==0||str.indexOf('{')!=0)){if(/<\d+>/.test(str)){str=str.replace(/<\d+>/g,'');}str=str.replace(/\:(\d)(\.|\])/g,':0$1$2');var lines=str.match(/(\[[\d\:\.]+\])+.+/g);showLrc(lines);return;}var data=JSON.parse(str);if(data.code==1){api.toast({msg:'请重试'});return;}switch(type){case 'search':searchText(data);break;case 'getInfo':songInfo(data);break;case 'getUrl':if(data.hasOwnProperty("url")==false||!data.url){api.toast({msg:'请重试'});return;}var name=$('#song-info .song_name').text()+' - '+$('#song-info .singer').text();play_download({url:data.url,name:name,suffix:data.suffix});break;default:break;}}function search(page){var wd=$('#wd').val();if(page==1){scrolltop=0;$('.tab-item').get(0).click();api.pageUp({top:true});setSearchHistory(wd);}curPage=page;if(!wd){api.toast({msg:'请输入搜索内容'});return;}else if(isReady==0||isReady==2){api.toast({msg:'初始化，请稍后'});return;}else if(isReady<0){api.toast({msg:'初始化出错'});return;}if(musicSource.site=='LMY'){request('http://59.110.45.28/m/api/search','post',"text="+wd+"&page="+page+"&type="+$('#source').attr("data-source"),'searchLMY');}else{request('api.php?search='+$('#source').attr("data-source"),'post',{w:wd,p:page,n:10},'search');}return false;}function getInfo(el){request('api.php?get_song='+$('#source').attr("data-source"),'post',{mid:el.attr("data-mid")},'getInfo');return false;}function getUrl(el){var url=el.attr("data-url");if(/^(\/\/|http)/.test(url)){showImg(url.replace(/^(\/\/)/,'http://'));return false;}request(url,'get',{},'getUrl');return false;}function showImg(url){$('body').append('<div class="show-box"><img src="'+url+'"/><div class="closebtn" onclick="imgClosebtnClick(this);">&times; 关闭</div></div>');}function imgClosebtnClick(el){var p=el.parentNode;p.parentNode.removeChild(p);}function showLrc(ar){var pt=/\[[\d\:\.]+\]/g,t=ar.join('').match(pt);t.sort();for(var str=[],i=0,m;m=ar[i];i++){var t1=m.match(pt),text=m.replace(pt,'');for(var k=0,n;n=t1[k];k++){var j=t.indexOf(n);str[j]='<p id="lrc'+j+'" style="padding:5px 10px;"><span style="color:#099;padding-right:5px;">'+n+'</span>'+text+'</p>';}}$('.box-title').text($('#cur-info').attr("data-name")+' - '+$('#cur-info').attr("data-singer"));$('#lrc').html(str.join(''));$(this).scrollTop()==0&&window.scrollBy(0,1);isBottom()&&window.scrollBy(0,-1);}function toggleBody(isPin){if(isPin){scrolltop=document.body.scrollTop;$('#html').hide();return;}$('#html').show();document.body.scrollTop=scrolltop;}function isBottom(){if($(this).scrollTop()+$(this).height()==$(document).height()){return true;}return false;}function play_download(data){var url=$.trim(data.url),name=data.name,type=data.suffix;api.actionSheet({title:name+'.'+type,cancelTitle: '取消',buttons: ['下载', '播放','复制链接','用浏览器打开']}, function(ret, err){var index = ret.buttonIndex*1;switch(index){case 1:startDownload(url,name,type);break;case 2:startPlay(url);break;case 3:copyText(url,true);break;case 4:openBrowser(url);break;default:break;}});}function songInfo(data){var urls=data.url,ar=[],i;for(i in urls){ar.push('<a data-url="'+urls[i]+'">'+i+'</a>');}$('body').append('<div class="show-box"><div id="song-info"><div class="title"><span class="song_name">'+data.song+'</span><span class="singer">'+data.singer+'</span><span class="song_time">'+data.interval+'</span><span class="song_album">'+data.album+'</span></div><div class="urls">'+ar.join('')+'</div><div class="close">&times; 关闭<span class="closebtn" style="padding:0;"></span></div></div></div>');$('#song-info .urls a').on("click",function(){$('#cur-info').attr("data-name",data.song).attr("data-singer",data.singer);$('#song-info .urls a').css({"background-color":"#000"});$(this).css({"background-color":"#00f"});getUrl($(this));return false;});$('#song-info .close').on("click",function(){if($('.closebtn').length>1){return;}$(this).parent().parent().remove();return false;});}function searchText(data){var pg=data.page,total=Math.ceil(data.totalnum/20),songList=total==0?[]:data.song_list,ar=['<ul class="search_content">'];for(var i=0,m;m=songList[i];i++){for(var j=0,singer=[],n;n=m.singer[j];j++){singer.push(n.name);}ar.push('<li data-mid="'+m.songmid+'" class="song_item"><div class="song_name">'+m.songname+'</div><div class="singer_name">'+singer.join('/')+'</div></li>');}$('#html .loadmore').remove();pg==1&&$('#html').html('');$('#html').append(ar.join('')+'</ul>'+(pg<total?'<div class="loadmore" onclick="search('+(++pg)+');">加载更多…</div>':'<div class="loadmore nomore">-- 没有了 --</div>'));}function errText(str){api.hideProgress();str=unescape(str);var json=JSON.parse(str);if(json.statusCode==404){api.toast({msg:'无法获取'});return;}api.toast({msg:json.msg.replace(/(：|:)\w+\.\w+/,'')});}function searchTextLMY(a,pg){var type={url:{index:0,text:"试听",suffix:"lrc"},url_m4a:{index:1,text:"流畅",suffix:"m4a"},url_128:{index:2,text:"标准",suffix:"mp3"},url_320:{index:3,text:"高品",suffix:"mp3"},url_flac:{index:4,text:"FLAC",suffix:"flac"},url_ape:{index:5,text:"APE",suffix:"ape"},url_dsd:{index:6,text:"Hi-Res",suffix:"flac"}};pg==1&&$('#html').empty();$('.more').remove();var ar=a.data.list,more=a.data.more*1,text="",index=pg==1?1:$('#html li').length+1;if(pg==1&&ar.length==0){api.toast({msg:"暂未搜到，请尝试其他源"});return;}for(var i=0,m;m=ar[i];i++){text+='<li style="overflow:hidden;height:auto;line-height:auto;color:#000;padding:20px 5px;" data-name="'+m.name+'" data-singer="'+m.artist+'" data-lrc="'+m.lrc+'" data-cover="'+m.cover+'"><div style="overflow:hidden;"><span style="color:#080;">'+(i+index)+'</span><span style="padding:0 10px;">'+m.name+'</span><span style="color:#777;font-size:12px;">'+m.artist+'</span></div><div style="overflow:hidden;padding:20px 0;text-align:center;">';var key,urlList=[];for(key in m){if(key in type){urlList[type[key].index]='<a data-key="'+key+'" data-url="'+m[key]+'" data-suffix="'+type[key].suffix+'" style="padding:5px 8px;margin:5px 3px;color:#777;border:1px solid #777;font-size:14px;border-radius:10px;">'+type[key].text+'</a>';}}text+=urlList.join('')+'</div></li>';}text='<ul style="border:none;background-color:#fff;color:#fff;">'+text+'</ul>';if(more==0||ar.length<more){text+='<div class="more" style="text-align:center;color:#999;height:auto;padding:20px 0;">没有了</div>';}else{pg++;text+='<div class="more" style="text-align:center;color:#333;height:auto;padding:20px 0;" data-pg="'+pg+'" onclick="search('+pg+');">加载更多...</div>';}$('#html').append(text);}</script></body></html>######.index.html======<!DOCTYPE html> <html> <head> <meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>首页</title><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"> <style type="text/css">body{background-color:#fff;padding:0,margin:0;}ul{display:-webkit-flex;display:flex;position:fixed;left:0;bottom:0;width:100%;list-style-type:none;margin:0;padding:0;overflow:hidden;border:none;background-color:#f3f3f3;z-index:9999;}li{font-size:16px;-webkit-flex:1;flex:1;display:block;text-align:center;color:#666;padding:16px 0;text-decoration:none;}.click-color{color:white;background-color:#4CAF50;}</style><script src="file:///android_asset/widget/script/jquery.min.js"></script></head><body><ul><li data-id="0"><a>VIP解析</a></li><li data-id="1"><a>影视API</a></li><li data-id="2"><a>高品音乐</a></li><li data-id="3"><a>下载管理</a></li></ul><script>var currentFrame=0,findUrlReady=true,exitTimer=false;var updateInfo={version:"1.0.11",url:"https://wwa.lanzous.com/tp/iZQD5nrvgeb",msg:'修复屏幕适配'};var playerJs='if(typeof xxtest == "undefined"){var xxtest=1,videoInfo={},videoType="",ifrUrl="",runLeft=0;var vEnd=function(){window.stop();};var openFrameUrl=function(url){var a=document.createElement("a");a.href=url;a.target="_self";document.getElementsByTagName("body")[0].appendChild(a);a.click();};var getVideoUrl=function(){var vurl=document.querySelector("video").src||document.querySelector("video>source").src;if(vurl){if(/^blob:/.test(vurl)==false){videoInfo.url=vurl;vEnd();}var vEl=document.querySelector("video");vEl.setAttribute("preload","none");vEl.removeAttribute("autoplay");vEl.muted=true;}};var videoCatch=function(){try{var vurl=document.body.innerHTML.match(/<video.*?src="([^"]+)"/)[1];alert("videocatch:"+vurl);if(vurl&&/^blob:/.test(vurl)==false){videoInfo.url=vurl;vEnd();}}catch(e){}};var getIframeUrl=function(){var ifrEl=document.querySelector("iframe[allowfullscreen]");if(!ifrEl){ifrEl=document.querySelector("iframe");var endStyle=window.getComputedStyle(ifrEl,null);var endWidth=endStyle.width.match(/\\d+/)||0,endHeight=endStyle.height.match(/\\d+/)||0;if(endStyle.display=="none"||endWidth<100||endHeight<100){return;}}var furl=ifrEl.src;if(furl){ifrUrl=furl;ifrEl.parentNode.removeChild(ifrEl);openFrameUrl(ifrUrl);}};(function(){window.confirm=window.alert=window.open=function(){return;};})();(function(){var timeoutFN=window.setTimeout;window.setTimeout=function(a,b){runLeft++;return timeoutFN(function(){runLeft--;a();},b);};var intervalFN=window.setInterval;window.setInterval=function(a,b){return intervalFN(function(){window.count=0;a();},b<1000?b:200);};var oXHR=window.XMLHttpRequest;oXHR.prototype.reallyOpen=oXHR.prototype.open;oXHR.prototype.open=function(method,url,async,user,password){if(/\\.m3u8($|\\&|\\?)/.test(url)){videoInfo.url=url;}runLeft++;this.reallyOpen(method,url,async,user,password);};window.XMLHttpRequest=function XMLHttpRequest(){var xhr=new oXHR();xhr.constructor=XMLHttpRequest;xhr.addEventListener("readystatechange",function(){if(this.readyState===4){var resText=this.response;if(resText.match(/#EXTINF:/i)){videoInfo.text=resText;if(this.responseURL){videoInfo.url=this.responseURL;}vEnd();return;}var res=JSON.parse(resText);videoType=res.type||"";if(res.hasOwnProperty("url")&&(res.url.lastIndexOf("http")==0||/^(http|\\/\\/)/.test(res.url)&&/^(hls|m3u8|mp4)$/.test(videoType))){videoInfo.url=res.url;}}},false);xhr.addEventListener("loadend",function(){runLeft--;},false);return xhr;};})();}try{getVideoUrl();}catch(e){videoCatch();}try{getIframeUrl();}catch(e){}';var videoTestJs='var count=0;videoInfo.referer=location.href;detectUrl();function vTest(){try{getVideoUrl();}catch(e){videoCatch();}return videoInfo.url;}function ifrTest(){try{getIframeUrl();}catch(e){}return ifrUrl;}function detectUrl(){if(videoInfo.text){jxReady();}else if(videoInfo.url){videoTest();}else if(ifrUrl){openFrameUrl(ifrUrl);}else if(vTest()){videoTest();}else if(runLeft>0||count<10){getFrameUrl();}else{jxReady();}}function getFrameUrl(){var url=ifrTest();if(url){return;}else if(count<60){count++;videoTimer=setTimeout(detectUrl,200);}else{jxReady();}}function jxReady(){api.sendEvent({name:"webBrowserFinish"+(frameName||""),extra:videoInfo});}function videoTest(){videoInfo.requestM3u8=0;var detectVideoUrl=videoInfo.url;if(detectVideoUrl.indexOf("//")==0){videoInfo.url=detectVideoUrl=window.location.protocol+detectVideoUrl;}if(/(hu123|tv920|nn69|htv009|bjtjr|0ju|dianyingguan|52239790|yaohuaxuan|yunboys|adinisp|cuan|shunyiwenxiu|we111|snrtsm|gms.lighting|parwix|janan|h2vcdn|omeiju|rhino\\-ts|webcg|laobandq|f41|voooe|gms\\-lighting|ciccczn|iwangxiao|cdnnodedns|fanyalvzhou|diyiqiang|ahfuqi|taifagroup|xuetuiguang|my123456|88wuma|aidouer|hqmbsh|ccyjjd|truechat365|rongxingvr|37581|byteamone|msdv|baidus|viplanguang|renrenmi|jianjians|8old|jingyuxitong|52e|nitian|2oc|hs-mould|zhegeyuming|baoju|qilin)\\.(com|net|cc|cn|top|la|xyz|org|live|info|vip|best)/.test(detectVideoUrl)){if(videoType&&/^(hls|m3u8)$/.test(videoType)||/\\.m3u8($|\\?|\\&)/.test(detectVideoUrl)){videoInfo.requestM3u8=1;requestM3u8(detectVideoUrl);}else{videoInfo.requestM3u8=2;jxReady();}return;}jxReady();}function requestM3u8(url){try{var xmlHttp=null;if(XMLHttpRequest){xmlHttp=new XMLHttpRequest();}else{xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");}xmlHttp.open("GET",url,true);xmlHttp.timeout=5000;xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4&&xmlHttp.status==200){if(xmlHttp.responseText){videoInfo.text=xmlHttp.responseText;}jxReady();}};xmlHttp.onloadend=function(){if(xmlHttp.status!=200){jxReady();}};xmlHttp.send(null);}catch(e){jxReady();}}';var functionJs='api.addEventListener({name:"leduovip"},function(ret,err){closePlayer();var vid=ret.value.url.match(/[&\\?](vid|url)=([^&]*)/);if(vid&&vid[2]){vid[1]=="vid"?getPlayUrl(vid[2]):isM3u8(decodeURIComponent(vid[2]));}else{jxError();}});api.addEventListener({name:"webBrowserFinish"+api.frameName},function(ret,err){var opt=ret.value;if(opt.text){completeData(opt.url||"m3u8file"+(new Date().getTime()),opt.text);}else if(opt.url){var requestM3u8=opt.requestM3u8,purl=opt.url;if(requestM3u8==0){url2play(purl);}else if(requestM3u8==1){apiAjax(purl,opt.referer);}else{api.ajax({url:purl,method:"head",headers:{Referer:opt.referer},timeout:5},function(ret,err){if(ret&&/mpegurl|text/i.test(ret["Content-Type"])==false||err){api.accessNative({name:"getRealUrl",extra:{url:purl}},function(ret,err){url2play(ret.url);});}else{apiAjax(purl,opt.referer);}});}}else{jxError();}});function openUrl(url,referer){api.sendEvent({name:"openWebBrowser",extra:{url:url,referer:referer,frameName:api.frameName}});return;api.openFrame({name: "player",url:url,reload:true,headers:{Referer:(referer==1&&url.match(/^http.{4,}?\\//)||referer||"")},rect:{x:0,y:35,w:"auto",h:0}});}function apiAjax(url,referer){api.ajax({url:url,method:"get",dataType:"text",timeout:5,headers:{"User-Agent":navigator.userAgent,Referer:referer||location.href}},function(ret,err){completeData(url,ret);});}function completeData(url,ret){if(!ret){jxError();return;}try{var mArr=ret.match(/\\s+([^#\\s]+)(#+\\w+)?/),m3u8=mArr[1]||"";}catch(e){jxError();}if(/^(https?:)/.test(m3u8)||m3u8==""){var baseUrl="";}else if(m3u8.indexOf("//")==0){var baseUrl=url.split(":")[0]+":";}else if(m3u8.indexOf("/")==0){var baseUrl=url.match(/^.{8}[^\\/]+/);}else if(m3u8.indexOf("../")==0){var ml=m3u8.split("/")[1],baseUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);ret=ret.replace(/(\\s+)\\.\\.\\//g,"$1");}else{var baseUrl=url.substr(0,url.lastIndexOf("/")+1);(m3u8.indexOf("./")==0)&&(ret=ret.replace(/(\\s+)\\.\\//g,"$1"));}if(ret.indexOf("ENDLIST")==-1){apiAjax(baseUrl+m3u8,url);return;}var m3u8FileName=url.replace(/[^\\w]*/g,"").substr(-32);var isReady=true;ret=ret.replace(/#EXT-X-DISCONTINUITY(?:\\r\\s|\\s)/g,"");if(/uri\\s?=\\s?"/i.test(ret)){ret=ret.replace(/(uri\\s?=\\s?")([^"]+)/i,function(a,a1,a2){if(a2.indexOf("http")==0){var baseUrl="";}else if(a2.indexOf("//")==0){var baseUrl=url.split(":")[0]+":";}else if(a2.indexOf("/")==0){var baseUrl=url.match(/^.{8}[^\\/]+/);}else if(a2.indexOf("../")==0){var ml=a2.split("/")[1],baseUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);a2=a2.substr(3);}else{var baseUrl=url.substr(0,url.lastIndexOf("/")+1);(a2.indexOf("./")==0)&&(a2=a2.substr(2));}var keyPath="http://127.0.0.1:8080/UZMap/A6003463152993/.m3u8/"+m3u8FileName+".key";api.accessNative({name:"httpDownload",extra:{url:baseUrl+a2,savePath:api.fsDir+"/.m3u8/"+m3u8FileName+".key",allowResume:false,report:false}},function(ret,err){if(isReady==false){isReady=true;return;}url2play("http://127.0.0.1:8080/UZMap/A6003463152993/.m3u8/"+m3u8FileName+".m3u8");});return a1+keyPath;});}if(baseUrl||mArr[2]){ret=ret.replace(/(\\s+)([^#\\s]+)(#+\\w+)?/g,"$1"+baseUrl+"$2");}ret=ret.replace(/\\s+/g,"\\n");if(/my123456\\.cn/.test(baseUrl+m3u8)){ret=ret.replace(/https:/g,"http:");}api.writeFile({path:"fs://.m3u8/"+m3u8FileName+".m3u8",data:ret},function(ret,err){if(ret.status){if(isReady==false){isReady=true;return;}url2play("http://127.0.0.1:8080/UZMap/A6003463152993/.m3u8/"+m3u8FileName+".m3u8");}});}function closePlayer(){api.sendEvent({name:"closePlayer",extra:{frameName:api.frameName}});}function url2play(url){closePlayer();api.hideProgress();downloadShow(url);startPlay(url);}function jxError(){closePlayer();api.hideProgress();api.toast({msg:"解析失败，请切换线路"});}function startPlay(url){if(/(vip|api).html/.test(location.href)&&/\\.m3u8($|\\?|\\&)/.test(url)||/tc\\.qq\\.com/.test(url)==false){systemPlayer(url.replace(/^https:/,"http:"));return;}closePlayer();api.accessNative({name:"TBSPlayer",extra:{url:url,screenMode:103}},function(ret,err){if(ret&&ret.value){return;}systemPlayer(url);});}function systemPlayer(url){closePlayer();api.appInstalled({appBundle:"com.tencent.mtt"},function(ret,err){api.toast({msg:"即将打开系统视频播放器"+(ret.installed&&"\\n推荐选择「播霸-QQ浏览器」"||""),duration:5000,global:true});});api.openVideo({url:url});}function downloaderExist(){if(JSON.stringify(api.frames()).indexOf("downloader")!==-1){return true;}return false;}function startDownload(url,title,type){if(downloaderExist()){var js=\'addToList("\'+url+\'","\'+title+\'","\'+type+\'");\';api.execScript({frameName:"downloader",script:js});return;}openDownload({url:url,title:title,type:type});}function openDownload(opt){api.setGlobalData({key:"downloaderParam",value:opt});api.execScript({name:"root",script:\'$("ul>li").get(3).click();\'});}function openBrowser(url){api.openApp({androidPkg:"android.intent.action.VIEW",uri:url},function(ret,err){if(!ret){api.toast({msg:err.msg});}});}function copyText(text,tips){var clipBoard=api.require("clipBoard");clipBoard.set({value:text},function(ret,err){if(ret){tips&&api.toast({msg:"复制成功"});return;}api.toast({msg:err.msg});});}(function(){var fixStatusBar=function(el){el.style.paddingTop=api.safeArea.top+"px";return el.offsetHeight;};if(api.statusBarAppearance){switch(api.frameName){case "vip":fixStatusBar(document.getElementById("ifr"));fixStatusBar(document.getElementById("pt"));break;case "api":fixStatusBar(document.getElementById("ifr"));fixStatusBar(document.getElementById("ptitle"));break;case "music":fixStatusBar(document.getElementsByClassName("search-box")[0]);break;case "downloader":fixStatusBar(document.getElementById("downloadList"));break;}}api.addEventListener({name:api.frameName+"keyback"},function(ret,err){api.historyBack({frameName:api.frameName},function(ret,err){if($(".closebtn").is(":visible")){$(".closebtn").click();return;}if(!ret.status){api.execScript({name:"root",script:"exitApp();"});}});});if($("#ads").length>0){$("#ads").prepend(\'<a style="display:block;width:100%;padding:0.1rem 0;background:#fff;color:#0a1a2a;text-align:center;font-size:0.12rem;">关注微信公众号<span style="color:#080;">kongbuyy</span>不迷路</a>\');var alipayOpen=localStorage.getItem("alipayOpen"),day=new Date().getDate();if(alipayOpen==null||alipayOpen!=day){api.appInstalled({appBundle:"com.eg.android.AlipayGphone"},function(ret,err){if(ret.installed){var el=document.querySelector("#ads>a");el.innerHTML="你的专属福利来啦";el.onclick=function(){api.toast({msg:"即将打开「支付宝」领取红包"});localStorage.setItem("alipayOpen",day);window.open("alipays://platformapi/startapp?appId=20000067&url=https://qr.alipay.com/11w131901uxak2xchz41kcb","_self");el.onclick=null;};el.style.fontSize="0.16rem";el.style.color="green";}});}}})();';var MS='\x68\x74\x74\x70\x3a\x2f\x2f\x6d\x75\x73\x69\x63\x2e\x6d\x6f\x72\x65\x73\x6f\x75\x6e\x64\x2e\x74\x6b\x2f',LMY='\x68\x74\x74\x70\x3a\x2f\x2f\x74\x6f\x6f\x6c\x2e\x6c\x69\x75\x6d\x69\x6e\x67\x79\x65\x2e\x63\x6e\x2f\x6d\x75\x73\x69\x63\x2f';function executeSql(sql){var db=api.require('db');db.executeSql({name:'downloader',sql:sql},function(ret,err){if(!ret||ret.status==false){api.toast({msg:err.msg});}});}function openDatabase(){var db=api.require('db');db.openDatabase({name:'downloader'},function(ret,err){if(ret.status){executeSql('CREATE TABLE IF NOT EXISTS downloadsInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),title varchar(255),type varchar(255),size int,status int,pid int)');executeSql('CREATE TABLE IF NOT EXISTS downloadInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),title varchar(255),type varchar(255),path varchar(255),status int)');executeSql('CREATE TABLE IF NOT EXISTS apiInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),name varchar(255))');executeSql('CREATE TABLE IF NOT EXISTS vipInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),name varchar(255),ref varchar(255))');}else{api.toast({msg:err.msg});}});}function openAlipay(){$('body').prepend('<div id="alipayHongbao" style="position:fixed;top:0;left:0;width:100%;height:100%;font-size:14px;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;z-index:9;"><div style="text-align:center;">微信扫描二维码关注公众号</div><div style="text-align:center;"><img width="50%"/></div><div style="text-align:center;"><a style="display:none;color:#fff;background-color:#090;padding:10px;border-radius:5px;">保存到相册</a></div></div>');var url='https://bj.bcebos.com/im-cs/1e6e8bc32ec7f826f24df8a13b7f773d.jpg',savePath=api.fsDir+"/kongbuyy_wx_pic.jpg";var apiFs=api.require('fs');var cb=apiFs.existSync({path:savePath});if(cb.exist){$('#alipayHongbao img').attr('src',savePath);$('#alipayHongbao a').show();}else{api.accessNative({name:"httpDownload",extra:{url:url,savePath:savePath,allowResume:false,report:false}},function(ret,err){if(ret.status==2){$('#alipayHongbao img').attr('src',url);return;}$('#alipayHongbao img').attr('src',savePath);$('#alipayHongbao a').show();});}$('#alipayHongbao a').on('click',function(){api.saveMediaToAlbum({path:savePath},function(ret,err){api.toast({msg:ret&&ret.status&&'保存成功'||err.msg});});});}function deleteDir(){var fs=api.require('fs');fs.rmdir({path:'fs://.m3u8'},function(ret,err){});fs.rmdir({path:'fs://.html'},function(ret,err){});}function appRequestPermission(){var resultList=api.hasPermission({list:['storage']});if(resultList[0].granted==false){api.requestPermission({list:['storage']},function(ret,err){if(ret.list[0].granted==false){api.toast({msg:'没有存储权限，应用可能无法正常运行',duration:5000});}});}}function downloadDir(){var fs=api.require('fs');fs.exist({path:'fs://download'},function(ret,err){if(!ret.exist || !ret.directory){fs.createDir({path:'fs://download'},function(ret,err){});}});}function openBrowser(url){api.openApp({androidPkg:"android.intent.action.VIEW",uri:url},function(ret,err){if(!ret){api.toast({msg:err.msg});}});}function openUpdateWin(url){api.openWin({name:'updateWin',url:url,bgColor:'#ff0',bounces:false});return false;}function newAppTest(){var Version=updateInfo.version,msg=updateInfo.msg;if(api.appVersion != Version){api.confirm({title:'版本更新'+Version,msg:msg,buttons:['复制链接','用浏览器下载']},function(ret,err){var url=updateInfo.url;$('body').append('<div style="background:rgba(0,0,0,0.7);position:fixed;top:0;left:0;width:100%;height:100%;text-align:center;"><a onclick="openBrowser(\''+url+'\')" style="display:block;color:#fff;padding:10px;margin-top:'+api.winHeight/2+'px;">请升级到最新版本'+Version+'</a></div>');if(ret.buttonIndex==1){var clipBoard=api.require("clipBoard");clipBoard.set({value:url},function(ret,err){if(ret){api.toast({msg:"复制成功"});return;}api.toast({msg:err.msg});});}else if(ret.buttonIndex==2){openBrowser(url);}});}}function openHideFrame(name,url){api.openFrame({name:name,url:url,reload:true,bgColor:'#fff',rect:{x:0,y:0,w:0,h:0}});}function apiClosePlayer(){api.closeFrame({name:"player"});apiWebBrowser.closeView();}function openWebBrowser(opt){var timeoutId=setTimeout(function(){api.hideProgress();apiClosePlayer();api.toast({msg:'超时，请切换线路'});},60*1000);var url=opt.url,referer=opt.referer;var js='';if(/leduotv.com/.test(url)){var vid=url.match(/url=([^&]*)$/);vid=vid&&vid[1]||"";js='var vid="'+vid+'";var script=document.createElement("script");script.src="https://cdn.jsdelivr.net/gh/cdn-npm/npm/de.js";document.getElementsByTagName("body")[0].appendChild(script);script.onload=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){var url=deurl(vid);api.sendEvent({name:"leduovip",extra:{url:url}});}};';}apiWebBrowser.openView({url:url,headers:{Referer:(referer==1&&url.match(/^http.{4,}?\//)||referer||"")},rect:{x:-250,y:-250,w:200,h:200}},function(ret,err){switch (ret.state){case 0:break;case 1:apiWebBrowser.loadScript({script:playerJs});break;case 2:apiWebBrowser.loadScript({script:'var frameName="'+opt.frameName+'";'+videoTestJs+js});clearTimeout(timeoutId);break;case 3:break;case 4:break;default:break;}});}function loadFrame(){var info=[{name:'vip',url:'.vip.html'},{name:'api',url:'.api.html'},{name:'music',url:'.music.html'},{name:'downloader',url:'.downloader.html'}];var ulHeight=$('ul').get(0).offsetHeight+'px';var open=function(opt){api.openFrame({name:opt.name,url:opt.url,reload:false,allowEdit:true,bgColor:'#ff0',rect:{marginLeft:0,marginTop:0,marginBottom:ulHeight,marginRight:0},progress:{type:'page',color:'#f00',height:3}});};$('ul').on('click','li',function(){var i=$(this).attr('data-id');currentFrame=info[i].name;open(info[i]);$('ul').find('.click-color').removeClass('click-color');$(this).addClass('click-color');});}function findUrlEnd(url){if(/https?:\/\/59\.110\.45\.28\//.test(url)){api.closeFrame({name:"findUrl"});if(findUrlReady==true){api.sendEvent({name:"findUrlReady",extra:{url:url}});findUrlReady=false;}}}function exitApp(){if(exitTimer){api.closeWin();return;}api.toast({msg:"再次点击将退出APP",duration:3000,global:true});exitTimer=true;setTimeout(function(){exitTimer=false;},3000);}apiready=function(){loadFrame();appRequestPermission();window.apiWebBrowser=api.require('webBrowser');api.connectionType=='none'&&api.toast({msg:'您暂未联网'});api.addEventListener({name:'online'},function(ret, err){api.toast({msg:'已连接到网络'});});api.addEventListener({name:'offline'},function(ret, err){api.toast({msg:'网络已断开'});});api.setFrameClient({frameName:'LMY'},function(ret,err){switch (ret.state){case 0:break;case 1:api.execScript({frameName:'LMY',script:'try{var ul=document.getElementsByTagName("ul")[0];ul.parentNode.removeChild(ul);}catch(e){}'});break;case 2:api.setGlobalData({key:'LMYReady',value:1});var js='var mainRetry=0,errorRetry=0,retryTimer=null;getMainJs();function getMainJs(){if(++mainRetry>20){retryTimer&&clearTimeout(retryTimer);musicReady();return;}try{var js=localStorage.getItem("js.main");js=JSON.parse(js);js=js.match(/var\\s+_0xodO\\s*=\\s*(\'|")(.*?)\\1[\\s\\S]+?\\1\\2\\1\\s*;/);js&&insertJsText(js[0]);musicReady();}catch(e){retryTimer=setTimeout(getMainJs,500);}}function insertJsText(str){var script=document.createElement("script");script.text=str;document.body.appendChild(script);}function errorRequest(){errorRetry++;var errorInfos={url:"https://cdn.jsdelivr.net/gh/hsy35/kongbuyy/errorText.txt",version:"20210506"};var text=localStorage.getItem("errorMain"),version=localStorage.getItem("errorVersion");if(text!=null&&version!=null&&version==errorInfos.version){insertJsText(text);return;}api.ajax({url:errorInfos.url,method:"get",dataType:"text",timeout:10},function(ret,err){if(ret){localStorage.setItem("errorVersion",errorInfos.version);localStorage.setItem("errorMain",ret);insertJsText(ret);}});}function musicReady(){var ok=1;try{encode(ok);}catch(e){ok=-1;if(errorRetry<1){errorRequest();return;}}retryTimer=null;api.sendEvent({name:"MSReady",extra:{ok:ok}});}function musicRequest(url,method,values,type){$.ajax({type:"POST",url:url,data:encode(JSON.parse(values)),timeout:10000,complete:function(r,s){if(s=="timeout"){api.execScript({frameName:"music",script:"api.toast({msg:\'超时，请重试\'});api.hideProgress();"});}},success:function(a){api.execScript({frameName:"music",script:(a.code==200?"resultLMY(\'"+escape(JSON.stringify(a))+"\',\'"+type+"\');":"api.toast({msg:\'请求失败，请重试\'});")+"api.hideProgress();"});}});}';api.execScript({frameName:'LMY',script:js});break;case 3:break;case 4:break;default:break;}});openHideFrame('LMY',LMY);api.setFrameClient({frameName:'findUrl'},function(ret,err){switch (ret.state){case 0:findUrlEnd(ret.url);break;case 2:api.hideProgress();api.toast({msg:"解析出错"});break;case 4:findUrlEnd(ret.url);break;default:break;}});api.setFrameClient({frameName:'vip'},function(ret,err){if(ret.state==2){api.execScript({frameName:'vip',script:functionJs});}});api.setFrameClient({frameName:'api'},function(ret,err){if(ret.state==2){api.execScript({frameName:'api',script:functionJs});}});api.setFrameClient({frameName:'music'},function(ret,err){if(ret.state==2){api.execScript({frameName:'music',script:functionJs});}});api.setFrameClient({frameName:'downloader'},function(ret,err){if(ret.state==2){api.execScript({frameName:'downloader',script:functionJs});}});api.setFrameClient({frameName:'player'},function(ret,err){if(ret.state==1){api.execScript({frameName:'player',script:playerJs});}if(ret.state==2){api.execScript({frameName:'player',script:videoTestJs+functionJs});}});api.addEventListener({name:'openWebBrowser'},function(ret,err){openWebBrowser(ret.value);});api.addEventListener({name:'closePlayer'},function(ret,err){apiClosePlayer();});api.addEventListener({name:'keyback'},function(ret,err){api.hideProgress();apiClosePlayer();if(/(vip|api|music|downloader)/.test(JSON.stringify(api.frames()))==false){exitApp();return;}api.sendEvent({name:currentFrame+'keyback'});});newAppTest();openAlipay();downloadDir();openDatabase();deleteDir();api.accessNative({name:"startVideoServer"},function(ret,err){});api.accessNative({name:"setBackgroundColor"},function(ret,err){});};</script></body></html>######.vip.js======var vip={selected:1},scrolltop=0,timeoutID='',pgNum=1,h=3,vipLines={urls:["https://vip.xrff.xyz/?url=","https://jhpc.manduhu.com/?url=","https://api.leduotv.com/wp-api/ifr.php?vid=","https://jxx.yuxidy.cn/?url=","vipManager"],name:["线路：A","线路：B","线路：C","线路：D","-- VIP解析接口管理 --"],ref:["1","1","1","1","0"]},vipSelected=vipLines.urls[0];apiready=function(){api.sendEvent({name:'frameOnload',extra:{name:api.frameName}});doubanRequest();local2dataBase();initVipLines();};function doubanRequest(){$('#movie').html('数据载入中…');var d= new Date();var m=d.getMonth()+1,dd=d.getDate();var riqi=d.getFullYear()+"-"+(m.length==1?"0"+m:m)+"-"+(dd.length==1?"0"+dd:dd);var url='https://d.guduodata.com/m/newRank/list/today_divide?category=DRAMA&date='+riqi+'&orderTitle=gdi&orderType=asc&platformId=0&t='+(new Date().getTime());api.ajax({url:url,method:'get',tag:'hotTV',timeout:15,dataType:'json',headers:{Referer:'https://d.guduodata.com/'}},function(ret,err){if(ret){hotTV(ret);}else{$('#movie').html('<span style="color:#fff;padding:10px;" onclick="doubanRequest();">点击重新获取</span>');}});}function downloadShow(url){$('#download').attr("data-url",url).show();}function DownloadButton(url,title,type){api.actionSheet({title:$('#ptitle atitle').text()+' '+$('#ptitle playNumber').text(),cancelTitle: '取消',buttons: ["下载","播放","复制链接","用浏览器打开"]}, function(ret, err){var index=ret.buttonIndex;switch (index){case 1:startDownload(url,title,type);break;case 2:startPlay(url);break;case 3:copyText(url,true);break;case 4:openBrowser(url);break;default:break;}});}function html_(){var htm=['<div id="ifr" style="position:relative;overflow:hidden;background-color:#0a1a2a;padding:10px 0;"><div id="pt"><div class="top-box"><a id="line" data-line="0">线路1</a><span id="ptitle"></span><a id="download">下载/播放</a></div></div><div id="movie"></div></div><div id="ads" style="clear:both;padding:2px 0;position:relative;"></div>','<input type="text" value="" id="url" style="display:none;"/><div class="search-box"><a id="s_record" class="search-history">搜索历史</a><input class="search-input" type="text" id="word" placeholder="视频名搜索/视频网址解析" onkeydown="FSubmit(event.keyCode||event.which);"/><a onclick="show();" class="search-btn">搜索</a></div><div style="position:relative;"><div id="search_record"><div class="search_items" style="overflow:hidden;padding:0.1rem 0;"></div></div></div><div id="tuijian" style="padding:0.2rem 0.1rem;"><a style="padding:0.1rem;" data-show=".searchList" data-hide=".sdgj,.sjzk,.khdd">搜索</a><a style="padding:0.1rem;" data-show=".sdgj" data-hide=".searchList,.sjzk,.khdd" data-id="TOPC1451540709098112">深度国际</a><a style="padding:0.1rem;" data-show=".sjzk" data-hide=".sdgj,.searchList,.khdd" data-id="TOPC1451558687534149">世界周刊</a><a style="padding:0.1rem;" data-show=".khdd" data-hide=".sdgj,.sjzk,.searchList" data-id="TOPC1571021323137369">科幻地带</a></div><div class="searchList"></div><div class="sdgj"></div><div class="sjzk"></div><div class="khdd"></div><p class="footer">温馨提示：理论上支持优酷、乐视、芒果、奇艺、腾讯、搜狐等VIP视频免费观看！<span>播放不完整或失败？请点击顶部“线路”切换播放！</span>微信公众号：kongbuyy</p><span class="top"><a href="javascript:scrollTo(0,0);">TOP</a><a href="javascript:dingw();">选集</a></span><textarea id="data" style="display:none;">{}</textarea><div id="api_gl" style="width:100%;height:100%;position:fixed;top:0;left:0;display:none;z-index:99999999999;"><div style="width:100%;height:100%;position:absolute;top:0;left:0;display:-webkit-flex;display:flex;align-items:center;justify-content:center;"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1;" onclick="api_gl_close()"></div><div id="zidingyi" style="overflow-y:auto;max-height:70%;width:100%;background-color:yellow;border:0;z-index:9999999999;padding:0.1rem 0;position:relative;"><div style="position:relative;padding:0.1rem 0 0.2rem;font-size:0.14rem;text-align:center;">自定义线路</div><div style="position:relative;"><div style="display:block;margin-right:0.6rem;"><input id="line_url" style="box-sizing:border-box;height:0.4rem;font-size:0.12rem;width:100%;border:0;padding:0.05rem;" type="text" placeholder="长按粘贴视频解析接口：http://xxxxx/?url="/></div><div style="position:absolute;right:0;top:0;width:0.6rem;"><a href="javascript:line_add();" style="display:block;width:0.6rem;height:0.4rem;line-height:0.4rem;font-size:0.14rem;text-align:center; background:green;color:#fff;">添加</a></div></div><div id="url_list"></div><span class="closebtn" style="position:absolute;top:0;right:0;color:#333;font-size:0.22rem;padding:0.1rem;" onclick="api_gl_close()">&times</span></div></div></div>'];$('body').prepend(htm[0]).append(htm[1]);ifrHeight=document.getElementById('ifr').offsetHeight;}(function (doc, win) {var docEl = doc.documentElement,resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',recalc = function () {var clientWidth = docEl.clientWidth;if (!clientWidth) return;if(clientWidth>=640){docEl.style.fontSize = '100px';}else{docEl.style.fontSize = 177.78*(clientWidth / 640) + 'px';}};if (!doc.addEventListener) return;win.addEventListener(resizeEvt, recalc, false);doc.addEventListener('DOMContentLoaded', recalc, false);})(document, window);function suggestWords(){$('#words').remove();var word=$('#word').val();if(!word){return;}var url='http://suggest.video.iqiyi.com/?key='+encodeURIComponent(word)+'&if=mobile&platform=31&ppuid=&callback=?';$.getJSON(url,function(e){$('#words').remove();var m=e.data,e=[];if(m.length===0){return;}m.length=6;for(var i=0,ar;ar=m[i];i++){e.push('<a style="display:inline-block;color:#000;background-color:#fff;margin:0.03rem 0.03rem;padding:0.05rem 0.1rem;border-radius: 0.1rem;" href="javascript:;">'+ar.name+'</a>');}$('#ads').append('<div id="words" style="padding:0.02rem 0;text-align:center;background-color:#333;z-index:999999999;'+($('#ads').height()?'position:absolute;':'')+'bottom:0;">'+e.join('')+'</div>');$('#words a').on("click",function(){$('#word').val($(this).text());show();return false;});});}function hotTV(json){var arr=json.data||[];var str="";for(var i=0,len=arr.length;i<len;i++){var info=arr[i];str+='<a href="javascript:;"'+(i>26?'style="display:none;"':'')+' data-qiyi="'+(/logo_aiqiyi/.test(JSON.stringify(info.platformImgs))?1:0)+'">'+info.name+'</a>';}$('#movie').html('近期国产剧推荐：'+str);$('#movie a').on("click",function(){$('#word').val($(this).text());show();return false;});}function tuijian(){$('#tuijian a').on("click",function(){var el=$(this);var showEl=el.attr("data-show"),hideEl=el.attr("data-hide"),id=el.attr("data-id");$(hideEl).hide();$(showEl).fadeIn(200);$('#tuijian a').removeClass('tab-item-selected');el.addClass('tab-item-selected');if(showEl=='.searchList'){show();return false;}if(el.attr("data-loaded")){return false;}$(showEl).html('<div id="loadmore" style="padding:0.1rem 0;background-color:#eee;font-size:0.14rem;text-align:center;">'+el.text()+' 数据加载中…</div>');api.ajax({url:'https://api.cntv.cn/NewVideo/getVideoListByColumn?id='+id+'&n=20&sort=desc&p=1&mode=0&serviceId=tvcctv',method:'get',tag:'search',timeout:5,dataType:'text'},function(ret,err){el.attr("data-loaded",1);tuijian_info(showEl,ret);});return false;});$(".sdgj,.sjzk,.khdd").on("click","a",function(){var el=$(this);var url=el.attr("href");if(url==''){return false;}$("#url").val(url);startPlayer(el);return false;});}function tuijian_search_selected(){$('#tuijian a').removeClass('tab-item-selected');$('#tuijian a[data-show=".searchList"]').addClass('tab-item-selected');$('.sdgj,.sjzk,.khdd').hide();$('.searchList').fadeIn(200);}function tuijian_info(showEl,str){str=JSON.parse(str);var ar=str.data.list,list=[];for(var j=0,m;m=ar[j];j++){list.push('<div class="main-box" data-title="'+m.title+'" data-docid="" data-series="" data-channel="" data-date=""><a href="'+m.url+'" id="tuijian'+j+'" class="content-box"><div class="img-box" style="width:1.6rem;height:0.9rem;">'+img_(m.image.replace(/^\/\//,'http://'),'100%','0.9rem')+'<span class="cover-layer"></span><span class="duration">'+m.length+'</span></div><div class="title-box"><span class="atitle" style="color:#0a1a2a;">'+m.title+'</span><span class="ainfos" style="font-size:0.12rem;">'+m.time+'</span></div></a></div>');}$(showEl).html(list.join(''));}function listener(){$('#download').on("click",function(){var url=$(this).attr("data-url"),title=$('#ptitle atitle').text()+' '+$('#ptitle playNumber').text(),type=url.indexOf('.m3u8')!==-1?'m3u8':'mp4';DownloadButton(url,title,type);return false;});$('#line').on("click",function(){var el=$(this),i=vipLines.urls.indexOf(el.attr("data-line")),names=vipLines.name.slice();names.splice(i,1,'*  '+vipLines.name[i]);api.actionSheet({title:'VIP解析接口',cancelTitle: '取消',buttons:names},function(ret,err){var index=ret.buttonIndex-1;if(index<vipLines.name.length){var url=vipLines.urls[index];if(url==el.attr("data-line")){return;}if(url=='vipManager'){api_gl_show();return;}el.text(vipLines.name[index]).attr("data-line",url).attr("data-ref",vipLines.ref[index]);vipSelected=url;$('#download').hide();ifr($('#url').val(),url);}});return false;});$('#ptitle').on("click",function(){dingw();});$("#s_record").on('click',function(){sRecord();});$('#word').on("input",function(){suggestWords();});$(".searchList").on("click",".img-box",function(){$(this).find('.update-schedule').slideToggle();}).on("click","a",function(){var el=$(this);var url=el.attr("href");if(url==''){return false;}$("#url").val(url);startPlayer(el);if(el.attr("title")){$("#titl").remove();if(timeoutID){clearTimeout(timeoutID);}el.append('<div id="titl" style="position: absolute;z-index:99;background:#ff6;color:black;font-size:0.12rem;line-height:0.16rem;">'+el.attr("title")+'</div>');timeoutID=setTimeout(function (){$("#titl").remove();},5000);}return false;});$("#url_list").on("click","a",function(){var url=$(this).parent().attr("data-url");$('#line_url').val(url);}).on("click",".delete-btn",function(){var el=$(this).parent();var url=el.attr("data-url"),name=el.find('a').text(),a=$('#line').attr("data-line");if (confirm("确定删除："+name+" ？")==false){return false;}if(a==url){vipSelected=vipLines.urls[0];$('#line').attr("data-line",vipLines.urls[0]).attr("data-ref",vipLines.ref[0]).text(vipLines.name[0]);}executeSqlSync('delete from vipInfo where url = "'+url+'"');updateList(getApiInfo('SELECT * FROM vipInfo'));var i=vipLines.urls.indexOf(url);vipLines.urls.splice(i,1);vipLines.name.splice(i,1);vipLines.ref.splice(i,1);});}$(document).ready(function(){html_();listener();tuijian();var str=localStorage.getItem('vip_search');if(str){$('#word').val(JSON.parse(str)[0]);}});function s_fuli(){$('.searchList').html('<p class="fuli">关注本站微信公众号，回复“'+$('#word').val()+'”获取福利API地址，在本APP“影视资源API”中添加即可观看</p>');}function fuli(url){api.execScript({name:'root',script:'loadFrame(\''+url+'\');'});return false;}function img_(url,w,h1){var imgid=Math.random(),frameid ='frameimg' + imgid;window['img'+imgid] = '<img src=\''+url+'\' width="100%" height="100%" />';return '<iframe id="'+frameid+'" src="javascript:parent[\'img'+imgid+'\'];" frameborder="0" scrolling="no" border="0" marginwidth="0" marginheight="0" style="width:'+w+';height:'+h1+';"></iframe>';}window.onscroll=function(){var t=document.documentElement.scrollTop||document.body.scrollTop;var top=$('.top a').first();$('#pt').css({"top":(t>10&&"0px"||"-1rem")});t>api.winHeight&&top.show()||top.hide();};function dingw(){var tv=$('.searchList a[name=dingw]').parent('.urls');if(tv.length>0){tv.parent().show();}document.getElementsByName('dingw')[0].scrollIntoView();window.scrollBy(0,api.winHeight/-2);}var player={"show":function(){$('.top a').last().show();},"hide":function(){api.hideProgress();closePlayer();$('.top a').last().hide();}},site={"ok":0,"acfun":function (line,url){if(/ac=/.test(url)){var m=url.match(/ac=(\d+)/);url='http://www.acfun.tv/v/ac'+m[1];}this.play(line,url);},"bilibili":function (line,url){if(/mobile/.test(url)){var m=url.match(/\/av(.*?)\.html/);url='http://www.bilibili.com/video/av'+m[1]+'/';}this.play(line,url);},"letv":function (line,url){this.le(line,url);},"le":function (line,url){if(/m\./.test(url)){var m=url.match(/vplay_(.*?)\./);url='http://www.le.com/ptv/vplay/'+m[1]+'.html';}this.play(line,url);},"mgtv":function (line,url){if(/m\./.test(url)){if(/play\//.test(url)){this.geturl(line,url);return;}var m=url.match(/b\/(\d+)\/(\d+)/);url='http://www.mgtv.com/b/'+m[1]+'/'+m[2]+'.html';}this.play(line,url);},"m1905":function (line,url){this.geturl(line,url);},"1905":function (line,url){this.geturl(line,url);},"qq":function (line,url){var m,v;if(/m\./.test(url)){url=url+'&';if(/\/cover\//.test(url)){m=url.match(/\/cover\/.{2}(.*?)\.html/);}else{m=url.match(/cid=(.*?)\&/);}v=m[1];if(/vid=/.test(url)){m=url.match(/vid=(.*?)\&/);url='http://v.qq.com/x/cover/'+v+'/'+m[1]+'.html';}else{url='http://v.qq.com/x/cover/'+v+'.html';}}this.play(line,url);},"sohu":function (line,url){if(/m\./.test(url)){if(/\/n/.test(url)){url=url.replace('m.','');}else{this.geturl(line,url);return;}}this.play(line,url);},"youku":function (line,url){if(/m\./.test(url)){var m=url.match(/id_(.*?)\.html/);url='http://v.youku.com/v_show/id_'+m[1]+'.html';}this.play(line,url);},"geturl":function (line,url){this.play(line,url);},"play":function (line,url){closePlayer();api.showProgress({title: '解析中',text: '',modal: false});if(url.indexOf('.mp4')!==-1){url2play(url);return;}if(/(?:leduotv|manduhu|xrff)\.(?:com|xyz)/.test(line)){requestJson(line,url);return;}openUrl(line+url+'&t='+Math.random(),this.ok);return;}};function requestJson(line,url){api.ajax({url:line+url,method:"get",dataType:"text",timeout:10},function(ret,err){if(/leduotv\.com/.test(line)){var vid=ret.match(/url1\s*=\s*['"](.*?)['"]/);openUrl(vid?"https://api.leduotv.com/404.html?url="+vid[1]:"https://okjx.cc/?url="+url,1);}else{var vid=ret.match(/url(?:s?|['"])\s*(?:=|\:)\s*['"](.*?)['"]/);if(vid){isM3u8(vid[1]);}else{openUrl((/xrff\.xyz/.test(line)?"https://jx.renrenmi.cc/?url=":"https://vip.2ktvb.com/player/?url=")+url,1);}}});}function getPlayUrl(vid){api.ajax({url:'https://api.leduotv.com/wp-api/getvodurl.php?vid='+vid,method:'get',dataType:'text',timeout:5},function(ret,err){if(err){jxError();return;}var data=JSON.parse(ret);if(data.hasOwnProperty('url')&&data.url){var url=data.url;isM3u8(url);}else{jxError();}});}function isM3u8(url){if(/^https?/.test(url)==false){jxError();}else if(/(?:hqmbsh|52e|2oc|renrenmi|viplanguang|baoju|zhegeyuming|37581|janan)\.(?:com|net|cc|vip|top)/.test(url)&&/\.m3u8($|&|\?)/.test(url)){apiAjax(url,"");}else{url2play(url);}}function ifr(url,line){site.ok=$("#line").attr("data-ref");var m=url.match(/.+\.(.+)\..+?\//);if(m&&(m[1] in site)){site[m[1]](line,url);return;}site.play(line,url);}function userTime(uTime){var h=0,i=0,s=parseInt(uTime);if(s>60){i=parseInt(s/60);s=parseInt(s%60);if(i > 60){h=parseInt(i/60);i = parseInt(i%60);}}var zero=function(v){return (v>>0)<10?"0"+v:v;};if(h>0){return [zero(h),zero(i),zero(s)].join(":");}else{return [zero(i),zero(s)].join(":");}}function tvlist(siteId,key){$('#pt').hide();player.hide();var sourceEl=$("#yuan"+key),docid=sourceEl.attr("data-docid"),id='tv'+siteId+'_'+docid,isTV=/电视剧|动漫/.test(sourceEl.closest('.main-box').attr("data-channel"));$("#tv"+key+" span").hide();if(document.getElementById(id)){$("#"+id).show();return;}$("#yuan"+key+" [value='0']").remove();sourceEl.append("<option value='0'>切换中</option>");sourceEl.val(0);var purl='https://search.video.iqiyi.com/m?if=video_library&video_library_type=play_source&platform=5&filter_play_source=1&is_mobile=1&callback=?&key='+docid+'&site='+siteId;$.getJSON(purl, function(e){var arr=e.video_info,ss='';for(var i=0,m;m=arr[i];i++){ss+='<a href="'+m.play_url+'" id="url'+id+key+i+'" class="urls-btn" title="'+m.title+'" itemNumber="'+i+'">'+(m.play_order||m.year)+'</a>';}sourceEl.val(siteId);$("#yuan"+key+" [value='0']").remove();var str=localStorage.getItem('vip_play'),p=str?JSON.parse(str):{},v=docid;if(v in p&&p[v].indexOf('$')!==-1){ar=p[v].split('$');ss=ss.replace('itemNumber="'+ar[3]+'">'+ar[0]+'</a>','itemNumber="'+ar[3]+'" style="color:#f00;">'+ar[0]+'</a>');}$('#tv'+key).append('<span class="urls" id="'+id+'">'+ss+'</span>');});}function selected(el){el.closest(".main-box").parent().find("a[name=dingw]").css({"background-color":"#ddd","color":"#333"}).removeAttr("name").find('.atitle').css({"color":"#0a1a2a"});el.css({"background-color":"#0a1a2a","color":"#eee"}).attr("name","dingw").find('.atitle').css({"color":"#eee"});}function startPlayer(el){$('#words').remove();var line=$('#line').attr("data-line"),surl=$('#url').val();if(surl==''){alert($('.main-box').length>0?'请先点选一个视频':'请先输入关键词搜索您想看的视频');return;}else if(/iqiyi.*?(\/lib\/m\_|\/a\_)/.test(surl)){api.toast({msg:"非视频地址,请直接搜:\n视频名称"});return;}$('#download').hide();if(el.length>0){selected(el);var mainEl=el.closest(".main-box");var atitle=mainEl.attr("data-title"),docid=mainEl.attr("data-docid"),playNumber=el.html();(playNumber.indexOf('<')!==-1)&&(playNumber=playNumber.substr(0,playNumber.indexOf('<')));if(playNumber){var date=mainEl.attr("data-date"),site=mainEl.find('.site>select option:selected').text()||'';}if(docid){pcookie({docid:docid,playNumber:playNumber,site:site,line:line,itemNumber:el.attr("itemNumber")});}$('#ptitle').html('<atitle>'+atitle+'</atitle> <playNumber style="color:red;">'+playNumber+'</playNumber><date style="display:none;">'+date+'</date><site style="display:none;">'+site+'</site>');}else{$('#ptitle').html('<atitle>标题未匹配</atitle> <playNumber style="color:red;">1</playNumber>');}$('#pt').show();if(surl.indexOf('//')>0){ifr(surl,line);}else{var arr=surl.split(':');var purl='https://search.video.iqiyi.com/m?if=video_library&video_library_type=play_source&platform=5&filter_play_source=1&is_mobile=1&callback=?&key='+arr[1]+'&site='+arr[0];$.getJSON(purl, function(e){var url=e.video_info[0].play_url;$('#url').val(url);ifr(url,$('#line').attr("data-line"));});}}function getBasicWidth(str){str=str+'';var len=str.length;var slen=str.replace(/[\s\d\w]+/g,'').length;len=slen+parseInt((len-slen)/2);var w=api.winWidth,cw=len<3?70:(len+1)*12+20;cw=w/parseInt(w/cw)-2;return cw;}var jsonp1 = function(data){var s0=[],s1=[],s2=[],s3=[],kw=$('#word').val(),dinfos=data.docinfos,str=localStorage.getItem('vip_play'),p=str?JSON.parse(str):{};for(var j=0,dinfo;dinfo=dinfos[j];j++){if(!dinfo.albumDocInfo||!dinfo.albumDocInfo.videoinfos){continue;}var adinfo=dinfo.albumDocInfo,vinfos=adinfo.videoinfos;if(adinfo.videoDocType==1){var s='',playRecord=[],inPlayrecord=(dinfo.doc_id in p);if(inPlayrecord){if(p[dinfo.doc_id].indexOf('$')!==-1){playRecord=p[dinfo.doc_id].split('$');}else{playRecord[0]=p[dinfo.doc_id];}}var date=adinfo.video_lib_meta&&(adinfo.video_lib_meta.china_publish_date||adinfo.video_lib_meta.global_publish_date)||'';date=date.substr(0,4);var channel=adinfo.channel.split(',')[0];var isMovie=channel=='电影'||!adinfo.series,isTv=/电视剧|动漫/.test(channel)&&adinfo.clusterinfos,isN=/电视剧|电影|动漫|少儿/.test(channel)||vinfos.length==1;var actor=(adinfo.star||'').split(/[;|,\/]/,2).join('/');var site='<span class="site">';if(isMovie){var cw=getBasicWidth(adinfo.siteName);site+='<a href="'+vinfos[0].itemLink+'" id="url'+pgNum+j+'" class="urls-btn" itemNumber="'+j+'" style="width:'+cw+'px;">'+adinfo.siteName+'</a>';if(adinfo.clusterinfos){var ctinfos=adinfo.clusterinfos;for(var k=0,ctinfo;ctinfo=ctinfos[k];k++){site+='<a href="'+ctinfo.siteId+':'+dinfo.doc_id+'" id="url'+pgNum+j+k+'" class="urls-btn" itemNumber="'+k+'">'+ctinfo.siteName+'</a>';}}site+='</span>';}else if(adinfo.clusterinfos){var tvlist=adinfo.clusterinfos;site+='<select id="yuan'+pgNum+j+'" data-docid="'+dinfo.doc_id+'" onchange="tvlist(this.options[this.selectedIndex].value,'+pgNum+j+')"><option value="'+adinfo.siteId+'" selected="selected">'+﻿﻿adinfo.siteName+'</option>';for(var k=0,m;m=tvlist[k];k++){site+='<option value="'+m.siteId+'">'+﻿﻿m.siteName+'</option>';}site+='</select></span><span class="xuanji-btn" onclick="$(\'#tv'+pgNum+j+'\').slideToggle();">选集</span>';}else{site+=adinfo.siteName+'</span><span class="xuanji-btn" onclick="$(\'#tv'+pgNum+j+'\').slideToggle();">选集</span>';}var region,total_video_count,filmtv_update_strategy,update_schedule,language,description;if(adinfo.video_lib_meta){region=adinfo.video_lib_meta.region||'';total_video_count=adinfo.video_lib_meta.total_video_count||0;filmtv_update_strategy=adinfo.video_lib_meta.filmtv_update_strategy||'';update_schedule=adinfo.video_lib_meta.update_schedule||'';language=adinfo.video_lib_meta.language||'';description=adinfo.video_lib_meta.description||'';}else{region=adinfo.region||'';total_video_count=0;filmtv_update_strategy=0;update_schedule='';language='';description=adinfo.description||'';}update_schedule=adinfo.stragyTime||update_schedule;var newest_item_number=adinfo.newest_item_number||0,itemTotalNumber=total_video_count>adinfo.itemTotalNumber&&total_video_count||adinfo.itemTotalNumber||0;newest_item_number=newest_item_number!=itemTotalNumber&&/\d{8}/.test(filmtv_update_strategy)?'':newest_item_number;s+='<div class="main-box" data-title="'+adinfo.albumTitle+'" data-docid="'+dinfo.doc_id+'" data-series="'+(adinfo.series||'')+'" data-channel="'+channel+'" data-date="'+date+'"><div class="content-box"><div class="img-box">'+img_(adinfo.albumImg,'0.9rem','1.2rem')+(!isMovie&&newest_item_number&&itemTotalNumber!=newest_item_number&&update_schedule?'<span id="schedule'+pgNum+j+'" class="update-schedule">'+update_schedule+'</span>':'')+(!isMovie&&newest_item_number?'<span class="update-info">'+(itemTotalNumber==newest_item_number?itemTotalNumber+'集全':'更新至'+newest_item_number+'集')+'</span>':'')+'<span class="cover-layer"></span></div><div class="title-box"><span class="atitle">'+adinfo.albumTitle+'</span><span class="ainfos">'+date+' '+channel+' '+actor+'</span>'+site+(!isMovie&&inPlayrecord?'<span class="playrecord">'+playRecord[0]+'</span>':'')+'</div></div><div class="urls-box" id="tv'+pgNum+j+'"><span class="urls" id="tv'+dinfo.doc_id+'">';var cw=70;for(var i=0,vinfo;vinfo=vinfos[i];i++){var itemN=vinfo.itemNumber,vyear=vinfo.year;var item=isN&&itemN||vyear==0&&itemN||vyear;var stitl=vinfo.subTitle||'',ititl=vinfo.itemTitle||'',secret_link=vinfo.secret_link||'';if(i==0){cw=getBasicWidth(item);}s+='<a href="'+vinfo.itemLink+'" id="url'+pgNum+j+i+'" class="urls-btn" title="'+((stitl&&stitl!=ititl)?stitl:((ititl.indexOf(adinfo.albumTitle)!==-1&&(adinfo.albumTitle+item).length/ititl.length>0.7)?'':ititl))+'" itemNumber="'+(!isTv&&secret_link?secret_link.substring(secret_link.length-5):i)+'" style="width:'+cw+'px;">'+item+'</a>';}s+='</span></div></div>';if(inPlayrecord){!isMovie&&(s=s.replace(new RegExp('(itemNumber="'+playRecord[3]+'"\\s+style=")([^"]+)(">'+playRecord[0]+'</a>)'),'$1$2color:#f00;$3'));s0.push(s);}else{s1.push(s);}}else if(adinfo.videoDocType==3){s3.push('<div class="main-box" data-title="'+adinfo.albumTitle+'" data-docid="" data-series="" data-channel="" data-date="'+date+'"><div class="content-box"><div class="img-box">'+img_(adinfo.albumImg,'100%','1.2rem')+'</div><div class="title-box"><span class="atitle">'+adinfo.albumTitle+'</span><span class="ainfos">'+adinfo.description.trim()+'</span></div></div><div class="urls-box" style="display:block;">');var movie='',tv='',other='';for(var i=0,vinfo;vinfo=vinfos[i];i++){var s,subChannel=vinfo.subChannel.split(',')[0],latestVideo=vinfo.latest_video||{},year=(latestVideo.publish_time||'').substr(0,10)||String(vinfo.year).substr(0,4),item=(latestVideo.title||vinfo.itemTitle||'')+(year?'<font color="#deb887">('+year+')</font>':'');s='<a href="'+(latestVideo.page_url||vinfo.itemLink||'')+'" id="url'+pgNum+j+i+'" class="urls-btn" style="overflow:hidden;width:100%;">'+item+'</a>';switch(subChannel){case '电影':movie+=s;break;case '电视剧':tv+=s;break;default:other+=s;}}var ty=function(str,type){return (str?'<span style="clear:both;display:block;color:black;font-size:0.16rem;padding:0.1rem;">'+type+'</span>'+str:'');};s3.push(ty(movie,'电影')+ty(tv,'电视剧')+ty(other,'其他')+'</div></div>');}else if(adinfo.videoDocType==2){for(var i=0,vinfo;vinfo=vinfos[i];i++){var vimg=vinfo.itemVImage,item=vinfo.itemTitle;(adinfo.siteId=='iqiyi')&&(vimg=vimg.replace(/(_.*?_.*?_.*?)\.jpg/,'$1_160_90.jpg'));s2.push('<div class="main-box" data-title="'+item+'" data-docid="" data-series="" data-channel="" data-date=""><a href="'+vinfo.itemLink+'" id="url'+pgNum+j+i+'" class="content-box"><div class="img-box" style="width:1.6rem;height:0.9rem;">'+img_(vimg,'100%','0.9rem')+'<span class="cover-layer"></span><span class="duration">'+userTime(vinfo.timeLength)+'</span></div><div class="title-box"><span class="atitle" style="color:#0a1a2a;">'+item+'</span><span class="ainfos" style="font-size:0.12rem;">'+adinfo.siteName+' '+vinfo.initialIssueTime.substr(0,10)+'</span></div></a></div>');}}else{continue;}}$("#loadmore").remove();$('.searchList').append(s0.concat(s1,s3,s2).join('')+'<div id="loadmore" style="font-size:0.14rem;height:0.35rem;line-height:0.35rem;text-align:center;color:#0a1a2a;margin-top:0.05rem;" onclick="loadmore()">加载更多>></div>');};function show(){$('#words').remove();pgNum=1;player.hide();var word=$('#word').val();if(word==''){alert('请输入关键词');$('#pt').hide();return;}$('#search_record').hide();$('#pt').hide();$('#plt').hide();if(/^(福利|黄色|成人|伦理|aifl)$/.test(word)){s_fuli();return;}if(word.indexOf('http')==0){getTitleByUrl(word);ifr(word,$('#line').attr("data-line"));return;}tocookie(word);tuijian_search_selected();api.showProgress({title: '搜索中...',text:'',modal: false});$('.searchList').html('<div id="loadmore" style="padding:0.1rem 0;background-color:#eee;font-size:0.14rem;text-align:center;">数据加载中…</div>');$('#movie').html().indexOf('data-qiyi="0">'+word+'</a>')!=-1&&searchYouku(word);search(encodeURIComponent(word));}function getTitleByUrl(url){api.ajax({url:url,metnod:"get",timeout:10,dataType:"text"},function(ret,err){var m=(ret||"").match(/<title>(.*?)<\/title>/);$('#ptitle').html('<atitle>'+(m&&m[1]||'标题未匹配')+'</atitle><playNumber style="color:red;"></playNumber>');$('#url').val(url);$('#download').hide();$('#pt').show();m&&searchYouku(m[1].split(/\s+|\-|_/)[0].replace(/第\d+集/,''));});}function searchYouku(word){if(pgNum>1){return;}var searchUrl='https://search.youku.com/search_video?keyword='+word;api.ajax({url:searchUrl,method:'get',dataType:'text',tag:'search',timeout:5,headers:{Referer:'https://m.youku.com/'}},function(ret,err){if(!ret||err){return;}var m=ret.match(/"commonData":{"showId":"([^"]+)","episodeTotal":(\d+),[^{]+?"feature":"([^"]+)","director":"([^"]+)"[^{]+?"stripeBottom":"([^"]+)"[\s\S]+?"sourceName":"([^"]+)"[\s\S]+?"vThumbUrl":"([^"]+)"[\s\S]+?"object_title":"([^"]+)"/);if(m==null){return;}if($('.searchList').html().indexOf('data-docid="'+m[1]+'"')>0){return;}api.ajax({url:'https://search.youku.com/api/search?appScene=show_episode&keyword='+word+'&showIds='+m[1]+'&appCaller=h5',method:'get',dataType:'text',tag:'search',timeout:5,headers:{Referer:searchUrl}},function(ret,err){if(!ret||err){return;}try{var json=JSON.parse(ret),data=json.serisesList,vlist="",showId=m[1],cw=getBasicWidth(1),isYouku=json.isYouku==1;for(var i=0,len=data.length;i<len;i++){var a=data[i];if(isYouku&&a.vid==null){break;}vlist+='<a href="'+(isYouku?'http://v.youku.com/v_show/id_'+a.videoId+'.html':a.url)+'" id="url'+showId+a.displayName+'" class="urls-btn" title="'+a.displayName+'" itemNumber="'+showId+a.displayName+'" style="width:'+cw+'px;">'+a.displayName+'</a>';}createHtml(m,vlist);}catch(e){}});});}function createHtml(infos,urls){var ar=infos[3].split(/\s+·\s+/);var title=infos[8],docid=infos[1],channel=ar[1],date=ar[0];infos[4]=infos[4].replace(/演员：|^\s+|\s+$/g,"");var p=JSON.parse(localStorage.getItem('vip_play')||'{}');var inPlayrecord=(docid in p);var playRecord=inPlayrecord&&p[docid].split('$')||[];inPlayrecord&&(urls=urls.replace(new RegExp('(itemNumber="'+playRecord[3]+'"\\s+style=")([^"]+)(">'+playRecord[0]+'</a>)'),'$1$2color:#f00;$3'));$('.searchList').prepend('<div class="main-box" data-title="'+title+'" data-docid="'+docid+'" data-series="true" data-channel="'+channel+'" data-date="'+date+'"><div class="content-box"><div class="img-box">'+img_(infos[7].replace(/\\u002F/g,'/'),'100%','1.2rem')+'<span class="update-info">'+infos[5]+'</span></div><div class="title-box"><span class="atitle">'+title+'</span><span class="ainfos">'+date+' '+channel+' '+(/\s+/.test(infos[4])&&infos[4].split(/\s+/,2).join('/')||infos[4])+'</span><span class="site">'+infos[6]+'</span><span class="xuanji-btn" onclick="$(\'#tv'+docid+'\').slideToggle();">选集</span>'+(inPlayrecord?'<span class="playrecord">'+playRecord[0]+'</span>':'')+'</div></div><div id="tv'+docid+'" class="urls-box"><span class="urls">'+urls+'</span></div></div>');}function FSubmit(e){if(e ==13){document.getElementById('word').blur();show();}}function tocookie(word){var ar=[],str=localStorage.getItem('vip_search');if(str){ar=JSON.parse(str);}ar=ar.filter(function (x){return x!=word;});ar.unshift(word);(ar.length>6)&&(ar.length=6);localStorage.setItem('vip_search',JSON.stringify(ar));}function sRecord(){var ar=[],keywords=[],str=localStorage.getItem('vip_search');if(str){ar=JSON.parse(str);for(var i=0,m;m=ar[i];i++){keywords.push('<a style="float:left;border-radius:10px;padding:10px;margin:2px;background-color:#333;color:#fff;font-size:0.14rem;">'+m+'</a>');}}else{keywords.push('<p style=\"color:red;font-size:0.12rem;line-height:0.2rem;text-align:center;\">暂无搜索历史</p>');}$("#search_record .search_items").html(keywords.join(''));$("#search_record .search_items a").on("click",function(){$('#word').val($(this).text());show();return false;});$("#search_record").slideToggle();}function pcookie(d){var docid=d.docid;if(!docid){return;}var pn=d.playNumber+'$'+d.site+'$'+d.line+'$'+d.itemNumber,data={},str=localStorage.getItem('vip_play');if(str){data=JSON.parse(str);(docid in data)&&(delete data[docid]);data[docid]=pn;str=JSON.stringify(data);(str.split('],"').length>60)&&(str=str.replace(new RegExp('^{"[^"]*?":\\{.*?\\},'),'{'));}else{data[docid]=pn;str=JSON.stringify(data);}localStorage.setItem('vip_play',str);}function search(word){eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('c b=\'a://f.e.d.9/o?4=\'+3+\'&5=0&8=&7=\'+6+\'&q=&p=n&r=2&s=&m=h&g=2&l=1&k=1&j=1&i=?\';',29,29,'||2cca00645fe5ef5b9b5fe821308afe8f|word|key|timeLength|pgNum|pageNum|releaseDate|com|http|puri|var|iqiyi|video|search|qyid|pc|callback|intent_category_type|intent_result_number|video_allow_3rd|if|10||pageSize|channel_name|u|pu'.split('|'),0,{}));$.getJSON(puri, function(obj){pgNum==1&&api.hideProgress();jsonp1(obj);});}function loadmore(){$('#loadmore').html('数据加载中…');var word=encodeURIComponent($('#word').val());pgNum++;search(word);}function executeSqlSync(sql){var db=api.require('db');var ret=db.executeSqlSync({name:'downloader',sql:sql});ret.status==false&&api.toast({msg:ret.msg});}function executeSql(sql){var db=api.require('db');db.executeSql({name:'downloader',sql:sql},function(ret,err){if(ret.status==false){api.toast({msg:err.msg});}});}function getApiInfo(sql){var db=api.require('db');var ret=db.selectSqlSync({name:'downloader',sql:sql});return ret.data;}function getHostNameByUrl(url){return url.split('\/')[2].split('.').slice(-2)[0];}function local2dataBase(){try{var str=localStorage.getItem('line'),ar=JSON.parse(str);if(str&&ar.length>0){for(var i=0,m;m=ar[i];i++){executeSqlSync('INSERT INTO vipInfo (url,name,ref) VALUES ("'+m+'","'+getHostNameByUrl(m)+'","0")');}localStorage.removeItem('line');}}catch(e){}}function line_add(){var line=$('#line_url').val();if(/^https?:\/\/.+/.test(line)==false){alert('线路地址格式错误！');return;}var data=getApiInfo('SELECT * FROM vipInfo where url="'+line+'"');if(data.length>0){executeSqlSync('delete from vipInfo where url = "'+line+'"');}var name=getHostNameByUrl(line);executeSqlSync('INSERT INTO vipInfo (url,name,ref) VALUES ("'+line+'","'+name+'","0")');vipSelected=line;$('#line').attr("data-line",line).text('线路:'+name);var i=vipLines.urls.indexOf(line);if(i!=-1){vipLines.urls.splice(i,1);vipLines.name.splice(i,1);vipLines.ref.splice(i,1);}vipLines.urls.push(line);vipLines.name.push('线路:'+name);vipLines.ref.push('0');updateList(getApiInfo('SELECT * FROM vipInfo'));}function updateList(data){var list=[];if(data.length>0){for(var i=0,m;m=data[i];i++){list.push('<div style="display:-webkit-flex;display:flex;height:0.4rem;line-height:0.4rem;margin:10px 0;background:#fff;color:#000;font-size:0.14rem;" data-url="'+m.url+'"><span style="padding:0 5px;color:#070;">'+(i+1)+'</span><a style="-webkit-flex:1;flex:1;text-align:center;">﻿﻿'+m.name+'</a><span style="padding:0 10px;color:#f55;" class="delete-btn">﻿﻿删除</span></div>');}$("#url_list").html(list.reverse().join(''));}else{$("#url_list").html('<span style="color:#f00;">你还没添加VIP解析接口</span>');}}function initVipLines(){var data=getApiInfo('SELECT * FROM vipInfo');updateList(data);if(data.length>0){for(var i=0,m;m=data[i];i++){vipLines.urls.push(m.url);vipLines.name.push('线路:'+m.name);vipLines.ref.push(m.ref);}}var k=vipLines.urls.indexOf(vipSelected);$('#line').attr("data-line",vipSelected).text(vipLines.name[k]).attr("data-ref",vipLines.ref[k]);}function api_gl_show(){toggleBody(1);$("#api_gl").show();$(this).scrollTop()==0&&window.scrollBy(0,1);isBottom()&&window.scrollBy(0,-1);}function api_gl_close(){toggleBody(0);$("#api_gl").hide();}function toggleBody(isPin){if(isPin){scrolltop=document.body.scrollTop;$('.searchList').hide();return;}$('.searchList').show();document.body.scrollTop=scrolltop;}function isBottom(){if($(this).scrollTop()+$(this).height()==$(document).height()){return true;}return false;}---end---<