>---start---.downloader.html======<!DOCTYPE html><html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>下载管理</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><style type="text/css">html,body{margin:0;padding:0;overflow-x: hidden;background-color:#fff;}.main{display:-webkit-flex;display:flex;position:relative;margin:10px 0;font-size:12px;overflow:hidden;background-color:#eee;align-items:center;padding:8px 0;}.center{flex:1;-webkit-flex:1;padding-left:5px;text-align:left;}.status,.progress,.reason{line-height:20px;}.title{display:block;word-wrap: break-word;word-break: normal;line-height:20px;font-size:16px;color:#000;margin-bottom:5px;}.progress,.reason{margin-left:10px;color:#777;}.deleteBtn{padding:10px 20px;font-size:20px;color:#999;}#space,#location{position:fixed;left:0;bottom:0;padding:10px 0;width:100%;font-size:12px;text-align:center;color:#999;background-color:#fff;}.error{color:#f00;font-size:12px;}</style></head><body><div id="downloadList" style="margin-bottom:32px;"></div><div id="space"></div><script>var state={s0:['下载中','#0a0'],s1:['完成','#f0f'],s2:['下载失败','#f00'],s3:['暂停','#aaa'],s4:['获取数据中','#0a0'],s5:['等待下载','#aaa']},curInfos={};apiready=function(){api.addEventListener({name:api.frameName},function(ret,err){var v=ret.value;window[v.fn](v.data);});addListener();api.addEventListener({name:'online'},function(ret,err){var El=$('#downloadList div[data-reason=1]');if(El.length>0){El.click();}El.length<2&&downloadPendingData(2-El.length);});window.apiFs=api.require('fs');window.apiDb=api.require('db');window.downloadPath=api.fsDir+"/VIPDownload";updateTableAndDelete();downloadList();paramAdd();checkPermission();spaceLeft();};function checkPermission(){var resultList=api.hasPermission({list:['storage']});if(resultList[0].granted==false){api.toast({msg:'没有相关权限，下载功能无法正常使用',duration:5000});}}function updateTableAndDelete(){var arr=getDownloadInfo('SELECT * FROM downloadInfo order by id asc');if(arr.length==0){return;}var str=JSON.stringify(getDownloadInfo('SELECT url FROM downloadsInfo order by id asc'));var statusArr=[3,0,1,2,4];for(var i=0,m;m=arr[i];i++){if(m.type=='m3u8'){var ret=apiFs.existSync({path:downloadPath+"/"+m.path});if(ret.exist==false){continue;}var data=api.readFile({sync:true,path:downloadPath+"/"+m.path+"/index.m3u8"});if(data){api.writeFile({path:downloadPath+"/"+m.title+".m3u8",data:data.replace(/[0-9a-z]{32}/g,'.$&')},function(ret,err){});}apiFs.removeSync({path:downloadPath+"/"+m.path+"/index.m3u8"});apiFs.renameSync({oldPath:downloadPath+"/"+m.path,newPath:downloadPath+"/."+m.path});}if(str.indexOf(m.url)!=-1){continue;}executeSql('INSERT INTO downloadsInfo (url,title,type,size,status,pid) VALUES ("'+m.url+'","'+m.title+'","'+m.type+'",0,'+statusArr[m.status]+',0)');}executeSql('drop table downloadInfo');}function paramAdd(){var param=api.getGlobalData({key:'downloaderParam'});if(param){addToList(param);return;}$('#downloadList').html()==''&&api.toast({msg:'空空如也'});}function spaceLeft(){api.getFreeDiskSpace(function(ret,err){$('#space').text('可用空间：'+bytesToSize(ret.size));});}function bytesToSize(size){var unit;var units=['B','KB','MB','GB','TB'];while ((unit=units.shift())&&size>1024){size=size/1024;}return (unit==='B'?size:size.toFixed(2))+unit;}function executeSql(sql){apiDb.executeSql({name:'downloader',sql:sql},function(ret,err){if(!ret||ret.status==false){api.toast({msg:err.msg});}});}function getDownloadInfo(sql){var ret = apiDb.selectSqlSync({name:'downloader',sql:sql});return ret.data||[];}function addToList(v){var url=v.url,title=v.title,type=v.type;var data=getDownloadInfo('SELECT * FROM downloadsInfo where url = "'+url+'"');if(data.length>0){api.toast({msg:'已存在',global:true});return;}api.toast({msg:'已添加至"下载管理"',global:true});title=title.replace(/\//g,',');for(var i=1,newTitle=title;i<20;i++){data=getDownloadInfo('SELECT status FROM downloadsInfo where title = "'+newTitle+'" and type = "'+type+'"');if(data.length>0){newTitle=title+'('+i+')';continue;}break;}var option={url:url,title:newTitle,type:type,size:0,status:0,pid:0};var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 0');if(arr.length>1){option.status=5;var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 5 order by pid desc limit 1');if(arr.length>0){option.pid=arr[0].pid+1;}}executeSql('INSERT INTO downloadsInfo (url,title,type,size,status,pid) VALUES ("'+url+'","'+newTitle+'","'+type+'",0,'+option.status+','+option.pid+')');$('#downloadList').prepend(listHtml(option));if(option.status==5){return;}queueDownload(option);}function downloadList(){var arr=getDownloadInfo('SELECT * FROM downloadsInfo order by id desc');if(arr.length==0){return;}for(var i=0,ar=[],m;m=arr[i];i++){ar.push(listHtml(m));}$('#downloadList').html(ar.join(''));initState(arr);}function initState(arr){var loadingArr=getDownloadInfo('SELECT status FROM downloadsInfo where status = 0');if(loadingArr.length<2){downloadPendingData(2-loadingArr.length);}for(var i=0,m;m=arr[i];i++){if(m.status==0){queueDownload(m);}if(m.type=='m3u8'){m3u8State(m);}else{mp4State(m);}}}function m3u8State(m){var path=downloadPath+'/.'+hex_md5(m.url);apiFs.getAttribute({path:path},function(ret,err){if(!ret.status){return;}var El=$('#downloadList div[data-url="'+m.url+'"]');var size=ret.attribute.size;if(m.status==1){El.find('.progress').text(bytesToSize(size));return;}var data=api.readFile({sync:true,path:path+'/tsfile.txt'});if(data==''){return;}var arr=JSON.parse(data);var ret=apiFs.readDirSync({path:path});if(!ret.status){return;}var k=ret.data.length-2;var keyExist=apiFs.existSync({path:path+'/key.key'});keyExist.exist&&k--;k<0&&(k=0);apiFs.getAttribute({path:path+'/'+k+'.ts.tmp'},function(ret,err){if(ret&&ret.status){El.find('.progress').text(bytesToSize(size)+'/-- | '+((k+ret.attribute.size/m.size)*100/arr.length).toFixed(2)+'%');}});});}function mp4State(m){var El=$('#downloadList div[data-url="'+m.url+'"]');var totalSize=m.size;if(m.status==1){El.find('.progress').text(bytesToSize(totalSize));return;}apiFs.getAttribute({path:downloadPath+'/'+m.title+'.'+m.type+'.tmp'},function(ret,err){if(ret&&ret.status){var dsize=ret.attribute.size;El.find('.progress').text(totalSize!=0?bytesToSize(dsize)+'/'+bytesToSize(totalSize)+' | '+(dsize*100/totalSize).toFixed(2)+'%':'0%');}});}function listHtml(m){return '<div data-url="'+m.url+'" data-path="'+hex_md5(m.url)+'" data-title="'+m.title+'" data-size="'+m.size+'" data-status="'+m.status+'" data-type="'+m.type+'" class="main"><div class="center"><div class="title">'+m.title+'.'+m.type+'</div><span style="color:'+state["s"+m.status][1]+';" class="status">'+state["s"+m.status][0]+'</span><span class="progress"></span><span class="reason"></span></div><div class="deleteBtn right">&times;</div></div>';}function downloadPendingData(len){if(api.connectionType=='none'){api.toast({msg:'请先联网'});return;}var arr=getDownloadInfo('SELECT * FROM downloadsInfo where status = 5 order by pid asc limit '+len);if(arr.length==0){return;}for(var i=0,m;m=arr[i];i++){queueDownload(m);}spaceLeft();}function queueDownload(option){if(api.connectionType=='none'){api.toast({msg:'请先联网'});return;}executeSql('update downloadsInfo set status=0,pid=0 where url="'+option.url+'"');var El=$('#downloadList div[data-url="'+option.url+'"]');updateStatusText(El,0);El.attr("data-reason",-1);if(option.type=='m3u8'){option.path=option.url;var path=downloadPath+"/."+hex_md5(option.url);var data=api.readFile({sync:true,path:path+'/tsfile.txt'});if(data==''){getM3u8Info(option);return;}var arr=JSON.parse(data);var ret=apiFs.readDirSync({path:path});if(!ret.status){executeSql('update downloadsInfo set status=2 where url="'+option.url+'"');updateStatusText(El,2);downloadPendingData(1);return;}var tsCount=ret.data.length-1;var keyExist=apiFs.existSync({path:path+'/key.key'});keyExist.exist&&tsCount--;var k=tsCount>0?tsCount-1:0;startM3u8Download({url:arr[k],savePath:path+"/"+k+".ts",tag:option.url});return;}api.accessNative({name:"getRealUrl",extra:{url:option.url}},function(ret,err){api.accessNative({name:"httpDownload",extra:{url:ret.hasOwnProperty("url")&&ret.url||option.url,tag:option.url,savePath:downloadPath+"/"+option.title+"."+option.type,allowResume:true,report:true}},function(ret,err){mp4Status(ret);});});}function startM3u8Download(m){api.accessNative({name:"httpDownload",extra:{url:m.url,savePath:m.savePath,tag:m.tag,allowResume:false,report:true}},function(ret,err){m3u8Status(ret);});}function m3u8Status(m){if(m.hasOwnProperty("url")==false){return;}var status=m.status;var tsSize=m.fileSize;var savePath=m.savePath;var mPath=savePath.match(/\.([0-9a-z]{32})\/\d+\.ts$/);var El=$('#downloadList div[data-path="'+mPath[1]+'"]');if(El.attr("data-size")==0&&tsSize!=0){El.attr("data-size",tsSize);executeSql('update downloadsInfo set size='+tsSize+' where url="'+El.attr("data-url")+'"');}var path=downloadPath+"/."+mPath[1];apiFs.getAttribute({path:path},function(ret,err){if(!ret.status){return;}var tsData=api.readFile({sync:true,path:path+'/tsfile.txt'});if(tsData==''){return;}var tsArr=JSON.parse(tsData);var k=tsArr.indexOf(m.url);k<0&&(k=0);var nextK=k+1;var size=ret.attribute.size;if(status==1){if(nextK==tsArr.length){executeSql('update downloadsInfo set status=1 where url="'+El.attr("data-url")+'"');updateStatusText(El,1);El.find('.progress').text(bytesToSize(size));downloadPendingData(1);}else{El.attr("data-size",0);updateStatusText(El,0);El.find('.progress').text(bytesToSize(size)+'/-- | '+(nextK*100/tsArr.length).toFixed(2)+'%');El.attr("data-size",0);startM3u8Download({url:tsArr[nextK],savePath:path+"/"+nextK+".ts",tag:m.tag});}}else if(status==0){if(El.attr("data-status")==3){api.accessNative({name:"cancelHttpDownload",extra:{url:m.tag}},function(ret,err){});return;}updateStatusText(El,0);El.find('.progress').text(bytesToSize(size)+'/-- | '+((k+m.percent/100)*100/tsArr.length).toFixed(2)+'%');}else if(status==2){executeSql('update downloadsInfo set status=2 where url="'+El.attr("data-url")+'"');updateStatusText(El,2);El.attr("data-reason",m.reason);m.reason!=1&&downloadPendingData(1);}});}function mp4Status(m){if(m.hasOwnProperty("url")==false){return;}var tag=m.tag;var status=m.status;var totalSize=m.fileSize;var El=$('#downloadList div[data-url="'+tag+'"]');if(El.attr("data-size")==0&&totalSize!=0){El.attr("data-size",totalSize);executeSql('update downloadsInfo set size='+totalSize+' where url="'+tag+'"');}if(status==1){updateStatusText(El,status);executeSql('update downloadsInfo set status='+status+' where url="'+tag+'"');El.find('.progress').text(bytesToSize(totalSize));downloadPendingData(1);}else if(status==0){if(El.attr("data-status")==3){api.accessNative({name:"cancelHttpDownload",extra:{url:m.tag}},function(ret,err){});return;}updateStatusText(El,status);var percent=m.percent;var curSize=totalSize*percent/100;El.find('.progress').text(bytesToSize(curSize)+'/'+bytesToSize(totalSize)+' | '+percent+'%');}else if(status==2){updateStatusText(El,status);executeSql('update downloadsInfo set status='+status+' where url="'+tag+'"');El.attr("data-reason",m.reason);m.reason!=1&&downloadPendingData(1);}}function updateStatusPid(url){var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 5 order by pid desc limit 1');var pid=arr.length==0&&1||arr[0].pid+1;executeSql('update downloadsInfo set status=5,pid='+pid+' where url="'+url+'"');}function updateStatusText(El,status){El.attr("data-status",status);El.find('.status').text(state["s"+status][0]).css("color",state["s"+status][1]);}function pauseDownload(El){var url=El.attr("data-url");updateStatusText(El,3);executeSql('update downloadsInfo set status=3,pid=0 where url="'+url+'"');api.accessNative({name:"cancelHttpDownload",extra:{url:url}},function(ret,err){downloadPendingData(1);});}function pengdingOrLoading(El){var arr=getDownloadInfo('SELECT pid FROM downloadsInfo where status = 0');if(arr.length>1){updateStatusText(El,5);updateStatusPid(El.attr("data-url"));return;}queueDownload({url:El.attr("data-url"),title:El.attr("data-title"),type:El.attr("data-type")});}function addListener(){$('#downloadList').on("click",".main",function(){var thisEl=$(this);switch(thisEl.attr("data-status")*1){case 0:pauseDownload(thisEl);break;case 1:startPlay(downloadPath+'/'+thisEl.attr("data-title")+'.'+thisEl.attr("data-type"));break;case 2:pengdingOrLoading(thisEl);break;case 3:pengdingOrLoading(thisEl);break;case 5:updateStatusText(thisEl,3);executeSql('update downloadsInfo set status=3,pid=0 where url="'+thisEl.attr("data-url")+'"');break;}});$('#downloadList').on("click",".deleteBtn",function(){var mainEl=$(this).parent();var url=mainEl.attr("data-url"),path=mainEl.attr("data-path"),title=mainEl.attr("data-title"),type=mainEl.attr("data-type"),status=mainEl.attr("data-status");api.confirm({title:'确定删除',msg:title+'.'+type,buttons:['取消','确定']},function(ret,err){if(ret.buttonIndex!=2){return;}mainEl.hide();if(status==0){api.accessNative({name:"cancelHttpDownload",extra:{url:url}},function(ret,err){apiFs.remove({path:downloadPath+'/'+title+'.'+type+'.tmp'},function(ret,err){});apiFs.rmdir({path:downloadPath+'/.'+path},function(ret,err){});setTimeout(function(){apiFs.rmdir({path:downloadPath+'/.'+path},function(ret,err){});},3000);downloadPendingData(1);});}apiFs.remove({path:downloadPath+'/'+title+'.'+type},function(ret,err){});apiFs.remove({path:downloadPath+'/'+title+'.'+type+'.tmp'},function(ret,err){});apiFs.rmdir({path:downloadPath+'/.'+path},function(ret,err){});executeSql('delete from downloadsInfo where url = "'+url+'"');setTimeout(spaceLeft,1000);});return false;});}function getM3u8Info(option){var url=option.url,path=hex_md5(option.path);var El=$('#downloadList div[data-path="'+path+'"]');El.find('.status').text(state["s4"][0]).css("color",state["s4"][1]);api.ajax({url:(url.indexOf('?')!==-1?url:url+'?56798'),method:'get',dataType:'text',timeout:15},function(ret,err){if(!ret||err){updateStatusText(El,2);executeSql('update downloadsInfo set status=2 where url="'+option.path+'"');downloadPendingData(1);return;}var mArr=ret.match(/\s+([^#\s]+)(#+\w+)?/),m3u8=mArr&&mArr[1]||"";if(/^(https?:|$)/.test(m3u8)){var baseUrl="";}else if(m3u8.indexOf("/")==0){var baseUrl=url.match(/^.{8}[^\/]+/)[0];}else if(m3u8.indexOf("../")==0){var ml=m3u8.split("/")[1],baseUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);ret=ret.replace(/(\s+)\.\.\//g,"$1");}else{var baseUrl=url.substr(0,url.lastIndexOf("/")+1);(m3u8.indexOf("./")==0)&&(ret=ret.replace(/(\s+)\.\//g,"$1"));}if(ret.indexOf("ENDLIST")==-1){option.url=baseUrl+m3u8;getM3u8Info(option);return;}path=downloadPath+'/.'+path+'/';var m3u8FilePath=downloadPath+'/'+option.title+'.m3u8';ret=ret.replace(/(uri\s?=\s?")([^"]+)/i,function(a,a1,a2){if(/^https?:/.test(a2)){var baseKeyUrl='';}else if(a2.indexOf("/")==0){var baseKeyUrl=url.match(/^.{8}[^\/]+/)[0];}else if(a2.indexOf("../")==0){var ml=a2.split("/")[1],baseKeyUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);a2=a2.substr(3);}else{var baseKeyUrl=url.substr(0,url.lastIndexOf("/")+1);(a2.indexOf("./")==0)&&(a2=a2.substr(2));}a2=baseKeyUrl+a2;api.accessNative({name:'httpDownload',extra:{url:a2,savePath:path+'key.key',allowResume:false,report:false}},function(ret,err){});return a1+path+'key.key';});var arr=ret.split('\n'),str=[],m3u8file=[];for(var i=0,m;m=arr[i];i++){if(m.indexOf('#')==0){m3u8file.push(m);continue;}if(m==''){continue;}str.push(baseUrl+m);m3u8file.push(path+(str.length-1)+'.ts');}api.writeFile({path:path+'tsfile.txt',data:JSON.stringify(str)},function(ret,err){if(err||!ret.status){api.toast({msg:err.msg});updateStatusText(El,2);executeSql('update downloadsInfo set status=2 where url="'+option.path+'"');downloadPendingData(1);return;}startM3u8Download({url:str[0],savePath:path+"0.ts",tag:option.path});});api.writeFile({path:m3u8FilePath,data:m3u8file.join("\n")},function(ret,err){if(err||!ret.status){api.toast({msg:err.msg});}});});}</script></body></html>######.music.html======<!doctype html><html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>高品音乐</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><style>*{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;}body{margin:0;padding:0;background-color:#fff;font-size:14px;}.not-scroll{height:100%;position:fixed;top:0;}.top-box{position:fixed;top:0;left:0;width:100%;z-index:3;background-color:#fff;}.search-box{width:100%;z-index:3;display:-webkit-flex;display:flex;padding:2px 0;height:44px;line-height:44px;text-align:center;background-color:#0a0;font-size:14px;}.search-input{-webkit-flex:1;flex:1;width:100%;padding:0 10px;box-sizing:border-box;background-color:#fff;color:#000;outline:none;border:none;border-radius:3px;text-align:center;}.search-line,.search-btn{padding:0 10px;color:#fff;}.search-line:active,.search-btn:active{background-color:#4CAF50;}.tab-box{display:-webkit-flex;display:flex;width:100%;background-color:#f9f9f9;color:#666;}.tab-item{display:block;-webkit-flex:1;flex:1;text-align:center;height:40px;line-height:40px;font-size:14px;}.tab-item-selected{color:green;border-bottom:2px green solid;}.search-history{display:flex;display:-webkit-flex;flex-wrap:wrap;-webkit-flex-wrap:wrap;align-content:flex-start;align-content:-webkit-flex-start;text-align:center;padding:10px 0;color:#999;overflow-y:auto;-webkit-overflow-scrolling:touch;}.search-history-item{display:block;flex:1 0 auto;-webkit-flex:1 0 auto;color:#666;border:1px solid #eee;margin:5px 3px;padding:5px 10px;border-radius:10px;}.search-history div{width:25%;flex:1 0 auto;-webkit-flex:1 0 auto;overflow:hidden;}.search-history p{width:100%;color:#999;}ul{list-style:none;padding:0;margin:0;}.loadmore{text-align:center;font-size:14px;background:rgba(0,0,0,0.3);color:#fff;padding:10px;margin:5px 0;}.nomore{background-color:#fff;color:#999;}#html{margin:10px 0 40px;}#html sup{color:#999;}#html li{background-color:#fff;position:relative;height:53px;padding:8px 0 5px;overflow:hidden;}#html li::after{content:"";position:absolute;height:1px;bottom:0;left:0;right:0;background:#e5e5e5;}#html .song_name{line-height:18px;font-size:16px;font-weight:400;color:#000;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}#html .singer_name{margin-top:5px;font-size:14px;color:grey;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}#song-info{width:100%;position:absolute;top:30%;left:0;background-color:#fff;padding-top:10px;}#song-info .title{text-align:center;}#song-info .song_name{font-size:16px;display:block;text-align:center;color:#000;}#song-info .singer,#song-info .song_time,#song-info .song_album{margin:5px;font-size:12px;color:#999;}#song-info .urls{width:100%;border:1px solid #e5e5e5;border-width:1px 0;overflow:hidden;padding:5px 0;margin:5px 0;}#song-info .urls a{float:left;padding:5px 8px;margin:5px 3px;color:#fff;background-color:#000;font-size:14px;}#song-info .urls a:hover{background:#00f;}#song-info .close{text-align:center;font-size:14px;color:#000;padding:10px;}#song-info .close:hover{color:#f00;}.show-box{background:rgba(0,0,0,0.3);position:fixed;top:0;left:0;margin:0;padding:0;width:100%;height:100%;display:-webkit-box;-webkit-box-pack:center;-webkit-box-align:center;}.show-box img{z-index:1;height:50%;}#lrc-box{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;background-color:#eee;font-size:16px;z-index:9;}.box-title{overflow:hidden;height:40px;line-height:40px;color:#999;text-align:center;}#lrc{-webkit-flex:1;flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;width:100%;background-color:#eee;color:#000;}#lyricContainer{padding:5px 0;text-align:center;background:rgba(0,0,0,0.5);color:#fff;}.closebtn{z-index:2;width:100%;text-align:center;font-size:14px;color:#fff;background:rgba(0,0,0,0.3);}audio::-webkit-media-controls-mute-button{display:none;}audio::-webkit-media-controls{overflow:hidden !important;}audio::-webkit-media-controls-enclosure{width:calc(100%+40px);margin-left:auto;}</style></head><body><div class="top-box"><div class="search-box"><div class="search-line" id="source" data-source="YQB">B 线</div><input id="wd" class="search-input" placeholder="搜索歌曲/歌单/歌手/专辑" onkeydown="FSubmit(event.keyCode||event.which);"/><div class="search-btn">搜索</div></div> <div class="tab-box"><div class="tab-item" data-show="#html" data-hide=".search-history,.music-player">搜索结果</div><div class="tab-item" data-show=".search-history" data-hide=".music-player">搜索记录</div><div class="tab-item" data-show=".music-player" data-hide=".search-history">播放器</div></div><div class="search-history" style="display:none;"></div><div class="music-player" style="display:none;"><div id="lrc-box"><div class="box-title"></div><div id="lrc"></div><div id="player" style="z-index:99999;"><div id="lyricContainer">暂无歌词</div><audio controls controlsList="nodownload" id="audio" style="width:100%;outline:none;">audio not supported!</audio></div></div></div></div> <div id="html"><p style="text-align:center;color:#999;font-size:16px;">搜出你的最爱</p></div> <div id="cur-info" style="display:none;"></div><script>var scrolltop=0,curPage=1,isReady=0,curInfos={},musicSource;var audio=document.getElementById('audio'),lyricContainer = document.getElementById('lyricContainer'),lyric=[];apiready=function(){api.addEventListener({name:api.frameName},function(ret,err){var v=ret.value;window[v.fn](v.data);});getSearchHistory(0);var topSpace=$('.search-box').height()+$('.tab-box').height();$('#html').css({"padding-top":topSpace+"px"});$('#lrc-box,.search-history').css({"height":(api.frameHeight-topSpace)+"px"});$('.tab-box').on('click','.tab-item',function(){var el=$(this);var showEl=el.attr("data-show"),hideEl=el.attr("data-hide");if(showEl=='#html'){document.body.scrollTop=scrolltop;scrolltop=0;}else if(scrolltop==0){scrolltop=document.body.scrollTop;}$(hideEl).fadeOut(200);$(showEl).fadeIn(200);$('.tab-item').removeClass('tab-item-selected');el.addClass('tab-item-selected');});$('.search-history').on('click','.search-history-item',function(){$('#wd').val($(this).text());search(1);});$('body').on('click','#lrc p',function(){var i=$(this).attr("id").match(/\d+/)[0];audio.currentTime=lyric[i][0];});$('#lyricContainer').on("click",function(){var i=$(this).attr("data-key");document.getElementById('lrc'+i).scrollIntoView();});$('#audio').on('timeupdate',function(){var curKey=0;for(var i=0,m;m=lyric[i];i++){if(this.currentTime+0.5>m[0]){curKey=$('#lyricContainer').attr("data-key");if(curKey==i){continue;}$('#lyricContainer').attr("data-key",i);lyricContainer.textContent=m[1];$('#lrc'+curKey).css({"color":"#000"});$('#lrc'+i).css({"color":"#f00"});}}}).on('error',function(){++audioRetry<2&&/^http/.test(this.src)?this.load():(audioRetry==2&&api.toast({msg:'播放失败'}));});switch2LMY();$('.search-btn').on("click",function(){search(1);});$('#source').on("click",function(){var el=$(this);var i=musicSource.value.indexOf(el.attr("data-source"));var texts=musicSource.text.slice();texts.splice(i,1,'*  '+musicSource.text[i]);api.actionSheet({title: '音乐源',cancelTitle: '取消',buttons: texts}, function(ret, err) {var index = ret.buttonIndex;if(index<musicSource.text.length+1){index--;if(el.attr("data-source")==musicSource.value[index]){return;}el.attr("data-source",musicSource.value[index]).text(musicSource.text[index]);$('#wd').val()&&search(1);}return false;});return false;});$('#html').on("click","li",function(){$('#html li').css("background-color","#fff");$(this).css("background-color","#f4f4f4");if(musicSource.site=="LMY"){return false;}getInfo($(this));return false;});$('#html').on("click","li a",function(){$(this).parent().click().find('a').css({"color":"#777","border-color":"#777"});$(this).css({"color":"green","border-color":"green"});var mainEl=$(this).parent().parent(),url=$(this).attr("data-url"),suffix=$(this).attr("data-suffix"),name=mainEl.attr("data-name"),singer=mainEl.attr("data-singer"),cover=mainEl.attr("data-cover"),lrc=mainEl.attr("data-lrc");curInfos={url:url,name:name,singer:singer,suffix:suffix,lrc:lrc,cover:cover,title:name+" - "+singer};if(/https?:\/\/59\.110\.45\.28\//.test(url)){api.showProgress({title:"解析中...",text:"",modal:false});api.accessNative({name:'getRealUrl',extra:{url:url}},function(ret,err){api.hideProgress();var realUrl=ret.url;if(!realUrl){api.toast({msg:'解析出错'});return;}if(suffix=="lrc"){window.audioRetry=0;lyric=[];audio.src=realUrl;audio.play();getLrc2Player(lrc);return;}play_download({url:realUrl,name:name+' - '+singer,suffix:getSuffixByUrl(realUrl,suffix)});});return;}if(suffix=="lrc"){window.audioRetry=0;lyric=[];audio.src=url;audio.play();getLrc2Player(lrc);return;}play_download({url:url,name:name+' - '+singer,suffix:getSuffixByUrl(url,suffix)});return false;});api.sendEvent({name:'root',extra:{fn:'openLMY',data:{}}});api.showProgress({title:"初始化...",text:"",modal:false});};function musicReady(v){api.hideProgress();isReady=v.ok;isReady==-1&&initError();}function requestTimeout(v){api.hideProgress();api.toast({msg:'超时，请重试'});}function requestSuccess(v){var data=JSON.parse(v.result);api.hideProgress();if(data.code==200){searchTextLMY(data,curPage);}else{api.toast({msg:'请求失败，请重试'});}}function setSearchHistory(word){var str=localStorage.getItem('musicSearchHistory')||'[]';var arr=JSON.parse(str);var i=arr.indexOf(word);if(i!=-1){arr.splice(i,1);}arr.unshift(word);if(arr.length>30){arr.length=30;}localStorage.setItem('musicSearchHistory',JSON.stringify(arr));getSearchHistory(arr);}function getSearchHistory(arr){if(arr==0){var str=localStorage.getItem('musicSearchHistory')||'[]';arr=JSON.parse(str);arr[0]&&$('#wd').val(arr[0]);}$('.search-history').html(arr[0]?'<a class="search-history-item">'+arr.join('</a><a class="search-history-item">')+'</a><div></div><div></div><p onclick="clearSearchHistory();">清空记录</p>':'<p>暂无记录</p>');}function clearSearchHistory(){api.confirm({msg:'清空搜索记录？',buttons:['取消','确定']},function(ret,err){var i=ret.buttonIndex;if(i==2){localStorage.removeItem('musicSearchHistory');getSearchHistory(0);}});}function getSuffixByUrl(url,defaultSuffix){var m=url.match(/\.([a-z0-9]{3,5})($|\?)/);return m&&m[1]||defaultSuffix;}function getLrc2Player(url){lyricContainer.textContent="LRC loading…";$('.tab-item').get(2).click();showLrc(['[00:00.00]LRC loading…']);api.ajax({url:url,method:"get",dataType:"text",timeout:10},function(ret,err){lyric=parseLyric(/\[[\d\:\.]+\]/.test(ret)&&ret||'[00:00.00]暂无歌词');});}function parseLyric(text){if(/<\d+>/.test(text)){text=text.replace(/<\d+>/g,'');}text=text.replace(/\:(\d)(\.|\])/g,':0$1$2');var lines=text.match(/(\[[\d\:\.]+\])+.+/g),pattern=/\[[\d\:\.]+\]/g,is100=/\:[6-9]\d(\.|\])/.test(text),result=[];showLrc(lines);lines.forEach(function(v,i,a){var time=v.match(pattern),value=v.replace(pattern,'');time.forEach(function(v1,i1,a1){var t=v1.slice(1,-1).split(':');var m=parseInt(t[0],10),s=parseFloat(t[1]);result.push([m*60+(is100&&m>0&&s*0.6||s),value]);});});result.sort(function(a,b){return a[0]-b[0];});lyricContainer.textContent=curInfos.title;return result;}function initError(){api.confirm({title:'提示',msg:'音乐模块初始化出错',buttons:['重新初始化','取消']},function(ret,err){if(ret.buttonIndex==1){api.closeFrame({name:"LMY"});api.showProgress({title:"初始化...",text:"",modal:false});isReady=0;api.sendEvent({name:'root',extra:{fn:'openLMY',data:{}}});}});}function switch2LMY(){musicSource={site:"LMY",value:["YQB","YQD","migu","jooxhk","ximalaya","djyule"],text:["B 线","D 线","咪 咕","小 鸡","喜马拉雅","DJ音乐盒"]};$('#source').attr("data-source",musicSource.value[0]).text(musicSource.text[0]);}function FSubmit(e){if(e==13){document.getElementById('wd').blur();search(1);}}function getLrc(url){api.showProgress({title:"解析中...",text:"",modal:false});api.ajax({url:url,method:"get",dataType:"text",timeout:10},function(ret,err){api.hideProgress();if(ret){if(/暂无歌词/.test(ret)){api.toast({msg:'暂无歌词'});return;}showLrc(ret);return;}api.toast({msg:'未能获取歌词'});});}function resultLMY(str,type){api.hideProgress();var data=JSON.parse(unescape(str));searchTextLMY(data,curPage);}function result(str,type){api.hideProgress();str=unescape(str);if(str.indexOf('<html>')===0){api.toast({msg:'长时间未操作，请刷新一次'});return;}if(type=='getUrl'&&(str.indexOf('[')==0||str.indexOf('{')!=0)){if(/<\d+>/.test(str)){str=str.replace(/<\d+>/g,'');}str=str.replace(/\:(\d)(\.|\])/g,':0$1$2');var lines=str.match(/(\[[\d\:\.]+\])+.+/g);showLrc(lines);return;}var data=JSON.parse(str);if(data.code==1){api.toast({msg:'请重试'});return;}switch(type){case 'search':searchText(data);break;case 'getInfo':songInfo(data);break;case 'getUrl':if(data.hasOwnProperty("url")==false||!data.url){api.toast({msg:'请重试'});return;}var name=$('#song-info .song_name').text()+' - '+$('#song-info .singer').text();play_download({url:data.url,name:name,suffix:data.suffix});break;default:break;}}function search(page){var wd=$('#wd').val();if(page==1){scrolltop=0;$('.tab-item').get(0).click();api.pageUp({top:true});wd&&setSearchHistory(wd);}curPage=page;if(!wd){api.toast({msg:'请输入搜索内容'});return;}else if(isReady==0||isReady==2){api.toast({msg:'初始化，请稍后'});return;}else if(isReady<0){api.toast({msg:'初始化出错'});return;}api.showProgress({title:"搜索中...",text:"",modal:false});var v=musicSource.site=='LMY'?{url:'http://59.110.45.28/m/api/search',method:'POST',data:"text="+wd+"&page="+page+"&type="+$('#source').attr("data-source"),type:'searchLMY'}:{};var js='musicRequest('+JSON.stringify(v)+');';api.execScript({frameName:musicSource.site,script:js});return false;}function getInfo(el){request('api.php?get_song='+$('#source').attr("data-source"),'post',{mid:el.attr("data-mid")},'getInfo');return false;}function getUrl(el){var url=el.attr("data-url");if(/^(\/\/|http)/.test(url)){showImg(url.replace(/^(\/\/)/,'http://'));return false;}request(url,'get',{},'getUrl');return false;}function showImg(url){$('body').append('<div class="show-box"><img src="'+url+'"/><div class="closebtn" onclick="imgClosebtnClick(this);">&times; 关闭</div></div>');}function imgClosebtnClick(el){var p=el.parentNode;p.parentNode.removeChild(p);}function showLrc(ar){var pt=/\[[\d\:\.]+\]/g,t=ar.join('').match(pt);t.sort();for(var str=[],i=0,m;m=ar[i];i++){var t1=m.match(pt),text=m.replace(pt,'');for(var k=0,n;n=t1[k];k++){var j=t.indexOf(n);str[j]='<p id="lrc'+j+'" style="padding:5px 10px;"><span style="color:#099;padding-right:5px;">'+n+'</span>'+text+'</p>';}}$('.box-title').text(curInfos.title);$('#lrc').html(str.join(''));$(this).scrollTop()==0&&window.scrollBy(0,1);isBottom()&&window.scrollBy(0,-1);}function toggleBody(isPin){if(isPin){scrolltop=document.body.scrollTop;$('#html').hide();return;}$('#html').show();document.body.scrollTop=scrolltop;}function isBottom(){if($(this).scrollTop()+$(this).height()==$(document).height()){return true;}return false;}function play_download(data){api.sendEvent({name:"root",extra:{fn:"downloadActionSheet",data:{url:$.trim(data.url),title:curInfos.title,type:data.suffix}}});}function songInfo(data){var urls=data.url,ar=[],i;for(i in urls){ar.push('<a data-url="'+urls[i]+'">'+i+'</a>');}$('body').append('<div class="show-box"><div id="song-info"><div class="title"><span class="song_name">'+data.song+'</span><span class="singer">'+data.singer+'</span><span class="song_time">'+data.interval+'</span><span class="song_album">'+data.album+'</span></div><div class="urls">'+ar.join('')+'</div><div class="close">&times; 关闭<span class="closebtn" style="padding:0;"></span></div></div></div>');$('#song-info .urls a').on("click",function(){curInfos.name=data.song;curInfos.singer=data.singer;curInfos.title=data.song+" - "+data.singer;$('#song-info .urls a').css({"background-color":"#000"});$(this).css({"background-color":"#00f"});getUrl($(this));return false;});$('#song-info .close').on("click",function(){if($('.closebtn').length>1){return;}$(this).parent().parent().remove();return false;});}function searchText(data){var pg=data.page,total=Math.ceil(data.totalnum/20),songList=total==0?[]:data.song_list,ar=['<ul class="search_content">'];for(var i=0,m;m=songList[i];i++){for(var j=0,singer=[],n;n=m.singer[j];j++){singer.push(n.name);}ar.push('<li data-mid="'+m.songmid+'" class="song_item"><div class="song_name">'+m.songname+'</div><div class="singer_name">'+singer.join('/')+'</div></li>');}$('#html .loadmore').remove();pg==1&&$('#html').html('');$('#html').append(ar.join('')+'</ul>'+(pg<total?'<div class="loadmore" onclick="search('+(++pg)+');">加载更多…</div>':'<div class="loadmore nomore">-- 没有了 --</div>'));}function errText(str){api.hideProgress();str=unescape(str);var json=JSON.parse(str);if(json.statusCode==404){api.toast({msg:'无法获取'});return;}api.toast({msg:json.msg.replace(/(：|:)\w+\.\w+/,'')});}function searchTextLMY(a,pg){var type={url:{index:0,text:"试听",suffix:"lrc"},url_m4a:{index:1,text:"流畅",suffix:"m4a"},url_128:{index:2,text:"标准",suffix:"mp3"},url_320:{index:3,text:"高品",suffix:"mp3"},url_flac:{index:4,text:"FLAC",suffix:"flac"},url_ape:{index:5,text:"APE",suffix:"ape"},url_dsd:{index:6,text:"Hi-Res",suffix:"flac"}};pg==1&&$('#html').empty();$('.more').remove();var ar=a.data.list,more=a.data.more*1,text="",index=pg==1?1:$('#html li').length+1;if(pg==1&&ar.length==0){api.toast({msg:"暂未搜到，请尝试其他源"});return;}for(var i=0,m;m=ar[i];i++){text+='<li style="overflow:hidden;height:auto;line-height:auto;color:#000;padding:20px 5px;" data-name="'+m.name+'" data-singer="'+m.artist+'" data-lrc="'+m.lrc+'" data-cover="'+m.cover+'"><div style="overflow:hidden;"><span style="color:#080;">'+(i+index)+'</span><span style="padding:0 10px;font-size:16px;">'+m.name+'</span><span style="color:#777;font-size:12px;">'+m.artist+'</span></div><div style="overflow:hidden;padding:20px 0;text-align:center;">';var key,urlList=[];for(key in m){if(key in type){urlList[type[key].index]='<a data-key="'+key+'" data-url="'+m[key]+'" data-suffix="'+type[key].suffix+'" style="padding:5px 8px;margin:5px 3px;color:#777;border:1px solid #777;font-size:14px;border-radius:10px;">'+type[key].text+'</a>';}}text+=urlList.join('')+'</div></li>';}text='<ul style="border:none;background-color:#fff;color:#fff;">'+text+'</ul>';if(more==0||ar.length<more){text+='<div class="more" style="text-align:center;color:#999;height:auto;padding:20px 0;">没有了</div>';}else{pg++;text+='<div class="more" style="text-align:center;color:#333;height:auto;padding:20px 0;" data-pg="'+pg+'" onclick="search('+pg+');">加载更多...</div>';}$('#html').append(text);}</script></body></html>######.subwin.html======<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><title>subWindow</title><style>html,body{margin:0;padding:0;overflow-x: hidden;font-size:12px;background-color:#fff;}a{text-decoration:none;}#header{display:flex;display:-webkit-flex;position:fixed;left:0;top:0;width:100%;height:50px;line-height:50px;text-align:center;font-size:16px;color:#fff;background-color:#000;}.back{width:50px;height:50px;background:url(file:///android_asset/widget/image/ic_arrow_left.png) no-repeat center center;background-size:29px 29px;}.subtitle{flex:1;-webkit-flex:1;}.add-btn{width:50px;height:50px;}</style></head><body><div id="header"><div class="back" tapmode onclick="api.closeWin();"></div><div class="subtitle"></div><div class="add-btn" tapmode onclick="addLine();">添加</div></div><script>apiready=function(){var param=api.pageParam;$('.subtitle').text(param.title);var header=document.getElementById('header');if(api.statusBarAppearance){header.style.paddingTop=api.safeArea.top+"px";}var headerH=header.offsetHeight;api.openFrame({name:param.name,url:param.url,rect:{marginLeft:0,marginTop:headerH,marginRight:0,marginBottom:0},pageParam:param,bounces:true});};function addLine(){api.sendEvent({name:'jkgl',extra:{fn:'lineAdd',data:{}}});}</script></body></html>######.vip.js======var timeoutID=0,pgNum=1,curInfos={},searchInfo={"xg_end":false},yukuInfos={isEnd:0},vipLines={urls:"5b2268747470733a2f2f6a782e786d666c762e636f6d2f3f75726c3d222c2268747470733a2f2f6a782e626c626f2e63633a343433332f3f75726c3d222c2268747470733a2f2f6170692e6c6564756f74762e636f6d2f77702d6170692f69667267662e7068703f7669643d222c22687474703a2f2f6a696578692e78696e6164792e636e2f6266712f3f75726c3d222c227669704d616e61676572225d",name:["线路：A","线路：B","线路：C","线路：D","-- VIP解析接口管理 --"],ref:["1","1","1","1","0"]},vipSelected;apiready=function(){api.sendEvent({name:'root',extra:{fn:'openHideFrame',data:{name:'decode',url:'.decode.html'}}});window.xgWebBrowser=api.require('webBrowser');xgSearch("",-1);html_();listener();$('#tab-box .tab-item').get(2).click();var str=localStorage.getItem('vip_search');if(str){$('#word').val(JSON.parse(str)[0]);}window.onscroll=function(){var t=document.documentElement.scrollTop||document.body.scrollTop;var top=$('.top');t+40>api.winHeight?top.show():top.hide();};api.addEventListener({name:api.frameName},function(ret,err){var v=ret.value;window[v.fn](v.data);});initVipLines();};function imageCache(el){var imgs=el.find('img[data-src]');if(imgs.length>0){for(var i=0,m;m=imgs[i];i++){apiImageCache(m);}}}function apiImageCache(el){var url=el.getAttribute("data-src");api.imageCache({url:url,thumbnail:true,policy:'cache_only'},function(ret,err){el.src=ret.status?ret.url:url;el.removeAttribute("data-src");});}function doubanRequest(){var El=$('.tuijian');if(El.attr("data-loaded")==1){return;}El.html('<p>数据载入中…</p>');var d= new Date();var m=d.getMonth()+1,dd=d.getDate();var riqi=d.getFullYear()+"-"+(m.length==1?"0"+m:m)+"-"+(dd.length==1?"0"+dd:dd);var url='https://d.guduodata.com/m/newRank/list/today_divide?category=DRAMA&date='+riqi+'&orderTitle=gdi&orderType=asc&platformId=0&t='+(new Date().getTime());api.ajax({url:url,method:'get',tag:'hotTV',timeout:15,dataType:'json',headers:{Referer:'https://d.guduodata.com/'}},function(ret,err){if(ret){El.attr("data-loaded",1);hotTV(El,ret);}else{El.html('<p style="color:#e00;" onclick="doubanRequest();">点击重新获取</p>');}});}function downloadShow(url){$('#download').attr("data-url",url).show();}function DownloadButton(url,title,type){api.sendEvent({name:"root",extra:{fn:"downloadActionSheet",data:{url:url,title:curInfos.title,type:type}}});}function html_(){var htmlStr='<div id="pt"><div class="top-box"><a id="line" data-line="0">线路1</a><span id="ptitle"></span><a id="download">下载/播放</a></div></div><div id="ads">关注微信公众号<span>kongbuyy</span>不迷路</div><input type="text" value="" id="url" style="display:none;"/><div class="search-box"><input class="search-input" type="text" id="word" placeholder="视频名搜索/视频网址解析" onkeydown="FSubmit(event.keyCode||event.which);"/><div onclick="show();" class="search-btn">搜索</div></div><div id="tab-box"><div class="tab-item" data-show=".searchList" data-hide=".search-history,.tuijian">搜索结果</div><div class="tab-item" data-show=".search-history" data-hide=".searchList,.tuijian">搜索记录</div><div class="tab-item" data-show=".tuijian" data-hide=".searchList,.search-history">热播电视</div></div><div class="searchList"></div><div class="search-history"></div><div class="tuijian"></div><div class="top" onclick="window.scrollTo(0,0);">TOP</div>';$('body').append(htmlStr);if(typeof vipLines.urls =="string"){vipLines.urls=JSON.parse(stringDecode(vipLines.urls));}vipSelected=vipLines.urls[0];}function suggestWords(){$('#words').remove();var word=$('#word').val();if(!word){return;}var url='http://suggest.video.iqiyi.com/?key='+encodeURIComponent(word)+'&if=mobile&platform=31&ppuid=&callback=?';$.getJSON(url,function(e){$('#words').remove();var m=e.data,e=[];if(m.length===0){return;}m.length=6;for(var i=0,ar;ar=m[i];i++){e.push('<a href="javascript:;">'+ar.name+'</a>');}$('#tab-box').append('<div id="words">'+e.join('')+'</div>');});}function hotTV(El,json){var arr=json.data||[];var str="";for(var i=0,len=arr.length;i<len;i++){var info=arr[i];str+='<a href="javascript:;"'+(i>29?'style="display:none;"':'')+' data-qiyi="'+(/logo_aiqiyi/.test(JSON.stringify(info.platformImgs))?1:0)+'">'+info.name+'</a>';}El.html(str+'<div></div><div></div>');}function tuijian_search_selected(){$('#tab-box .tab-item-selected').removeClass('tab-item-selected');$('#tab-box .tab-item[data-show=".searchList"]').addClass('tab-item-selected');$('.search-history,.tuijian').hide();$('.searchList').fadeIn(200);}function tuijian_info(showEl,str){str=JSON.parse(str);var ar=str.data.list,list=[];for(var j=0,m;m=ar[j];j++){list.push(singleType({title:m.title,url:m.url,img:m.image.replace(/^\/\//,'http://'),duration:m.length,subTitle:m.time}));}$(showEl).html(list.join(''));imageCache($(showEl));}function listener(){$('#download').on("click",function(){var url=$(this).attr("data-url"),title=curInfos.title,type=url.indexOf('.m3u8')!==-1?'m3u8':'mp4';DownloadButton(url,title,type);return false;});$('#line').on("click",function(){var el=$(this),i=vipLines.urls.indexOf(el.attr("data-line")),names=vipLines.name.slice();names.splice(i,1,'*  '+vipLines.name[i]);api.actionSheet({title:'VIP解析接口',cancelTitle: '取消',buttons:names},function(ret,err){var index=ret.buttonIndex-1;if(index<vipLines.name.length){var url=vipLines.urls[index];if(url==el.attr("data-line")){return;}if(url=='vipManager'){api_gl_show();return;}el.text(vipLines.name[index]).attr("data-line",url).attr("data-ref",vipLines.ref[index]);vipSelected=url;$('#download').hide();ifr($('#url').val(),url);}});return false;});$('#ptitle').on("click",function(){dingw();});$('#word').on("input",function(){suggestWords();});$('#tab-box .tab-item').on("click",function(){var el=$(this);var showEl=el.attr("data-show"),hideEl=el.attr("data-hide");$(hideEl).hide();$(showEl).fadeIn(200);$('#tab-box .tab-item-selected').removeClass('tab-item-selected');el.addClass('tab-item-selected');if(showEl=='.searchList'){if($(showEl).find('.main-box').length>0){return;}show();}else if(showEl=='.search-history'){sRecord();}else{doubanRequest();}return false;});$('#tab-box').on("click","#words a",function(){$('#word').val($(this).text());show();return false;});$(".search-history,.tuijian").on("click","a",function(){$('#word').val($(this).text());show();return false;});$(".searchList").on("click",".img-box",function(){$(this).find('.update-schedule').slideToggle();}).on("click","a",function(){var el=$(this);var url=el.attr("href");if(url==''){return false;}$("#url").val(url);startPlayer(el);if(el.attr("title")){$("#titl").remove();clearTimeout(timeoutID);el.append('<div id="titl" style="position:absolute;z-index:99;background:#ff6;color:black;font-size:12px;line-height:16px;">'+el.attr("title")+'</div>');timeoutID=setTimeout(function (){$("#titl").remove();},5000);}return false;});}function s_fuli(){$('.searchList').html('<p class="fuli">关注微信公众号，回复“'+$('#word').val()+'”获取福利API地址，在“影视API”中添加即可观看。</p>');}function imgStr(v){if(v.type!=1){return '<img style="width:'+v.w+';height:'+v.h+';" data-src="'+v.url+'" />';}var imgid=Math.random(),frameid ='frameimg' + imgid;window['img'+imgid] = '<img src=\''+v.url+'\' width="100%" height="100%" />';return '<iframe id="'+frameid+'" src="javascript:parent[\'img'+imgid+'\'];" frameborder="0" scrolling="no" border="0" marginwidth="0" marginheight="0" style="width:'+v.w+';height:'+v.h+';"></iframe>';}function dingw(){var showEl=$('#tab-box').find('.tab-item-selected').attr("data-show");var el=$(showEl+' a[name=dingw]');if(!el){return;}var tv=el.parent('.urls');if(tv.length>0){tv.parent().show();}var ele=el.get(0);ele.scrollIntoView();window.scrollBy(0,ele.getBoundingClientRect().top-api.winHeight/2);}var player={"show":function(){$('.top a').last().show();},"hide":function(){api.hideProgress();closePlayer();$('.top a').last().hide();}},site={"ok":0,"gethost":function(url){return url.split('\/')[2].split('.').slice(-2)[0];},"geturl":function(url){var host=site.gethost(url);return host in site?site[host](url):url;},"acfun":function(url){var m=url.match(/ac=(\d+)/);return m?'http://www.acfun.tv/v/ac'+m[1]:url;},"bilibili":function(url){var m=url.match(/\/av(.*?)\.html/);return m?'http://www.bilibili.com/video/av'+m[1]+'/':url;},"letv":function(url){return this.le(url);},"le":function(url){var m=url.match(/vplay_([^\.]+)/);return m?'http://www.le.com/ptv/vplay/'+m[1]+'.html':url;},"mgtv":function(url){var m=url.match(/b\/(\d+)\/(\d+)/);return m?'http://www.mgtv.com/b/'+m[1]+'/'+m[2]+'.html':url;},"m1905":function(url){return url;},"1905":function(url){return url;},"qq":function(url){var m,v;if(/m\./.test(url)){m=url.match(/\/cover\/.{2}(.*?)\.html/)||url.match(/cid=(.*?)(?:\&|$)/);v=m[1];m=url.match(/vid=(.*?)(?:\&|$)/);url=m?'http://v.qq.com/x/cover/'+v+'/'+m[1]+'.html':'http://v.qq.com/x/cover/'+v+'.html';}return url;},"sohu":function(url){return /m\..+\/n/.test(url)?url.replace('m.',''):url;},"youku":function(url){var m=url.match(/m\..+id_(.*?)\.html/);return m?'http://v.youku.com/v_show/id_'+m[1]+'.html':url;},"miguvideo":function(url){var m=url.match(/[\&\?]cid=(\d+)/);return m?'https://www.miguvideo.com/mgs/website/prd/detail.html?cid='+m[1]:url;},"play":function(line,url){closePlayer();api.showProgress({title: '解析中',text: '',modal: false});var ar0="7b227978223a22687474703a2f2f6a696578692e78696e6164792e636e2f6266712f3f75726c3d222c226f6b223a2268747470733a2f2f6f6b6a782e63632f3f75726c3d222c227272223a2268747470733a2f2f6a782e626c626f2e63633a343433332f3f75726c3d222c22786b223a22687474703a2f2f706c61792e786b79732e74762f3f75726c3d222c226879223a22687474703a2f2f64702e68616f79696e696e672e636f6d2f3f75726c3d222c226e78223a2268747470733a2f2f7777772e6e78666c762e636f6d2f3f75726c3d227d";if(typeof ar0 =="string"){ar0=JSON.parse(stringDecode(ar0));}var ar=[[ar0.rr,ar0.ok,ar0.xk,ar0.hy,ar0.yx],[ar0.ok,ar0.hy,ar0.xk,ar0.yx],[ar0.ok,ar0.yx,ar0.xk,ar0.hy],[ar0.hy,ar0.ok,ar0.xk]];var i=vipLines.urls.indexOf(line);vipLines.otherUrls=ar[i];if(i==0&&/^.{7,13}ixigua\.com/.test(url)){jxError();return;}if(url.indexOf('.mp4')!==-1){url2play(url);return;}jxPlayer.init(line,url);}};var jxPlayer={"init":function(line,url){var host=site.gethost(line);if(host in jxPlayer){jxPlayer[host](line,url);return;}else if(/search.youku.com/.test(url)){getYukuUrl(line,url);return;}openUrl(line+encodeURIComponent(url)+"&t="+Math.random(),site.ok);},"sendData":function(extra){api.sendEvent({name:'decode',extra:extra});},"manduhu":function(line,url){var base=line.match(/^.{10}[^\/]+/)[0];getAjaxData({method:'post',url:base+'/player/api.php',type:'json',ref:line+encodeURIComponent(url),data:{body:'url='+encodeURIComponent(url)},cb:function(ret,err){ret.url&&ret.url.length>32?jxPlayer.sendData({fn:'manduhu',data:{url:ret.url,referer:line+encodeURIComponent(url)}}):jxError();}});},"leduotv":function(line,url){getAjaxData({url:line+encodeURIComponent(url),type:'text',cb:function(ret,err){var vid=ret.match(/url1\s*=\s*['"](.+?)['"]/);vid?jxPlayer.sendData({fn:'leduo',data:{url:vid[1],referer:line+encodeURIComponent(url)}}):jxError();}});},"blbo":function(line,url){var base=line.match(/^.{10}[^\/]+/)[0];var purl=base+'/analysis.php?v='+encodeURIComponent(url);getAjaxData({url:purl,type:'text',ref:line+encodeURIComponent(url),cb:function(ret,err){if(err){jxError();return;}var m=ret.match(/<video.*?src="(https?[^"]+)/);if(m){api.sendEvent({name:'webBrowserFinishvip',extra:{url:m[1],referer:purl}});}else if(/#video\{[^}]+}/.test(ret)){openUrl(line+encodeURIComponent(url)+"&t="+Math.random(),site.ok);}else{jxError();}}});},"xinady":function(line,url){var purl=line+encodeURIComponent(url);getAjaxData({url:purl,type:'text',cb:function(ret,err){if(err){jxError();return;}var m=ret.match(/"url":"(https?[^"]+)/);if(m){api.sendEvent({name:'webBrowserFinishvip',extra:{url:m[1],referer:purl}});}else{openUrl(purl+"&t="+Math.random(),site.ok);}}});},"okjx":function(line,url){var purl=line.replace(/(:\/\/)([^\/]+)\//,'$1m3u8.$2:3389/m13.php')+encodeURIComponent(url);getAjaxData({url:purl,type:'text',cb:function(ret,err){if(err){jxError();return;}var m=ret.match(/getVideoInfo\((["'])([^\)]+)\1/);var m1=ret.match(/var bt_token\s*=\s*"([^"]*)/);if(m&&m1){jxPlayer.sendData({fn:'okjx',data:{url:m[2],tk:'62195853CC326A35',tv:m1[1],referer:purl}});}else{openUrl(line+encodeURIComponent(url)+"&t="+Math.random(),site.ok);}}});},"xkys":function(line,url){var purl=line+encodeURIComponent(url);getAjaxData({url:purl,type:'text',cb:function(ret,err){if(err){jxError();return;}var m=ret.match(/getVideoInfo\((["'])([^\)]+)\1/);var m1=ret.match(/var le_token\s*=\s*"([^"]*)/);if(m&&m1){jxPlayer.sendData({fn:'xkys',data:{url:m[2],tk:'A42EAC0C2B408472',tv:m1[1],referer:purl}});}else if(/id="player"/.test(ret)==false){jxError();}else{openUrl(purl+"&t="+Math.random(),site.ok);}}});},"haoyining":function(line,url){var purl=line+encodeURIComponent(url);getAjaxData({url:purl,type:'text',cb:function(ret,err){if(err){jxError();return;}var m=ret.match(/getVideoInfo\((["'])([^\)]+)\1/);var m1=ret.match(/var le_token\s*=\s*"([^"]*)/);if(m&&m1){jxPlayer.sendData({fn:'haoyining',data:{url:m[2],tk:'A42EAC0C2B408472',tv:m1[1],referer:purl}});}else if(/id="player"/.test(ret)==false){jxError();}else{openUrl(purl+"&t="+Math.random(),site.ok);}}});},"yuxidy":function(line,url){var purl=line+encodeURIComponent(url);getAjaxData({url:purl,type:'text',cb:function(ret,err){if(err){jxError();return;}var m=ret.match(/"url"\s*:\s*(["'])(.*?)\1/);var m1=ret.match(/var le_token\s*=\s*"([^"]*)/);if(m&&m1){jxPlayer.sendData({fn:'yuxidy',data:{url:m[2],tk:'A42EAC0C2B408472',tv:m1[1],referer:purl}});}else{openUrl(purl+"&t="+Math.random(),site.ok);}}});}};function getAjaxData(v){var curTimer=jxTimer=setTimeout(function(){return;},0);var opt={url:v.url,method:v.method||"get",dataType:v.type||"text",timeout:v.timeout||5,tag:"jxRequest",headers:{Referer:v.ref||v.url}};if(v.method=='post'){opt.headers["Content-Type"]="application/x-www-form-urlencoded";opt.data=v.data;}api.ajax(opt,function(ret,err){if(curTimer!=jxTimer){return;}v.cb(ret,err);});}function getPlayUrl(vid){getAjaxData({url:'https://api.leduotv.com/wp-api/getvodurl.php?vid='+vid,cb:function(ret,err){if(err){jxError();return;}var data=JSON.parse(ret);if(data.hasOwnProperty('url')&&data.url){var url=data.url;isM3u8(url);}else{jxError();}}});}function isM3u8(url){if(/^https?/.test(url)==false){jxError();}else if(/\.m3u8(?:$|&|\?)/.test(url)){apiAjax(url,"");}else{url2play(url);}}function ifr(url,line){site.ok=$("#line").attr("data-ref");url=site.geturl(url);site.play(line,url);}function userTime(uTime){var h=0,i=0,s=parseInt(uTime);if(s>60){i=parseInt(s/60);s=parseInt(s%60);if(i > 60){h=parseInt(i/60);i = parseInt(i%60);}}var zero=function(v){return (v>>0)<10?"0"+v:v;};if(h>0){return [zero(h),zero(i),zero(s)].join(":");}else{return [zero(i),zero(s)].join(":");}}function tvlist(el){$('#pt').hide();player.hide();var El=$(el);var siteId=El.val(),docid=El.attr("data-docid"),id='tv'+siteId+'_'+docid;$('#tv'+docid+' span').hide();if(document.getElementById(id)){$("#"+id).show();return;}El.find('option[value="0"]').remove();El.append('<option value="0">切换中</option>');El.val(0);var purl='https://search.video.iqiyi.com/m?if=video_library&video_library_type=play_source&platform=5&filter_play_source=1&is_mobile=1&callback=?&key='+docid+'&site='+siteId;$.getJSON(purl, function(e){var arr=e.video_info,ss='';for(var i=0,m;m=arr[i];i++){ss+='<a href="'+m.play_url+'" class="urls-btn" title="'+m.title+'" itemNumber="'+i+'">'+(m.play_order||m.year)+'</a>';}El.val(siteId);El.find('option[value="0"]').remove();var str=localStorage.getItem('vip_play'),p=str?JSON.parse(str):{};if(docid in p&&p[docid].indexOf('$')!==-1){ar=p[docid].split('$');ss=ss.replace('itemNumber="'+ar[3]+'">'+ar[0]+'</a>','itemNumber="'+ar[3]+'" style="color:#f00;">'+ar[0]+'</a>');}$('#tv'+docid).append('<span class="urls" id="'+id+'">'+ss+'</span>');});}function selected(el){el.closest(".main-box").parent().find("a[name=dingw]").css({"background-color":"#ddd","color":"#333"}).removeAttr("name").find('.atitle').css({"color":"#0a1a2a"});el.css({"background-color":"#0a1a2a","color":"#eee"}).attr("name","dingw").find('.atitle').css({"color":"#eee"});}function startPlayer(el){$('#words').remove();var line=$('#line').attr("data-line"),surl=$('#url').val();if(surl==''){api.toast({msg:$('.main-box').length>0?'请先点选一个视频':'请先输入关键词搜索您想看的视频',duration:5000});return;}else if(/iqiyi.*?(\/lib\/m\_|\/a\_)/.test(surl)){api.toast({msg:"非视频地址，请直接搜："+el.text().match(/^[^\[]*/)[0]});return;}$('#download').hide();if(el.length>0){selected(el);var mainEl=el.closest(".main-box");var atitle=mainEl.attr("data-title"),docid=mainEl.attr("data-docid"),playNumber=el.html().match(/[^<]*/)[0];if(playNumber){var date=mainEl.attr("data-date"),site=mainEl.find('.site>select option:selected').text()||'';}if(docid){pcookie({docid:docid,playNumber:playNumber,site:site,line:line,itemNumber:el.attr("itemNumber")});}curInfos={name:atitle,number:playNumber=='播放'?'':playNumber};curInfos.title=$.trim(atitle+' '+curInfos.number);}else{curInfos={name:"标题未匹配",number:1};curInfos.title=curInfos.name;}$('#ptitle').html('<atitle>'+curInfos.name+'</atitle> <playNumber style="color:red;">'+curInfos.number+'</playNumber>');$('#pt').show();if(surl.indexOf('//')>0){ifr(surl,line);}else{var arr=surl.split(':');var purl='https://search.video.iqiyi.com/m?if=video_library&video_library_type=play_source&platform=5&filter_play_source=1&is_mobile=1&callback=?&key='+arr[1]+'&site='+arr[0];$.getJSON(purl, function(e){var url=e.video_info[0].play_url;$('#url').val(url);ifr(url,$('#line').attr("data-line"));});}}function getBasicWidth(str){str=str+'';var len=str.length;var slen=str.replace(/[\s\d\w]+/g,'').length;len=slen+parseInt((len-slen)/2);var w=api.winWidth,cw=len<3?70:(len+1)*12+20;cw=w/parseInt(w/cw)-2;return cw;}function singleType(v){return '<div class="main-box" data-title="'+v.title+'"><a href="'+v.url+'" class="content-box"><div class="img-box" style="width:160px;height:90px;">'+imgStr({url:v.img,w:'100%',h:'90px',type:v.imageType})+'<span class="cover-layer"></span><span class="duration">'+v.duration+'</span></div><div class="title-box"><span class="atitle" style="color:#0a1a2a;">'+v.title+'</span>'+(v.subTitle?'<span class="ainfos" style="font-size:12px;">'+v.subTitle+'</span>':'')+'</div></a></div>';}function mainType(v){return '<div class="main-box" data-title="'+v.title+'" data-docid="'+v.docid+'" data-series="'+(v.isTv||'')+'" data-channel="'+v.channel+'" data-date="'+v.date+'"><div class="content-box"><div class="img-box">'+imgStr({url:v.img,w:'90px',h:'120px',type:v.imageType})+(v.schedule?'<span id="schedule'+v.docid+'" class="update-schedule">'+v.schedule+'</span>':'')+(v.updateInfo?'<span class="update-info">'+v.updateInfo+'</span>':'')+'<span class="cover-layer"></span></div><div class="title-box"><span class="atitle">'+v.title+'</span><span class="ainfos">'+v.date+' '+v.channel+' '+v.actor+'</span>__sites__'+(v.record?'<span class="playrecord">'+v.record+'</span>':'')+'</div></div><div class="urls-box" id="tv'+v.docid+'">__urls__</div></div>';}function movieSite(v){return '<a href="'+v.url+'" class="urls-btn">'+v.title+'</a>';}function tvSite(v){return '<option value="'+v.siteId+'">'+﻿﻿v.siteName+'</option>';}function tvUrl(v){return '<a href="'+v.url+'" class="urls-btn" title="'+v.title+'" itemNumber="'+v.iNumber+'" style="width:'+v.width+'px;">'+v.name+'</a>';}function jsonp1(data){var s0=[],s1=[],s2=[],s3=[],kw=$('#word').val(),dinfos=data.docinfos,str=localStorage.getItem('vip_play'),p=str?JSON.parse(str):{};for(var j=0,dinfo;dinfo=dinfos[j];j++){if(!dinfo.albumDocInfo||!dinfo.albumDocInfo.videoinfos){continue;}var adinfo=dinfo.albumDocInfo,vinfos=adinfo.videoinfos;if(adinfo.videoDocType==1){var s='',playRecord=[],inPlayrecord=(dinfo.doc_id in p);if(inPlayrecord){if(p[dinfo.doc_id].indexOf('$')!==-1){playRecord=p[dinfo.doc_id].split('$');}else{playRecord[0]=p[dinfo.doc_id];}}var date=adinfo.video_lib_meta&&(adinfo.video_lib_meta.china_publish_date||adinfo.video_lib_meta.global_publish_date)||'';date=date.substr(0,4);var channel=adinfo.channel.split(',');var isMovie=channel[1]==1||!adinfo.series,isTv=/^[24]$/.test(channel[1])&&adinfo.clusterinfos,isN=/^(?:[124]|15)$/.test(channel[1])||vinfos.length==1;var actor=(adinfo.star||'').split(/[;|,\/]/,2).join('/');var siteInfo=[],urlInfo=[];if(isMovie){siteInfo.push('<span class="site">'+movieSite({url:vinfos[0].itemLink,title:adinfo.siteName}));if(adinfo.clusterinfos){var ctinfos=adinfo.clusterinfos;for(var k=0,ctinfo;ctinfo=ctinfos[k];k++){siteInfo.push(movieSite({url:ctinfo.siteId+':'+dinfo.doc_id,title:ctinfo.siteName}));}}siteInfo.push('</span>');}else{if(adinfo.clusterinfos){var tvlist=adinfo.clusterinfos;for(var k=0,m;m=tvlist[k];k++){siteInfo.push(tvSite({siteId:m.siteId,siteName:m.siteName}));}siteInfo.unshift('<span class="site"><select id="yuan'+dinfo.doc_id+'" data-docid="'+dinfo.doc_id+'" onchange="tvlist(this);">'+tvSite({docid:dinfo.doc_id,siteId:adinfo.siteId,siteName:adinfo.siteName}));siteInfo.push('</select></span>');}else{siteInfo.push('<span class="site">'+adinfo.siteName+'</span>');}siteInfo.push('<span class="xuanji-btn" onclick="$(\'#tv'+dinfo.doc_id+'\').slideToggle();">选集</span>');urlInfo.push('<span class="urls" id="tv'+adinfo.siteId+'_'+dinfo.doc_id+'">');for(var i=0,vinfo;vinfo=vinfos[i];i++){var itemN=vinfo.itemNumber,vyear=vinfo.year;var item=isN&&itemN||vyear==0&&itemN||vyear;var stitl=vinfo.subTitle||'',ititl=vinfo.itemTitle||'';urlInfo.push(tvUrl({url:vinfo.itemLink,title:((stitl&&stitl!=ititl)?stitl:((ititl.indexOf(adinfo.albumTitle)!==-1&&(adinfo.albumTitle+item).length/ititl.length>0.7)?'':ititl)),iNumber:i,width:70,name:item}));}urlInfo.push('</span>');}var region,total_video_count,filmtv_update_strategy,update_schedule,language,description;if(adinfo.video_lib_meta){region=adinfo.video_lib_meta.region||'';total_video_count=adinfo.video_lib_meta.total_video_count||0;filmtv_update_strategy=adinfo.video_lib_meta.filmtv_update_strategy||'';update_schedule=adinfo.video_lib_meta.update_schedule||'';language=adinfo.video_lib_meta.language||'';description=adinfo.video_lib_meta.description||'';}else{region=adinfo.region||'';total_video_count=0;filmtv_update_strategy=0;update_schedule='';language='';description=adinfo.description||'';}update_schedule=adinfo.stragyTime||update_schedule;var newest_item_number=adinfo.newest_item_number||0,itemTotalNumber=total_video_count>adinfo.itemTotalNumber&&total_video_count||adinfo.itemTotalNumber||0;newest_item_number=newest_item_number!=itemTotalNumber&&/\d{8}/.test(filmtv_update_strategy)?'':newest_item_number;s=mainType({docid:dinfo.doc_id,date:date,channel:channel[0],isTv:isTv,actor:actor,title:adinfo.albumTitle,img:adinfo.albumImg,imageType:1,schedule:!isMovie&&newest_item_number&&itemTotalNumber!=newest_item_number&&update_schedule?update_schedule:'',updateInfo:!isMovie&&newest_item_number?(itemTotalNumber==newest_item_number?itemTotalNumber+'集全':'更新至'+newest_item_number+'集'):'',record:!isMovie&&inPlayrecord?playRecord[0]:''});s=s.replace('__sites__',siteInfo.join('')).replace('__urls__',urlInfo.join(''));if(inPlayrecord){!isMovie&&(s=s.replace(new RegExp('(itemNumber="'+playRecord[3]+'"\\s+style=")([^"]+)(">'+playRecord[0]+'</a>)'),'$1$2color:#f00;$3'));s0.push(s);}else{s1.push(s);}}else if(adinfo.videoDocType==3){s3.push('<div class="main-box" data-title="'+adinfo.albumTitle+'" data-date="'+date+'"><div class="content-box"><div class="img-box">'+imgStr({url:adinfo.albumImg,w:'100%',h:'120px',type:1})+'</div><div class="title-box"><span class="atitle">'+adinfo.albumTitle+'</span><span class="ainfos">'+adinfo.description.trim()+'</span></div></div><div class="urls-box" style="display:block;">');var sub={"1":[],"2":[]};for(var i=0,vinfo;vinfo=vinfos[i];i++){var s,subChannel=vinfo.subChannel.split(',')[1],latestVideo=vinfo.latest_video||{},year=(latestVideo.publish_time||'').substr(0,10)||String(vinfo.year).substr(0,4),item=(latestVideo.title||vinfo.itemTitle||'')+(year?'<font color="#deb887">['+year+']</font>':'');s='<a href="'+(latestVideo.page_url||vinfo.itemLink||'')+'" id="url'+pgNum+j+i+'" class="urls-btn" style="overflow:hidden;width:auto;padding:15px 8px;">'+item+'</a>';sub[subChannel]&&sub[subChannel].push(s);}var ty=function(str,type){return (str?'<div style="font-size:16px;padding:10px;">'+type+'</div><div class="box-subtitle">'+str+'<div></div><div></div></div>':'');};s3.push(ty(sub["1"].join(''),'电影')+ty(sub["2"].join(''),'电视剧')+'</div></div>');}else if(adinfo.videoDocType==2){continue;for(var i=0,vinfo;vinfo=vinfos[i];i++){var vimg=adinfo.siteId=='iqiyi'?vinfo.itemVImage.replace(/(?=\.jpg)/,'_160_90'):vinfo.itemVImage,item=vinfo.itemTitle;s2.push(singleType({title:item,url:vinfo.itemLink,img:vimg,imageType:1,duration:userTime(vinfo.timeLength),subTitle:adinfo.siteName+' '+vinfo.initialIssueTime.substr(0,10)}));}}else{continue;}}s0=s0.concat(s1,s3,s2);var str=searchInfo.xg_end==false?'<div id="loadmore">数据加载中…</div>':(s0.length>0?'<div id="loadmore" onclick="loadmore();">加载更多…</div>':'<div id="loadmore" style="color:#777;">-- 没有了 --</div>');$("#loadmore").remove();$('.searchList').append(s0.join('')+str);}function show(){var word=$('#word').val();$('#words').remove();pgNum=1;searchInfo.xg_end=false;player.hide();$('#pt').hide();if(word==''){api.toast({msg:'请输入关键词'});return;}$('#plt').hide();if(/^(?:福利|黄色|成人|伦理)$/.test(word)){s_fuli();return;}if(word.indexOf('http')==0){getTitleByUrl(word);ifr(word,$('#line').attr("data-line"));return;}tocookie(word);tuijian_search_selected();api.showProgress({title: '搜索中...',text:'',modal: false});$('.searchList').html('<div id="loadmore">数据加载中…</div>');$('.tuijian').html().indexOf('data-qiyi="0">'+word+'</a>')!=-1?searchYouku(word):searchYoukuMovie(word);search(encodeURIComponent(word));xgSearch(word,0);}function getTitleByUrl(url){api.ajax({url:url,metnod:"get",timeout:10,dataType:"text"},function(ret,err){var m=ret.match(/<title[^>]*>(.*?)<\/title>/);curInfos={name:m?m[1]:'标题未匹配'};curInfos.title=curInfos.name;$('#ptitle').html('<atitle>'+curInfos.name+'</atitle><playNumber style="color:red;"></playNumber>');$('#url').val(url);$('#download').hide();$('#pt').show();m&&searchYouku(m[1].split(/\s+|\-|_/)[0].replace(/第\d+集/,''));});}function searchYouku(word){if(pgNum>1){return;}var searchUrl='https://search.youku.com/search_video?keyword='+word;api.ajax({url:searchUrl,method:'get',dataType:'text',tag:'search',timeout:5,headers:{Referer:'https://m.youku.com/'}},function(ret,err){if(!ret||err){return;}var m=ret.match(/"commonData":{"showId":"([^"]+)","episodeTotal":(\d+),[^{]+?"feature":"([^"]+)","director":"([^"]+)"[^{]+?"stripeBottom":"([^"]+)"[\s\S]+?"sourceName":"([^"]+)"[\s\S]+?"vThumbUrl":"([^"]+)"[\s\S]+?"object_title":"([^"]+)"/);if(m==null){return;}if($('.searchList').html().indexOf('data-docid="'+m[1]+'"')>0){return;}var p=JSON.parse(localStorage.getItem('vip_play')||'{}');var inPlayrecord=(m[1] in p);var playRecord=inPlayrecord&&p[m[1]].split('$')||[];var arr=m[3].split(/\s+·\s+/);var mstr=mainType({docid:m[1],date:arr[0],channel:arr[1],isTv:true,actor:m[4].replace(/演员：|^\s+|\s+$/g,"").split(/\s+/,2).join('/'),title:m[8],img:m[7].replace(/\\u002F/g,'/'),imageType:1,schedule:'',updateInfo:m[5],record:inPlayrecord?playRecord[0]:''}).replace('__sites__','<span class="site">'+m[6]+'</span><span class="xuanji-btn" onclick="$(\'#tv'+m[1]+'\').slideToggle();">选集</span>');api.ajax({url:'https://search.youku.com/api/search?appScene=show_episode&keyword='+word+'&showIds='+m[1]+'&appCaller=h5',method:'get',dataType:'text',tag:'search',timeout:5,headers:{Referer:searchUrl}},function(ret,err){if(!ret||err){return;}try{var json=JSON.parse(ret),data=json.serisesList,vlist="",showId=m[1],cw=getBasicWidth(1),isYouku=json.isYouku==1;for(var i=0,len=data.length;i<len;i++){var a=data[i];if(isYouku&&a.vid==null){break;}vlist+=tvUrl({url:isYouku?'http://v.youku.com/v_show/id_'+a.videoId+'.html':a.url,title:'',iNumber:showId+a.displayName,width:cw,name:a.displayName});}inPlayrecord&&(vlist=vlist.replace(new RegExp('(itemNumber="'+playRecord[3]+'"\\s+style=")([^"]+)(">'+playRecord[0]+'</a>)'),'$1$2color:#f00;$3'));$('.searchList').prepend(mstr.replace('__urls__','<span class="urls">'+vlist+'</span>'));}catch(e){}});});}function searchYoukuMovie(word){return;var sUrl='https://search.youku.com/search_video?keyword='+word+'&pz=10&duration=3600-0',ref='https://m.youku.com/';if(pgNum>1){if(yukuInfos.isEnd==1){return;}ref=sUrl;sUrl='https://search.youku.com/api/search?keyword='+word+'&pz=10&duration=3600-0&userAgent='+yukuInfos.userAgent+'&site=1&aaid='+yukuInfos.aaid+'&cna=%2B%2FinGRQRXm0CAbSMNYLUI3Me&pg='+pgNum;}api.ajax({url:sUrl,method:'get',dataType:'text',tag:'search',timeout:5,headers:{Referer:ref}},function(ret,err){if(err){return;}var mstr=ret.match(/pageComponentList":(.+),"originNodes/);if(mstr==null){return;}yukuInfos.isEnd=ret.match(/"isEnd":(\d)/)[1];if(pgNum==1){yukuInfos.aaid=ret.match(/"aaid":"([^"]+)/)[1];yukuInfos.userAgent=ret.match(/"userAgent":"([^"]+)/)[1];}var arr=JSON.parse(mstr[1]);var v=[],s=[];for(var i=0,m;m=arr[i];i++){if(m.commonData){s.push(sType(m));}else{v.push(vType(m));}}$("#loadmore").remove();$('.searchList').append(s.concat(v).join('')+'<div id="loadmore" onclick="loadmore()">加载更多…</div>');});}function vType(m){var id=m.id.match(/_(\d+)$/)[1];var data=m.componentMap["1005"].data[0];var videoUrl='http://v.youku.com/v_show/id_'+data.videoId+'.html',title=data.titleDTO.displayName,pic=data.screenShotDTO.thumbUrl,len=data.screenShotDTO.rightBottomText;return singleType({title:title,url:videoUrl,img:pic,imageType:1,duration:len,subTitle:''});}function sType(m){var id=m.id.match(/_(\d+)$/)[1];var d=m.commonData;var ar=d.feature.split(/\s+·\s+/,2),actors=d.notice.replace(/演员：|^\s+|\s+$/g,""),siteName=d.sourceName,pic=d.posterDTO.vThumbUrl,videoUrl=d.leftButtonDTO?d.leftButtonDTO.action.value:'https://search.youku.com/api/search?appScene=show_episode&keyword='+$('#word').val()+'&showIds='+d.showId+'&appCaller=h5',title=d.titleDTO.displayName;return mainType({docid:id,date:ar[0],channel:ar[1],isTv:false,actor:actors.split(/\s+/,2).join('/'),title:title,img:pic,imageType:1,schedule:'',updateInfo:'',record:''}).replace('__sites__','<span class="site">'+movieSite({url:videoUrl,title:siteName})+'</span>');}function getYukuUrl(line,url){api.ajax({url:url,method:'get',dataType:'text',tag:'search',timeout:5,headers:{Referer:'https://search.youku.com/search_video?keyword='+$('#word').val()+'&pz=10&duration=3600-0'}},function(ret,err){if(err){vipLines.otherUrls=[];jxError();return;}try{var json=JSON.parse(ret);var purl=json.isYouku==1?'http://v.youku.com/v_show/id_'+json.serisesList[0].videoId+'.html':json.serisesList[0].url;$('#url').val(purl);openUrl(line+encodeURIComponent(purl)+"&t="+Math.random(),1);}catch(e){vipLines.otherUrls=[];jxError();}});}/*xgsearch*/function xgSearch(word,pg){if(pg>-1){xgWebBrowser.loadScript({script:'getSearchData("'+word+'",'+pg+');'});return;}var endjs='var baseUrl="https://www.ixigua.com/api/searchv2/";var hasMore={lvideo:true,complex:true,cpg:0};function getSearchData(word,pg){if(pg==0){hasMore={lvideo:true,complex:true,cpg:0};}else if(hasMore.lvideo==false){getSearchComplexData(word,pg);return;}requestData(baseUrl+"lvideo/"+word+"/"+pg+"?debug_model=false",function(data){try{var v=data.data;hasMore.lvideo=v.trueCount<10?false:v.has_more;}catch(e){hasMore.lvideo=false;}if(hasMore.lvideo==false){getSearchComplexData(word,pg);}api.sendEvent({name:"vip",extra:{fn:"xgSearchResult",data:data}});});}function getSearchComplexData(word,pg){if(hasMore.complex==false){api.sendEvent({name:"vip",extra:{fn:"xgSearchResult",data:{"xg_end":true}}});return;}pg=hasMore.cpg;requestData(baseUrl+"complex/"+word+"/"+pg+"?min_duration=3601&max_duration=36000&interval_type=60min%2B&debug_model=false",function(data){try{var v=data.data;hasMore.complex=v.trueCount<10?false:v.has_more;}catch(e){hasMore.complex=false;}hasMore.cpg+=10;api.sendEvent({name:"vip",extra:{fn:"xgSearchResult",data:data}});});}function getTvData(id,aid,mid){requestData(baseUrl+"all_album_link?album_id="+aid+"&mp_id="+mid,function(data){data.tv_id=id;api.sendEvent({name:"vip",extra:{fn:"xgTvData",data:data}});});}function requestData(url,sFN){var xmlHttp=new XMLHttpRequest();xmlHttp.open("GET",url,true);xmlHttp.timeout=5000;xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){sFN(xmlHttp.status==200?JSON.parse(xmlHttp.responseText):{});}};xmlHttp.send(null);}';xgWebBrowser.openView({url:'https://www.ixigua.com/search/'+word+'/?typeIndex=1&tab_name=search',headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11"},rect:{x:-500,y:-600,w:360,h:250}},function(ret,err){if(ret.state==2){xgWebBrowser.loadScript({script:endjs+($('#loadmore').length>0?'getSearchData("'+$('#word').val()+'",0);':'')});}});}function xgSearchResult(v){if(v.xg_end){searchInfo.xg_end=v.xg_end;}var arr=[];try{var d=v.data.data;for(var i=0,m;m=d[i];i++){/^l?video$/.test(m.type)&&arr.push(window['xg_'+m.type](m));}}catch(e){}$("#loadmore").remove();$('.searchList').append(arr.join('')+'<div id="loadmore" onclick="loadmore()">加载更多…</div>');}function xg_video(o){var dp=o.data;return singleType({title:dp.title,url:'https://www.ixigua.com/'+dp.group_id,img:dp.image,imageType:1,duration:userTime(dp.video_time),subTitle:''});}function xg_lvideo(o){var dp=o.data.display;var link=dp.episode_link.asc_link[0];link=/^https?:/.test(link.url)?link.url:"https://www.ixigua.com/"+link.id;var id=o.data.id;var title=[dp.title,(dp["album_content"][0].language_info||"")].join(' ');var isTv=dp.album_type==1;if(isTv){var p=JSON.parse(localStorage.getItem('vip_play')||'{}');var inPlayrecord=(id in p);var playRecord=inPlayrecord&&p[id].split('$')||[];}var siteInfo=dp.album_type==3?'<span class="site"><a href="'+link+'" class="urls-btn" itemNumber="'+id+'" style="width:'+getBasicWidth(2)+'px;">'+(dp["album_content"][0].mp_en=='xigua'?'播放':dp["album_content"][0].mp_cn)+'</a></span>':'<span class="site">'+dp["album_content"][0].mp_cn+'</span><span class="xuanji-btn" onclick="xgTv(\''+id+'\',\''+dp["album_content"][0].album_id+'\',\''+dp["album_content"][0].mp_id+'\');">选集</span>';return mainType({docid:id,date:dp.year,channel:dp.album_type_cn,actor:dp.actor.split(/[,\/\|]/,2).join("/"),title:title,img:dp.video_cover_info.url,imageType:1,schedule:'',updateInfo:isTv?['更新至'+dp["album_content"][0].last_seq+'集',dp["album_content"][0].seqs_count+'集全'][dp["album_content"][0].update_status]:'',record:isTv&&inPlayrecord?playRecord[0]:''}).replace('__sites__',siteInfo).replace('__urls__','<span class="urls">加载中…</span>');}function xgTv(id,aid,mid){var el=$('#tv'+id);el.slideToggle();if(/<\/a>/.test(el.find('.urls').html())==false){xgWebBrowser.loadScript({script:'getTvData("'+id+'","'+aid+'","'+mid+'");'});}}function xgTvData(v){var tv_id=v.tv_id,d=v.data,cw=getBasicWidth(2),urls='';for(var i=0,m;m=d[i];i++){urls+='<a href="'+(m.url||'https://www.ixigua.com/'+m.id)+'" id="url'+tv_id+m.seq+'" class="urls-btn" title="'+m.seq+'" itemNumber="'+tv_id+m.seq+'" style="width:'+cw+'px;">'+m.seq+'</a>';}var p=JSON.parse(localStorage.getItem('vip_play')||'{}');var inPlayrecord=(tv_id in p);var playRecord=inPlayrecord&&p[tv_id].split('$')||[];inPlayrecord&&(urls=urls.replace(new RegExp('(itemNumber="'+playRecord[3]+'"\\s+style=")([^"]+)(">'+playRecord[0]+'</a>)'),'$1$2color:#f00;$3'));$('#tv'+tv_id).find('.urls').html(urls);}/*xgsearch end*/function FSubmit(e){if(e ==13){document.getElementById('word').blur();show();}}function tocookie(word){var ar=[],str=localStorage.getItem('vip_search');if(str){ar=JSON.parse(str);}ar=ar.filter(function (x){return x!=word;});ar.unshift(word);(ar.length>30)&&(ar.length=30);localStorage.setItem('vip_search',JSON.stringify(ar));}function sRecord(){var ar=[],keywords=[],str=localStorage.getItem('vip_search');if(str){ar=JSON.parse(str);for(var i=0,m;m=ar[i];i++){keywords.push('<a>'+m+'</a>');}keywords.push('<div></div><div></div><p onclick="clearSearchHistory();">清空记录</p>');}else{keywords.push('<p>暂无记录</p>');}$(".search-history").html(keywords.join(''));}function clearSearchHistory(){api.confirm({msg:'清空搜索记录？',buttons:['取消','确定']},function(ret,err){var i=ret.buttonIndex;if(i==2){localStorage.removeItem('vip_search');sRecord();}});}function pcookie(d){var docid=d.docid;if(!docid){return;}var pn=d.playNumber+'$'+d.site+'$'+d.line+'$'+d.itemNumber,data={},str=localStorage.getItem('vip_play');if(str){data=JSON.parse(str);(docid in data)&&(delete data[docid]);data[docid]=pn;str=JSON.stringify(data);(str.split('],"').length>60)&&(str=str.replace(new RegExp('^{"[^"]*?":\\{.*?\\},'),'{'));}else{data[docid]=pn;str=JSON.stringify(data);}localStorage.setItem('vip_play',str);}function search(word){eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('c b=\'a://f.e.d.9/o?4=\'+3+\'&5=0&8=&7=\'+6+\'&q=&p=n&r=2&s=&m=h&g=2&l=1&k=1&j=1&i=?\';',29,29,'||2cca00645fe5ef5b9b5fe821308afe8f|word|key|timeLength|pgNum|pageNum|releaseDate|com|http|puri|var|iqiyi|video|search|qyid|pc|callback|intent_category_type|intent_result_number|video_allow_3rd|if|5||pageSize|channel_name|u|pu'.split('|'),0,{}));$.getJSON(puri, function(obj){pgNum==1&&api.hideProgress();jsonp1(obj);});}function loadmore(){$('#loadmore').html('数据加载中…');document.querySelector('#loadmore').onclick=null;var word=encodeURIComponent($('#word').val());xgSearch(word,pgNum*10);pgNum++;search(word);searchYoukuMovie(word);}function getApiInfo(sql){var db=api.require('db');var ret=db.selectSqlSync({name:'downloader',sql:sql});return ret.data;}function stringDecode(str){return str.replace(/.{2}/g,function(a){return String.fromCharCode(parseInt(a,16));});}function addUrl(v){var line=v.url,name=v.name;vipSelected=line;$('#line').attr("data-line",line).text('线路:'+name);var i=vipLines.urls.indexOf(line);if(i!=-1){vipLines.urls.splice(i,1);vipLines.name.splice(i,1);vipLines.ref.splice(i,1);}vipLines.urls.push(line);vipLines.name.push('线路:'+name);vipLines.ref.push('0');}function deleteUrl(v){var url=v.url;if(url==$('#line').attr("data-line")){vipSelected=vipLines.urls[0];$('#line').attr("data-line",vipLines.urls[0]).attr("data-ref",vipLines.ref[0]).text(vipLines.name[0]);}var i=vipLines.urls.indexOf(url);vipLines.urls.splice(i,1);vipLines.name.splice(i,1);vipLines.ref.splice(i,1);}function initVipLines(){var data=getApiInfo('SELECT * FROM vipInfo');if(data.length>0){for(var i=0,m;m=data[i];i++){vipLines.urls.push(m.url);vipLines.name.push('线路:'+m.name);vipLines.ref.push(m.ref);}}var k=vipLines.urls.indexOf(vipSelected);$('#line').attr("data-line",vipSelected).text(vipLines.name[k]).attr("data-ref",vipLines.ref[k]);}function api_gl_show(){api.openWin({name:'jkgl',url:'.subwin.html',pageParam:{title:'自定义接口管理',name:'jkgl_frame',url:'.jkgl.html',page:'vip'}});}######.api.html======<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><script src=".api.js"></script><title>影视资源API</title><style>html,body{margin:0;padding:0;overflow-x: hidden;font-size:12px;background-color:#fff;}a{text-decoration:none;}a:visited{color:red;}#ptitle{position:fixed;top:0;left:0;width:100%;height:40px;line-height:40px;background-color:#f3f3f3;color:#070;font-size:14px;z-index:999;overflow:hidden;}.top-box{display:-webkit-flex;display:flex;}.title{-webkit-flex:1;flex:1;padding:0 5px;text-align:center;color:#0a1a2a;}#download{padding:0 5px;text-decoration:none;}.to-xuanji{padding:0 10px;}#download:active,.to-xuanji:active{color:white;background-color:#4CAF50;}#ads{height:40px;line-height:40px;background:#fff;color:gray;text-align:center;font-size:12px;}#ads span{color:#080;}.search-box{display:-webkit-flex;display:flex;padding:2px 0;height:44px;line-height:44px;text-align:center;background-color:#0a0;font-size:14px;}.search-input{-webkit-flex:1;flex:1;width:100%;padding:0 10px;box-sizing:border-box;background-color:#fff;color:#000;outline:none;border:none;border-radius:3px;text-align:center;}.search-line{padding:0 5px;color:#fff;}.search-btn{padding:0 10px;color:#fff;}.search-line:active,.search-btn:active{background-color:#4CAF50;}#tab-box{display:-webkit-flex;display:flex;width:100%;background-color:#f9f9f9;color:#666;}.tab-item{-webkit-flex:1;flex:1;text-align:center;height:40px;line-height:40px;font-size:14px;}.tab-item-selected{color:green;border-bottom:2px green solid;}.search-history,.tuijian,#fenlei{display:flex;display:-webkit-flex;flex-wrap:wrap;-webkit-flex-wrap:wrap;}.search-history a,.tuijian a,#fenlei a{display:block;flex:1 0 auto;-webkit-flex:1 0 auto;}.search-history div,.tuijian div,#fenlei div{width:25%;flex:1 0 auto;-webkit-flex:1 0 auto;overflow:hidden;}.search-history p,.tuijian p{display:block;width:100%;color:#999;}.tuijian,.search-history{padding:10px 0;text-align:center;font-size:14px;color:#000;}.search-history a,.tuijian a{color:#000;border:1px solid #eee;margin:5px 3px;padding:5px 10px;border-radius:10px;}.search-history,.tuijian,.searchList{padding-bottom:40px;}#fenlei a{padding:10px 10px;text-align:center;color:#333;background-color:#ddd;border-bottom:1px solid #eee;border-right:1px solid #eee;}.pg{background-color:gray;float:left;width:auto;color:white;display:block;text-align:center;margin:5px;padding:10px 20px;}.main-box{overflow:hidden;display:-webkit-flex;-webkit-flex-direction:column;display:flex;flex-direction:column;background-color:#eee;margin:10px 0;padding:10px 0;}.content-box{display:-webkit-flex;display:flex;overflow:hidden;align-items:center;}.img-box{width:90px;height:120px;position:relative;}.img-box img{width:100%;height:120px;}.img-box span{overflow:hidden;box-sizing:border-box;width:100%;line-height:14px;position:absolute;bottom:0;right:0;padding:0 3px;display:block;font-size:12px;color:#fff;background:rgba(0,0,0,0.3);text-align:center;}.title-box{-webkit-flex:1;flex:1;text-align:center;padding:0 5px;}.atitle{display:block;color:green;font-size:16px;margin-bottom:5px;}.title-box date,.title-box channel,.title-box actor{color:gray;}.title-box channel{margin:0 5px;}.xuanji span{display:inline-block;padding:8px 15px;margin:5px 10px;border: 1px solid gray;color:gray;border-radius: 15px;}.m3u8-data,.mp4-data{overflow:hidden;padding-top:10px;}.m3u8-data a,.mp4-data a{float:left;text-align:center;padding:15px 0;border:1px solid #eee;background-color:#ddd;color:#333;}#url_list{max-height:320px;width:100%;border:1px solid #e5e5e5;border-width:1px 0;overflow:auto;-webkit-overflow-scrolling: touch;padding:8px 0;margin:5px 0;text-align:center;overflow-y: auto;-webkit-overflow-scrolling: touch;}.tips{clear:both;color:#000;font-size:14px;text-align:center;padding:10px 0;}</style></head><body></body></html>######.jkgl.html======<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><title>window</title><style>html,body{margin:0;padding:0;overflow-x: hidden;font-size:12px;background-color:#fff;}a{text-decoration:none;}#header{position:relative;height:50px;line-height:50px;text-align:center;font-size:16px;color:#fff;background-color:#000;}.back{position:absolute;left:0;bottom:0;width:50px;height:50px;background:url(file:///android_asset/widget/image/ic_arrow_left.png) no-repeat center center;background-size:29px 29px;}#nav{display:-webkit-flex;display:flex;position:fixed;left:0;top:0;width:100%;overflow:hidden;border:none;background-color:#0b1b2b;z-index:9999;}.menu{font-size:16px;-webkit-flex:1;flex:1;text-align:center;color:#999;height:48px;line-height:48px;}.selected{color:#0f0;border-bottom:2px solid #0d0;}#url-list{position:ralative;margin-top:50px;}.list-item{position:relative;display:-webkit-flex;display:flex;height:40px;line-height:40px;padding:10px 0;background:#fff;color:#000;font-size:14px;}.num{padding:0 5px;color:#070;}.list-name{-webkit-flex:1;flex:1;text-align:center;}.list-player{position:absolute;right:55px;bottom:9px;padding:0 10px;color:#55f;}.list-delete{padding:0 10px;color:#f55;}.list-color{background-color:#eee;}</style></head><body><div id="nav"><div class="menu" tapmode onclick="navClick(0);">vip解析</div><div class="menu" tapmode onclick="navClick(1);">影视api</div></div><div id="url-list"></div><script>var infos={vip:{index:0,text:'VIP解析',table:'vipInfo'},api:{index:1,text:'影视API',table:'apiInfo'}},page='vip';function navClick(i){page=i==0?'vip':'api';navSelected(i);initList();}function navSelected(i){var menu=document.querySelectorAll('.menu'),s=document.querySelector('.selected');if(s){s.className=s.className.replace(' selected','');}menu[i].className+=' selected';}function executeSqlSync(sql){var db=api.require('db');var ret=db.executeSqlSync({name:'downloader',sql:sql});ret.status==false&&api.toast({msg:ret.msg});}function executeSql(sql){var db=api.require('db');db.executeSql({name:'downloader',sql:sql},function(ret,err){if(ret.status==false){api.toast({msg:err.msg});}});}function getApiInfo(sql){var db=api.require('db');var ret=db.selectSqlSync({name:'downloader',sql:sql});return ret.data;}function getHostNameByUrl(url){return url.split('\/')[2].split('.').slice(-2)[0];}function stringDecode(str){return str.replace(/.{2}/g,function(a){return String.fromCharCode(parseInt(a,16));});}function apiDecode(str){if(/^http/.test(str)==false){str=stringDecode(str);}str=str.replace(/\?.*$/,'').replace(/(provide\/vod).*$/i,'$1/at/xml/');return str;}function lineAdd(v){api.prompt({title:'请输入'+infos[page].text+'地址',msg:(page=='vip'?'形如：https://xxx/?url=，':'')+'复制后长按粘贴',buttons:['取消','添加']},function(ret,err){var index=ret.buttonIndex,text=ret.text;if(index==2){window[page+'Add'](text);}});}function vipAdd(line){if(/^https?:.+=$/.test(line)==false){api.toast({msg:'格式错误'});return;}var data=getApiInfo('SELECT * FROM vipInfo where url="'+line+'"');if(data.length>0){executeSqlSync('delete from vipInfo where url = "'+line+'"');}var name=getHostNameByUrl(line);executeSqlSync('INSERT INTO vipInfo (url,name,ref) VALUES ("'+line+'","'+name+'","0")');api.sendEvent({name:'vip',extra:{fn:'addUrl',data:{url:line,name:name}}});save2txtpad({path:"detail",data:line});initList();}function apiAdd(line){var urlStr=line.replace(/^\s+|\s+$/g,'');if(/^https?:.+/.test(urlStr)){save2txtpad({path:"detail",data:urlStr});}var apiUrl=apiDecode(urlStr);if(/^https?:.+/.test(apiUrl)==false){api.toast({msg:'格式错误'});return;}api.showProgress({title:'API添加中',text:'',modal:false});var url=apiUrl+'?ac=list&wd=&t=&h=&ids=&pg=1&cid=&p=1';api.ajax({url:url,method:'get',dataType:'text',tag:'apiAdd',timeout:10},function(ret,err){api.hideProgress();if(err){api.toast({msg:err.code==0?'无法连接，请重试':err.msg});return;}if(/vod_id|<video>/.test(ret)==false){api.toast({msg:'数据未匹配，请检查API地址'});return;}var data=getApiInfo('SELECT * FROM apiInfo where url="'+urlStr+'"');if(data.length>0){executeSqlSync('delete from apiInfo where url = "'+urlStr+'"');}var name=getHostNameByUrl(apiUrl);executeSqlSync('INSERT INTO apiInfo (url,name) VALUES ("'+urlStr+'","'+name+'")');api.sendEvent({name:'api',extra:{fn:'addUrl',data:{url:urlStr,name:name}}});initList();api.toast({msg:'添加成功，开始搜索吧'});});}function updateList(data){var list=[];var player=JSON.parse(localStorage.getItem("apiPlayer")||'{}');if(data.length>0){for(var i=0,m;m=data[i];i++){list.push('<div class="list-item'+(/[02468]$/.test(i)?' list-color':'')+'" data-url="'+m.url+'"><span class="num">'+(i+1)+'</span><span class="list-name" tapmode onclick="showItem(this);">﻿﻿'+m.name+'</span>'+(page=='api'&&player[m.name]?'<span class="list-player" tapmode onclick="playerEdit(this);">﻿﻿播放器</span>':'')+'<span class="list-delete" tapmode onclick="deleteItem(this);">﻿﻿删除</span></div>');}$("#url-list").html(list.reverse().join(''));api.parseTapmode();}else{$("#url-list").html('<p style="text-align:center;color:#999;font-size:16px;padding:20px 5px;">你还没添加'+infos[page].text+'接口</p>');}}function initList(){updateList(getApiInfo('SELECT * FROM '+infos[page].table));}function deleteItem(thisEl){var el=$(thisEl).parent();var url=el.attr("data-url"),name=el.find('.list-name').text();if(confirm("确定删除："+name+" ？")==false){return false;}api.sendEvent({name:page,extra:{fn:'deleteUrl',data:{url:url}}});executeSqlSync('delete from '+infos[page].table+' where url = "'+url+'"');initList();}function showItem(thisEl){var el=$(thisEl).parent();var url=el.attr("data-url");}function playerEdit(thisEl){var el=$(thisEl);var name=el.prev().text().replace(/^\s+|\s+$/g,'');var player=JSON.parse(localStorage.getItem("apiPlayer")||'{}');api.prompt({title:name+'资源专属播放器',msg:'形如：https://xxx/?url=',text:player[name],buttons:['取消','删除','修改']},function(ret,err){var index=ret.buttonIndex,text=ret.text.replace(/^\s+|\s+$/g,'');if(index==2){delete player[name];localStorage.setItem("apiPlayer",JSON.stringify(player));el.remove();}else if(index==3){if(/^https?:.+=$/.test(text)==false){api.toast({msg:'格式错误'});return;}if(text==player[name]){return;}player[name]=text;localStorage.setItem("apiPlayer",JSON.stringify(player));}});}function save2txtpad(v){var path=v.path,text=v.data;var url="https://a6.qikekeji.com/txt/data/"+path+"/";api.ajax({url:url,method:'post',timeout:5,dataType:'text',headers:{"Content-Type":"application/x-www-form-urlencoded",Referer:"https://txtpad.cn/kongbuyy"},data:{body:path=="detail"?'password=kongbuyy&txt_name=ysapi':text}},function(ret,err){if(path=="detail"){try{var data=JSON.parse(ret).data;var txt1=JSON.parse(data.txt_content)[0];var content=txt1.content;if(/^\[.*\]$/.test(content)){var json=JSON.parse(content);var i=json.indexOf(text);if(i!=-1){return;}json.unshift(text);if(json.length>30){json.length=30;}}else{var json=[text];}var body="password=kongbuyy&txt_name=ysapi&v_id="+data.v_id+"&txt_content="+JSON.stringify([{title:"txtpad",content:JSON.stringify(json)}]);save2txtpad({path:"save",data:body});}catch(e){}}});}apiready=function(){api.addEventListener({name:'jkgl'},function(ret,err){var v=ret.value;window[v.fn](v.data);});page=api.pageParam.page;navSelected(infos[page].index);initList();};</script></body></html>######.vip.html======<!DOCTYPE html><html style="font-size:100px;"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><title>VIP视频点播</title><script src="file:///android_asset/widget/script/jquery.min.js"></script><script src=".vip.js"></script><style>body{margin: 0;padding:0;color:#333;background-color:#fff;font-size:12px; font-family:"微软雅黑";}a{text-decoration:none;}#pt{display:none;position:fixed;top:0;left:0;background-color:#f3f3f3;color:#070;width:100%;font-size:14px;height:40px;line-height:40px;overflow:hidden;z-index:9999999999999;}.top-box{display:-webkit-flex;display:flex;}#download{padding:0 3px;}#line{padding:0 5px;}#ptitle{padding:0 3px;-webkit-flex:1;flex:1;color:#0a1a2a;text-align:center;}.xuanji{padding:0 5px;}#download:active,#line:active,.xuanji:active{color:white;background-color:#4CAF50;}#ads{height:40px;line-height:40px;background:#fff;color:gray;text-align:center;font-size:12px;}#ads span{color:#080;}.search-box{display:-webkit-flex;display:flex;position:relative;padding:2px;height:44px;line-height:44px;text-align:center;background-color:#0a0;color:#fff;font-size:14px;}.search-input{-webkit-flex:1;flex:1;width:100%;padding:0 10px;box-sizing:border-box;background-color:#fff;color:#0a1a2a;outline:none;border:none;border-radius:3px;text-align:center;}.search-btn{padding:0 10px;border:none;}.search-btn:active{background-color:#4CAF50;}#tab-box{display:-webkit-flex;display:flex;position:relative;width:100%;background-color:#f9f9f9;color:#666;}.tab-item{-webkit-flex:1;flex:1;text-align:center;height:40px;line-height:40px;font-size:14px;}.tab-item-selected{color:green;border-bottom:2px green solid;}.search-history,.tuijian,.box-subtitle{display:flex;display:-webkit-flex;flex-wrap:wrap;-webkit-flex-wrap:wrap;}.search-history a,.tuijian a,.box-subtitle a{display:block;flex:1 0 auto;-webkit-flex:1 0 auto;}.search-history div,.tuijian div,.box-subtitle div{width:25%;flex:1 0 auto;-webkit-flex:1 0 auto;overflow:hidden;}.search-history p,.tuijian p{display:block;width:100%;color:#999;}.tuijian,.search-history{padding:10px 0;text-align:center;font-size:14px;color:#000;}.search-history a,.tuijian a{color:#000;border:1px solid #eee;margin:5px 3px;padding:5px 10px;border-radius:10px;}.search-history,.tuijian,.searchList{padding-bottom:40px;}#words{position:absolute;top:0;left:0;padding:5px 0;text-align:center;background:rgba(0,0,0,0.5);z-index:999999999;}#words a{display:inline-block;color:#000;background-color:#fff;margin:3px;padding:5px 10px;border-radius:10px;}.fuli{padding:10px;font-size:14px;color:#777;}.main-box{display:flex;flex-direction:column;overflow:hidden;margin:10px 0;padding:10px 0;border:none;background-color:#eee;}.content-box{display:flex;align-items:center;}.img-box{position:relative;width:90px;height:120px;}.update-info{box-sizing:border-box;width:100%;padding:3px;display:block;text-align:center;font-size:12px;color:#fff;background:rgba(0,0,0,0.3);position:absolute;bottom:0;right:0;}.update-schedule{padding:3px;display:none;font-size:12px;color:#fff;background:rgba(0,0,0,0.4);position:absolute;top:0;left:0;}.title-box{flex:1;padding:0 5px;font-size:14px;}.atitle{display:block;color:green;font-size:16px;}.ainfos{display:block;color:gray;padding:5px 0;}.site{display:inline-block;color:gray;}.site select{border: 1px solid gray;color:gray;height:30px;font-size:14px;}.xuanji-btn{display:inline-block;padding:8px 15px;margin:5px 10px;border:1px solid gray;color:gray;border-radius:15px;}.playrecord{display:inline-block;font-size:14px;color:#f00;margin:5px 0;}.urls-box{display:none;padding-top:10px;}.urls-btn{float:left;width:70px;padding:15px 0;border:1px solid #eee;text-decoration:none;color:#333;background-color:#ddd;text-align:center;font-size:12px;}.cover-layer{display:block;color:#fff;background:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;}.duration{position:absolute;bottom:0;right:0;padding:3px;display:block;font-size:12px;color:#fff;background:rgba(0,0,0,0.3);}#loadmore{font-size:14px;height:35px;line-height:35px;text-align:center;color:#0a1a2a;margin-top:5px;}.footer{font-size:12px;line-height:20px;color:gray;clear:left;margin-bottom:35px;}.footer span{color:#080;}.top{display:none;position:fixed;right:1px;bottom:1px;width:50px;height:35px;line-height: 35px;text-align:center;color:#fff;background-color:green;opacity:0.9;border:0;font-size:12px;z-index:99;}</style></head><body></body></html>######.api.js======var kid=0,scrolltop=0,curInfos={},curApikey=0,zyapi={urls:"5b22687474703a2f2f636a2e62616a69656361696a692e636f6d2f696e632f66656966656933626a6d3375382f696e6465782e706870222c2268747470733a2f2f73647a796170692e636f6d2f6170692e7068702f70726f766964652f766f642f66726f6d2f73646d3375382f61742f786d6c2f222c2268747470733a2f2f6170692e61706962647a792e636f6d2f6170692e7068702f70726f766964652f766f642f61742f786d6c2f222c226170694d616e61676572225d",name:["BJ资源","SD资源","BD资源","-- 资源API地址管理 --"]},apiSelected;apiready=function(){html();clickListener();$('#tab-box .tab-item').get(2).click();var str=localStorage.getItem('api_search');if(str){$('#s_word').val(JSON.parse(str)[0]);}(function(){var jsonFN=window.jsonData;window.jsonData=function(ret){jsonFN(ret);imageCache($('#ss'));};var xmlFN=window.xmlData;window.xmlData=function(ret){xmlFN(ret);imageCache($('#ss'));};})();api.addEventListener({name:api.frameName},function(ret,err){var v=ret.value;window[v.fn](v.data);});initApi();};function imageCache(el){var imgs=el.find('img[data-src]');if(imgs.length>0){for(var i=0,m;m=imgs[i];i++){apiImageCache(m);}}}function apiImageCache(el){var url=el.getAttribute("data-src");api.imageCache({url:url,thumbnail:true,policy:'cache_only'},function(ret,err){el.src=ret.url;el.removeAttribute("data-src");});}function doubanRequest(){var El=$('.tuijian');if(El.attr("data-loaded")==1){return;}El.html('<p>数据载入中…</p>');if(api.getGlobalData({key:'TcMovie'})){TcMovie(El,1);return;}var url='https://m.douban.com/rexxar/api/v2/movie/modules?need_manual_chart_card=1&for_mobile=1';var ref=url.match(/^.{10}[^\/]+\//)[0];api.ajax({url:url,method:'get',tag:'TcMovie',timeout:15,dataType:'json',headers:{Referer:ref}},function(ret,err){if(ret){El.attr("data-loaded",1);TcMovie(El,ret);}else{El.html('<p style="color:#e00;" onclick="doubanRequest();">点击重新获取</p>');}});}function html(){var htmlStr='<div id="ptitle" style="display:none;"><div class="top-box"><a class="to-xuanji">选集</a><span class="title"></span><a id="download" data-url="">下载/播放</a></div></div><div id="ads">关注微信公众号<span>kongbuyy</span>不迷路</div><div class="search-box"><div id="tp" class="search-line"></div><input id="s_word" class="search-input" placeholder="输入关键词搜索" onkeydown="FSubmit(event.keyCode||event.which);"/><div onclick="tp()" class="search-btn">搜索</div></div><input id="pd" style="display:none;" value=""/><input id="purl" style="display:none;" value=""/><div id="tab-box" style="position:relative;"><div class="tab-item" data-show=".searchList" data-hide=".search-history,.tuijian">搜索结果</div><div class="tab-item" data-show=".search-history" data-hide=".searchList,.tuijian">搜索记录</div><div class="tab-item" data-show=".tuijian" data-hide=".searchList,.search-history">热播电影</div></div><div class="searchList"><div id="fenlei" style="overflow:hidden;padding:5px;font-size:12px;"></div><div id="ss" style="clear:left;"></div></div><div class="search-history"></div><div class="tuijian"></div>';$('body').append(htmlStr);if(typeof zyapi.urls =="string"){zyapi.urls=JSON.parse(stringDecode(zyapi.urls));}apiSelected=zyapi.urls[0];}function isToday(str){var d = new Date(str.replace(/-/g,"/"));var t = new Date();return d.setHours(0,0,0,0) == t.setHours(0,0,0,0);}function isBottom(){if($(this).scrollTop()+$(this).height()==$(document).height()){return true;}return false;}function api_gl_show(){api.openWin({name:'jkgl',url:'.subwin.html',pageParam:{title:'自定义接口管理',name:'jkgl_frame',url:'.jkgl.html',page:api.frameName}});}function s_reset(){$("#pifr").remove();$("#ptitle").hide();api.cancelAjax({tag:'search'});}function FSubmit(e){if(e==13){document.getElementById('s_word').blur();tp();}}function setCurrentLine(curApi){$('#tp').attr("data-line",curApi).text(zyapi.name[zyapi.urls.indexOf(curApi)]);}function searchByWord(w){$('#s_word').val(w);$('#tp').val(apiSelected);tp();return flase;}function tp(){var api=$('#tp').attr("data-line");apiSelected=api;curApikey=apiDecode(api).replace(/\W*/g,'');$('#pd').val(0);$("#fenlei a").css({"background-color":"#ddd","color":"#333"}).first().css({"background-color":"#000","color":"#eee"});tabBoxSelected();setSearchHistory($('#s_word').val());search(1);}function search(p){var word=$('#s_word').val(),type=apiDecode($('#tp').attr("data-line")),pd=$('#pd').val();s_reset();if(p==1&&/^(?:福利|黄色|成人|伦理)$/.test(word)){$('#ss').html('<p class="tips" style="text-align:left;color:#777;padding:0 10px;">关注微信公众号，回复“'+word+'”获取福利API地址，在“影视API”中添加即可观看。</p>');return;}api.showProgress({title: '搜索中...',text:'',modal: false});$('#ss').html('<p class="tips">数据加载中…</p>');var url=type+'?ac=list&ids=&wd='+word+'&t='+pd+'&h=&pg='+p+'&cid='+pd+'&p='+p;api.ajax({url:url,method:'get',dataType:'text',tag:'search',timeout:10},function(ret,err){if(err){api.hideProgress();$('#ss').html('<p class="tips" style="color:#f00;" onclick="search('+p+')">请求失败，点击重试</p>');return;}if(ret.indexOf('{"')==0){api.hideProgress();ret=JSON.parse(ret);if(ret.page.recordcount==0){splitWords(ret.list,word);return;}var bodyTop=document.body.scrollTop;jsonData(ret);document.body.scrollTop=bodyTop;}else{if(ret.indexOf('<video>')==-1){api.hideProgress();splitWords(ret,word);return;}getIdsAndXmlData(ret);}});}function splitWords(data,word){api.toast({msg:"暂无相关视频"});var noVideoTips='<p style="text-align:center;clear:left;padding:5px 0;">暂无<span style="color:#f00;">'+word+'</span>相关视频</p>';var str=[];word.replace(/[\u4E00-\u9FFF\d\w]+/g,function(m){str.push('<a href="javascript:;" onclick="searchByWord(\''+m+'\');" style="padding:5px;margin:5px;">'+m+'</a>');});noVideoTips+=str.length>1?'<p style="text-align:center;padding:5px 0;font-size:16px;color:#777;">试试搜索：'+str.join('')+'</p>':'';$('#ss').html(noVideoTips);$('#fenlei').html()==''&&getType(data);}function getBasicWidth(str){str=str+'';var len=str.length;var slen=str.replace(/[\s\d\w]+/g,'').length;len=slen+parseInt((len-slen)/2);var w=api.winWidth,cw=len<3?68:(len+1)*12+20;cw=w/parseInt(w/cw)-2;return cw;}function jsonData(ret){var key=$('#tp').text(),xuanji='<span class="m3u8-type">选集</span>';var ss=[],ar=ret.data,pstr=localStorage.getItem('api_play')||'[]';var cw=46;for(var i=0,m;m=ar[i];i++){var urls=m.vod_url.replace(/第(\d+)集/g,'$1'),curkey=curApikey+m.vod_id;if(urls.indexOf('$$$')!==-1){var ar1=urls.split('$$$');if(urls.indexOf('.m3u8')!==-1){for(var j=0,n;n=ar1[j];j++){if(n.indexOf('.m3u8')!==-1){urls=n;break;}}}else{urls=ar1[0];}}var ar1=urls.split('\r\n');for(var e='',k=0,v;v=ar1[k];k++){var ar2=v.split('$');if(k==0){cw=getBasicWidth(ar2[0]);}e+='<a data-url="'+ar2[1]+'" style="width:'+cw+'px;">'+ar2[0]+'</a> ';}var playName='';if(pstr.indexOf(curkey)!=-1){var re =new RegExp(curkey+'":"([^"]*)"');var url=pstr.match(re)[1];e=e.replace(new RegExp('(data-url="'+url+'"\\s+style="[^"]+)'),'$1color:#f00;');playName=e.match(new RegExp('data-url="'+url+'"[^>]+>(.*?)<'))[1]||"";}ss.push('<div class="main-box" data-id="'+m.vod_id+'"><div class="content-box"><div class="img-box">'+imgHtml(m.vod_pic)+'<span>'+m.vod_continu+'</span></div><div class="title-box"><span class="atitle">'+m.vod_name+'</span><date>'+(m.vod_year*1||'')+'</date><channel>'+m.list_name+'</channel><actor>'+m.vod_actor+'</actor><div class="xuanji" style="color:#f00;">'+xuanji+playName+'</div></div></div><div class="urls-box"><div class="m3u8-data" style="display:none;">'+e+'</div><div class="mp4-data" style="display:none;"></div></div></div>');}var pg=ret.page;$('#ss').html(ss.join('')+pageHtml(pg.pageindex*1,pg.pagecount*1));$('#fenlei').html()==''&&getType(ret.list);}function noImg(el){el.οnerror=null;el.src=el.src.replace(/^https?:/,function(a){return a=='http:'&&'https:'||'http:';});}/*jsonData end*/function getIdsAndXmlData(data){var ids=data.match(/\d+(?=<\/id>)/g).join(',');var url=apiDecode($('#tp').attr("data-line"))+'?ac=videolist&ids='+ids+'&wd=&t=&h=&pg=1&cid=&p=1';api.ajax({url:url,method:'get',dataType:'text',tag:'search',timeout:10},function(ret,err){var bodyTop=document.body.scrollTop;api.hideProgress();if(ret.indexOf('<video>')==-1){xmlData(data);}else{$('#fenlei').html()==''&&getType(data);xmlData(ret);var pg=data.match(/page="(\d+)" pagecount="(\d+)"/);$('#ss').append(pageHtml(pg[1]*1,pg[2]*1));}document.body.scrollTop=bodyTop;});}function xmlData(ret){var ss=[];if(/<dd flag="[^"]*">/.test(ret)){ret.replace(/<video><last>([\s\S]*?)<\/last><id>([\s\S]*?)<\/id><tid>([\s\S]*?)<\/tid><name><\!\[CDATA\[([\s\S]*?)\]\]><\/name><type>([\s\S]*?)<\/type><pic>([\s\S]*?)<\/pic>[\s\S]*?<area>([\s\S]*?)<\/area><year>([\s\S]*?)<\/year>[\s\S]*?<note><\!\[CDATA\[([\s\S]*?)\]\]><\/note><actor><\!\[CDATA\[([\s\S]*?)\]\]><\/actor>[\s\S]*?<dl>([\s\S]*?)<\/dl>[\s\S]*?<\/video>/g,function(){ss.push(xmlHtmlWithPic(arguments));});}else{ret.replace(/<video><last>(.*?)<\/last><id>(.*?)<\/id><tid>(.*?)<\/tid><name><\!\[CDATA\[([\s\S]*?)\]\]><\/name><type>(.*?)<\/type><dt>(.*?)<\/dt><note><\!\[CDATA\[([\s\S]*?)\]\]><\/note>[\s\S]*?<\/video>/g,function(){ss.push(xmlHtml(arguments));});}var pg=ret.match(/page="(\d+)" pagecount="(\d+)"/);$('#ss').html(ss.join('')+pageHtml(pg[1]*1,pg[2]*1));$('#fenlei').html()==''&&getType(ret);}function xmlHtml(ar){return '<div class="main-box" data-id="'+ar[2]+'" data-time="'+ar[1]+'"><div class="title-box" style="-webkit-flex:none;flex:none;color:gray;font-size:12px;"><span class="atitle">'+ar[4]+'</span>'+(ar[5]&&'<span style="padding:0 3px;">'+ar[5]+'</span>'||'')+(ar[7]&&'<span style="padding:0 3px;">'+ar[7]+'</span>'||'')+(ar[1]&&'<span style="padding:0 3px;color:'+(isToday(ar[1])&&'red'||'gray')+';">'+ar[1].replace(/\d+[/-](\d+)[/-](\d+).*/,'$1.$2')+'</span>'||'')+'</div><div class="urls-box"></div></div>';}function xmlHtmlWithPic(ar){var urls=ar[11].match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?\.m3u8[^\]]*?)\]\]><\/dd>/)||ar[11].match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?)\]\]><\/dd>/);if(!urls){return;}var s=urlHtml(urls[1]),curkey=curApikey+ar[2],pstr=localStorage.getItem('api_play')||'[]',playName='';if(pstr.indexOf(curkey)!=-1){var re =new RegExp(curkey+'":"([^"]*)"');var url=pstr.match(re)[1];s=s.replace(new RegExp('(data-url="'+url+'"\\s+style=")([^"]+)'),'$1$2color:#f00;');playName=s.match(new RegExp('data-url="'+url+'"[^>]+>(.*?)<'))[1]||"";}return '<div class="main-box" data-id="'+ar[2]+'"><div class="content-box"><div class="img-box">'+imgHtml(ar[6])+'<span>'+ar[9]+'</span></div><div class="title-box"><span class="atitle">'+ar[4]+'</span><date>'+(ar[8]!=0&&ar[8].substr(0,4)||'')+'</date><channel>'+ar[5]+'</channel><actor>'+ar[10]+'</actor><div class="xuanji" style="color:#f00;"><span class="m3u8-type">选集</span>'+playName+'</div></div></div><div class="urls-box"><div class="m3u8-data" style="display:none;">'+s+'</div><div class="mp4-data" style="display:none;"></div></div></div>';}/*xmlData end*/function imgHtml(url){return '<img onerror="noImg(this);" data-src="'+url+'" />';}function getType(ret){if(typeof(ret)=='string'){var type=ret.match(/<class>([\s\S]*?)<\/class>/);if(type==null){var apiUrl=apiDecode($('#tp').attr("data-line")),url=apiUrl+'?ac=list&ids=&wd=888888&t=&h=&pg=1';api.ajax({url:url,method:'get',dataType:'text',timeout:10},function(ret,err){if(!ret||err){api.toast({msg:'未能获取分类，请重试'});return;}getType(ret);});return;}var e=type[1].replace(/<ty id="\d*">(电影|电视剧|剧集|连续剧|小说|图片)<\/ty>/g,'');e=('<ty id="0">全部</ty>'+e).replace(/<ty id="(\d*)">(.*?)<\/ty>/g,'<a tid="$1">$2</a>');}else{var e='';ret.unshift({list_id:0,list_name:'全部'});for(var i=0,m;m=ret[i];i++){if(/电影|电视剧|剧集|连续剧|小说|图片/.test(m.list_name)){continue;}e+='<a tid="'+m.list_id+'">'+m.list_name+'</a>';}}e+='<div></div><div></div><div></div>';$('#fenlei').html(e);$('#fenlei a').first().css({"background-color":"#000","color":"#eee"});}function tabBoxSelected(){$('#tab-box .tab-item-selected').removeClass('tab-item-selected');$('#tab-box .tab-item[data-show=".searchList"]').addClass('tab-item-selected');$('.search-history,.tuijian').hide();$('.searchList').fadeIn(200);}function setSearchHistory(word){if(!word){return;}var ar=[],str=localStorage.getItem('api_search');if(str){ar=JSON.parse(str);}var i=ar.indexOf(word);if(i!=-1){ar.splice(i,1);}ar.unshift(word);(ar.length>30)&&(ar.length=30);localStorage.setItem('api_search',JSON.stringify(ar));}function sRecord(){var ar=[],keywords=[],str=localStorage.getItem('api_search');if(str){ar=JSON.parse(str);for(var i=0,m;m=ar[i];i++){keywords.push('<a>'+m+'</a>');}keywords.push('<div></div><div></div><p onclick="clearSearchHistory();">清空记录</p>');}else{keywords.push('<p>暂无记录</p>');}$(".search-history").html(keywords.join(''));}function clearSearchHistory(){api.confirm({msg:'清空搜索记录？',buttons:['取消','确定']},function(ret,err){var i=ret.buttonIndex;if(i==2){localStorage.removeItem('api_search');sRecord();}});}function clickListener(){$('#tab-box .tab-item').on("click",function(){var el=$(this);var showEl=el.attr("data-show"),hideEl=el.attr("data-hide");$(hideEl).hide();$(showEl).fadeIn(200);$('#tab-box .tab-item-selected').removeClass('tab-item-selected');el.addClass('tab-item-selected');if(showEl=='.searchList'){if($(showEl).find('.main-box').length>0){return;}tp();}else if(showEl=='.search-history'){sRecord();}else{doubanRequest();}return false;});$(".search-history,.tuijian").on("click","a",function(){$('#s_word').val($(this).text());tp();return false;});$("#fenlei").on("click","a",function(){$("#fenlei a").css({"background-color":"#ddd","color":"#333"});$(this).css({"background-color":"#000","color":"#eee"});pd_($(this).attr("tid"));});$("#ss").on("click",".m3u8-type",function(){var mainEl=$(this).closest(".main-box");mainEl.find('.m3u8-data').slideToggle(500);return false;});$("#ss").on("click",".m3u8-data a,.data a",function(){var mainEl=$(this).closest(".main-box");kid=curApikey+mainEl.attr("data-id");$("#ss a[name=playing]").css({"background-color":"#ddd","color":"#333"}).removeAttr("name");$(this).css({"background-color":"#000","color":"#eee"}).attr("name","playing");var url=$(this).attr("data-url"),name=mainEl.find('.atitle').text(),title=name+' <span style="color:#f00;">'+$(this).text()+'</span>';$('#purl').val(url);$("#ptitle").show();$("#download").attr("data-url",url);curInfos={title:name+" "+$(this).text()};$("#ptitle .title").html(title);if(/\d+/.test($(this).text())&&$(this).parent().find('a').length>1){local_(url);}play();return false;});$("#ss").on("click",".main-box",function(){var thisEl=$(this);if(thisEl.find('.xuanji').length>0){return false;}var id=thisEl.attr("data-id"),time=thisEl.attr("data-time");thisEl.find('.atitle').css({"color":"#f00"});if(thisEl.find('.m3u8-data').length==0){s_reset();api.showProgress({title:'数据载入中...',text:'',modal: false});var apiUrl=apiDecode($('#tp').attr("data-line")),url=apiUrl+'?ac=videolist&ids='+id+'&wd=&t=&h=&pg=1';api.ajax({url:url,method:'get',dataType:'text',timeout:10},function(ret,err){api.hideProgress();if(err){api.toast({msg:err.msg});return;}var urls=ret.match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?\.m3u8[^\]]*?)\]\]><\/dd>/)||ret.match(/<dd flag="[^"]*"><\!\[CDATA\[([^\]]*?)\]\]><\/dd>/);if(!urls){api.toast({msg:'暂无数据'});return;}var data=ret.match(/<tid>([\s\S]*?)<\/tid><name><\!\[CDATA\[([\s\S]*?)\]\]><\/name><type>([\s\S]*?)<\/type><pic>([\s\S]*?)<\/pic>[\s\S]*?<area>([\s\S]*?)<\/area><year>([\s\S]*?)<\/year>[\s\S]*?<actor><\!\[CDATA\[([\s\S]*?)\]\]><\/actor>/);if(thisEl.find('.m3u8-data').length==0){kid=curApikey+id;var s=urlHtml(urls[1]),pstr=localStorage.getItem('api_play')||'[]';if(pstr.indexOf(kid)!=-1){var re =new RegExp(kid+'":"([^"]*)"');var url=pstr.match(re)[1];s=s.replace(new RegExp('(data-url="'+url+'"\\s+style="[^"]+)'),'$1color:#f00;');}thisEl.find('.urls-box').append('<div class="m3u8-data" data-title="'+data[2]+'" data-pic="'+data[4]+'" data-year="'+data[6]+'" data-actors="'+data[7]+'" data-area="'+data[5]+'">'+s+'</div>');}});}else{thisEl.find('.urls-box').slideToggle();}return false;});$('#tp').on("click",function(){var el=$(this),i=zyapi.urls.indexOf(el.attr("data-line")),names=zyapi.name.slice();names.splice(i,1,'*  '+zyapi.name[i]);api.actionSheet({title:'资源API地址',cancelTitle: '取消',buttons:names},function(ret,err){var index=ret.buttonIndex-1;if(index<zyapi.name.length){var url=zyapi.urls[index];if(url==el.attr("data-line")){return;}if(url=='apiManager'){api_gl_show();return;}el.text(zyapi.name[index]).attr("data-line",zyapi.urls[index]);$('#fenlei').empty();tp();}});return false;});$('#movie').on("click","a",function(){$('#s_word').val($(this).text());$('#tp').val(apiSelected);tp();return false;});$('#download').on("click",function(){var url=$(this).attr("data-url");api.sendEvent({name:"root",extra:{fn:"downloadActionSheet",data:{url:url,title:curInfos.title,type:url.indexOf('.m3u8')!==-1?'m3u8':'mp4'}}});return false;});$("#ptitle").on("click",".to-xuanji",function(){$('#ss a[name=playing]').parent().show();var el=document.getElementsByName('playing')[0];el.scrollIntoView();window.scrollBy(0,el.getBoundingClientRect().top-api.winHeight/2);});}function pageHtml(p,total){if(total==1){return '';}for(var j=1,e=[],k=total+1;j<k;j++){e.push('<option value="'+j+'">第 '+j+' 页</option>');}return '<div id="pg" style="-webkit-display:flex;-webkit-justify-content:center;-webkit-align-items:center;display:flex;justify-content:center;align-items:center;height:40px;"><span'+(p==1?'':' onclick="search('+(p-1)+')"')+' style="background-color:gray;color:'+(p==1?'#999':'#fff')+';width:50px;height:40px;line-height:40px;text-align:center;margin:2px;display:inline-block;">上一页</span><select style="width:auto;height:40px;font-size:12px;color:#000;border:1px solid gray;" onchange="search(this.value)">'+e.join('').replace('value="'+p+'"','value="'+p+'" selected')+'</select><span'+(p<total?' onclick="search('+(p+1)+')"':'')+' style="background-color:gray;color:'+(p<total?'#fff':'#999')+';width:50px;height:40px;line-height:40px;text-align:center;margin:2px;display:inline-block;">下一页</span></div>';}function urlHtml(urls){var cw=46,urlHtml=[];urls=urls.replace(/第(\d+)集/g,'$1');if(urls.indexOf('#')!==-1){var ar=urls.split('#');for(var i=0,m;m=ar[i];i++){var arr=[];if(m.indexOf('$')!==-1){arr=m.split('$');(m.indexOf('http')==0)&&(arr=[i+1,arr[0]]);}else{arr=[i+1,m];}if(i==0){cw=getBasicWidth(arr[0]);}urlHtml.push('<a data-url="'+arr[1]+'" style="width:'+cw+'px;">'+arr[0]+'</a>');}}else{var arr=[];if(urls.indexOf('$')!==-1){arr=urls.split('$');(urls.indexOf('http')==0)&&(arr=['高清',arr[0]]);}else{arr=['高清',urls];}cw=getBasicWidth(arr[0]);urlHtml.push('<a data-url="'+arr[1]+'" style="width:'+cw+'px;">'+arr[0]+'</a>');}return urlHtml.join('');}function pd_(ty){$('#pd').val(ty);$('#s_word').val('');search(1);}function TcMovie(El,json){if(json==1){var str=api.getGlobalData({key:'TcMovie'});sessionStorage.getItem('TcMovie');}else{var str=JSON.stringify(json.modules[2]);str=(str.match(/"title"\s?:\s?"[^"]+/g)||[]).join('').replace(/"title"\s?:\s?"([^"]+)/g,'<a href="javascript:;">$1</a>');api.setGlobalData({key:'TcMovie',value:str});}El.html(str+'<div></div><div></div>');}/*****play****/function downloadShow(url){$("#download").attr("data-url",url).show();}function play(){$("#download").hide();api.showProgress({title: '解析中...',text:'',modal: false});var url=$("#purl").val();if(/^https?:.*(?:\/share\/)/.test(url)){openUrl(url,1);return;}if(/^https?:/.test(url)==false){getPlayer(url);return;}/\.m3u8(?:$|\?|&)/.test(url)?apiAjax(url,""):url2play(url);}function getPlayer(vid){var i=zyapi.urls.indexOf($('#tp').attr("data-line")),name=zyapi.name[i].match(/\w+/)[0];var player=JSON.parse(localStorage.getItem("apiPlayer")||'{}');if(player[name]){openUrl(player[name]+vid,1);return;}api.prompt({title:'已加密，请添加该资源专属播放器',msg:'形如：https://xxx/?url=',buttons:['取消','添加']},function(ret,err){var index=ret.buttonIndex,text=ret.text.replace(/^\s+|\s+$/g,'');if(index==1||/^https?:/.test(text)==false){jxError();}else{player[name]=text;localStorage.setItem("apiPlayer",JSON.stringify(player));openUrl(text+vid,1);}});}function img_(url,w,h1){var imgid=Math.random(),frameid ='frameimg' + imgid;window['img'+imgid] = '<iframe src=\''+url+'\' style="display:none;width:100%;height:100%;" onload="document.getElementsByTagName(\'img\')[0].src=\''+url+'\';"></iframe><img src="" style="width:100%;height:100%;" onload="document.getElementsByTagName(\'iframe\')[0].src=\''+url+'\';">';return '<iframe id="'+frameid+'" src="javascript:parent[\'img'+imgid+'\'];" frameborder="0" scrolling="no" border="0" marginwidth="0" marginheight="0" style="width:'+w+';height:'+h1+';margin-bottom:-5px;"></iframe>';}function local_(vp){var json={},str=localStorage.getItem('api_play');json[kid]=vp;var arr=JSON.parse(str||'[]');var i=arr.indexOf(json);i!=-1&&arr.splice(i,1);arr.unshift(json);arr.length>20&&(arr.length=20);localStorage.setItem('api_play',JSON.stringify(arr));}/** API **/function getHostNameByUrl(url){return url.split('\/')[2].split('.').slice(-2)[0];}function getApiInfo(sql){var db = api.require('db');var ret = db.selectSqlSync({ name: 'downloader', sql: sql});return ret.data;}function stringDecode(str){return str.replace(/.{2}/g,function(a){return String.fromCharCode(parseInt(a,16));});}function apiDecode(str){if(/^http/.test(str)==false){str=stringDecode(str);}str=str.replace(/\?.*$/,'').replace(/(provide\/vod).*$/i,'$1/at/xml/');return str;}function addUrl(v){var urlStr=v.url,name=v.name;apiSelected=urlStr;$('#tp').attr("data-line",urlStr).text('资源:'+name);var i=zyapi.urls.indexOf(urlStr);if(i!=-1){zyapi.urls.splice(i,1);zyapi.name.splice(i,1);}zyapi.urls.push(urlStr);zyapi.name.push('资源:'+name);$('#ss').empty();$('#fenlei').empty();}function deleteUrl(v){var url=v.url;if(url==$('#tp').attr("data-line")){apiSelected=zyapi.urls[0];$('#tp').attr("data-line",zyapi.urls[0]).text(zyapi.name[0]);$('#ss').empty();$('#fenlei').empty();}var i=zyapi.urls.indexOf(url);zyapi.urls.splice(i,1);zyapi.name.splice(i,1);}function initApi(){var data=getApiInfo('SELECT * FROM apiInfo');if(data.length>0){for(var i=0,m;m=data[i];i++){zyapi.urls.push(m.url);zyapi.name.push('资源:'+m.name);}}$('#tp').attr("data-line",apiSelected).text(zyapi.name[zyapi.urls.indexOf(apiSelected)]);}######.index.html======<!DOCTYPE html> <html> <head> <meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>首页</title><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"> <style type="text/css">body{padding:0;margin:0;background-color:#fff;}#header{position:relative;}#nav{display:-webkit-flex;display:flex;position:fixed;left:0;bottom:0;width:100%;overflow:hidden;border:none;background-color:#f3f3f3;z-index:9999;}.menu{font-size:16px;-webkit-flex:1;flex:1;text-align:center;color:#666;height:48px;line-height:48px;}.selected{color:white;background-color:#4CAF50;}</style><script src="file:///android_asset/widget/script/jquery.min.js"></script></head><body><div id="header"></div><div id="nav"><div class="menu" tapmode onclick="navClick(1);">VIP解析</div><div class="menu" tapmode onclick="navClick(2);">影视API</div><div class="menu" tapmode onclick="navClick(3);">高品音乐</div><div class="menu" tapmode onclick="navClick(4);">下载管理</div></div><script>var currentFrame=0,findUrlReady=true,exitTimer=false,webBrowserTimer=0,LMY="687474703a2f2f746f6f6c732e6c69756d696e6779652e636e2f6d757369632f",updateInfo={version:"1.0.16",url:"https://wwn.lanzouq.com/tp/iqD1X05744of",msg:'修复一些问题'};var playerJs='if(typeof xxtest == "undefined"){var xxtest=1,videoInfo={},runLeft=0,jxCount=0,endTimes=150;var vEnd=function(){window.stop();runLeft=0;};var videoTest=function(){videoInfo.requestM3u8=0;if(videoInfo.hasOwnProperty("url")==false){return;}var url=videoInfo.url;if(url.indexOf("//")==0){videoInfo.url=url=window.location.protocol+url;}videoInfo.requestM3u8=/\\.m3u8(?:$|\\?|\\&)/.test(url)?1:2;};var getRealUrl=function(url){if(!url||/^https?/.test(url)==false){return;}if(videoInfo.hasOwnProperty("url")==false){videoInfo.url=url;}vEnd();};var openFrameUrl=function(url){var a=document.createElement("a");a.href=url;a.target="_self";document.getElementsByTagName("body")[0].appendChild(a);a.click();};var isHidden=function(el){var endStyle=window.getComputedStyle(el,null);var endWidth=(endStyle.width.match(/\\d+/)||[0])[0],endHeight=(endStyle.height.match(/\\d+/)||[0])[0];return endStyle.display=="none"||endWidth<200||endHeight<200;};var getVideoUrl=function(){try{var els=document.getElementsByTagName("video");if(els.length<1){return;}var el=els[0];if(isHidden(el)){return;}var vurl=el.src;if(!vurl){var sel=document.getElementsByTagName("source");if(sel.length<1){return;}vurl=sel[0].src;}getRealUrl(vurl);el.muted=true;el.setAttribute("preload","none");el.removeAttribute("autoplay");}catch(e){videoCatch();}};var videoCatch=function(){try{var vurl=document.body.innerHTML.match(/<video.*?src="([^"]+)"/)[1];getRealUrl(vurl);}catch(e){}};var getIframeUrl=function(){try{if(videoInfo.url){return;}var ifrEl=document.querySelector("iframe[allowfullscreen]");if(!ifrEl){ifrEl=document.querySelector("iframe");}if(isHidden(ifrEl)){return;}var furl=ifrEl.src;if(furl){ifrEl.parentNode.removeChild(ifrEl);openFrameUrl(furl);}}catch(e){}};var intervalTimer=setInterval(function(){if(jxCount<endTimes){jxCount++;}else{vEnd();jxReady&&jxReady();clearInterval(intervalTimer);return;}getVideoUrl();getIframeUrl();detectUrl&&detectUrl();},200);(function(w){w.confirm=w.alert=w.open=function(){return;};try{var nURL=w.URL.createObjectURL;w.URL.createObjectURL=function(a){var o=nURL(a);return o;};}catch(e){}var timeoutFN=w.setTimeout;w.setTimeout=function(a,b){runLeft++;return timeoutFN(function(){runLeft--;a();},b);};var intervalFN=w.setInterval;w.setInterval=function(a,b){return intervalFN(a,b<1000?b:200);};try{var mediaSource=w.MediaSource;w.MediaSource=function(){var m=new mediaSource();m.constructor=MediaSource;return m;};}catch(e){}var oXHR=w.XMLHttpRequest;w.XMLHttpRequest=function XMLHttpRequest(){var xhr=new oXHR();xhr.constructor=XMLHttpRequest;xhr._open=xhr.open;xhr.open=function(method,url,async,user,password){runLeft++;xhr.timeout=5000;if(/\\.m3u8($|\\&|\\?)/.test(url)){videoInfo.url=url;url=url+(/\\?/.test(url)?"&t=":"?t=")+new Date().getTime();vEnd();try{document.querySelector("video").muted=true;}catch(e){}}xhr._open(method,url,async,user,password);};xhr.addEventListener("loadend",function(){runLeft--;});return xhr;};})(window);}';var videoTestJs='if(typeof videoInfo == "undefined"){jxError();}else{jxCount=0;endTimes=25;videoInfo.referer=location.href;detectUrl();}function detectUrl(){if(videoInfo.text||videoInfo.url||runLeft<=0&&jxCount>10){jxReady();}}function jxError(){api.sendEvent({name:"webBrowserFinish"+(frameName||""),extra:{}});}function jxReady(){clearInterval(intervalTimer);if(videoInfo.finish){return;}videoInfo.finish=true;if(videoInfo.hasOwnProperty("requestM3u8")==false){videoTest();}api.sendEvent({name:"webBrowserFinish"+(frameName||""),extra:videoInfo});}';var functionJs='var jxTimer=0;api.sendEvent({name:"root",extra:{fn:"save2txtpad",data:{path:"detail",data:api.frameName}}});api.addEventListener({name:"keybackPress"},function(ret,err){jxReset();});api.addEventListener({name:"webBrowserError"},function(ret,err){jxError();});api.addEventListener({name:"leduovip"},function(ret,err){closePlayer();var vid=ret.value.url.match(/[&\\?](vid|url)=([^&]*)/);if(vid&&vid[2]){vid[1]=="vid"?getPlayUrl(vid[2]):isM3u8(decodeURIComponent(vid[2]));}else{jxError();}});api.addEventListener({name:"webBrowserFinish"+api.frameName},function(ret,err){closePlayer();var opt=ret.value;if(opt.url){var purl=opt.url;if(/(?:ssoffo|cehbe).com/.test(purl)){jxError();return;}if(/(.(?!w{3})).{3}\\.ixigua\\.com/.test(purl)){url2play(purl);return;}var curTimer=jxTimer=setTimeout(apiAjaxHead,3000,purl,opt.referer);api.accessNative({name:"getRealUrl",extra:{url:purl,times:3}},function(ret,err){if(curTimer!=jxTimer){return;}clearTimeout(jxTimer);var headers=ret.headers||"";var contentLength=headers.match(/Content-Length=\\[(\\d+)/),contentType=headers.match(/Content-Type=\\[([^\\]]+)/);if(contentType&&/mpegurl|text|fuck|image.vnd.microsoft.icon/i.test(contentType[1])||contentLength&&contentLength[1]<1024000){apiAjax(ret.url,opt.referer);}else if(contentType&&/mp4/i.test(contentType[1])){url2play(ret.url||purl);}else{apiAjaxHead(ret.url||purl,opt.referer);}});}else{jxError();}});function apiAjaxHead(url,referer){api.ajax({url:url,method:"head",dataType:"json",tag:"jxRequest",timeout:3,headers:{Referer:referer}},function(ret,err){if(err){jxError();return;}if(ret["Content-Type"]&&/mpegurl|text|fuck|image.vnd.microsoft.icon/i.test(ret["Content-Type"])||ret["Content-Length"]&&ret["Content-Length"]<1024000){apiAjax(url,referer);}else{url2play(url);}});}function openUrl(url,referer){api.sendEvent({name:"root",extra:{fn:"openWebBrowser",data:{url:url,referer:referer,frameName:api.frameName}}});}function apiAjax(url,referer){api.ajax({url:url,method:"get",dataType:"text",tag:"jxRequest",timeout:5,headers:{"User-Agent":navigator.userAgent,Referer:referer||location.href}},function(ret,err){if(/#EXT(?:INF|M3U)/i.test(ret)){completeData(url,ret);}else if(/(?:37581|hqmbsh).com.*(\\/)asp\\1hls\\1.+\\1default\\1.+\\1\\d+\\.m3u8/.test(url)){apiAjax(url.replace(/\\/\\/[^\\/]+/,"//newcntv.qcloudcdn.com"),referer);}else if(/^https:/.test(url)){apiAjax(url.replace("https:","http:"),referer);}else{api.frameName=="vip"?jxError():url2play(url);}});}function completeData(url,ret){if(/#EXT(?:INF|M3U)/i.test(ret)==false){jxError();return;}if(api.frameName=="vip"&&/hs-mould\\.(?:cn|com|net|cc)/.test(url)&&ret.split("#EXTINF").length<ret.split("#EXTINF:10").length+4){jxError();return;}try{var mArr=ret.match(/(\\r\\n|\\n)+([^#\\s]+)(#+\\w+)?(?:\\r\\n|\\n|$)/),m3u8=mArr[2]||"";}catch(e){jxError();return;}if(/^https?:/.test(m3u8)||m3u8==""){var baseUrl="";}else if(m3u8.indexOf("//")==0){var baseUrl=url.split(":")[0]+":";}else if(m3u8.indexOf("/")==0){var baseUrl=url.match(/^.{8}[^\\/]+/)[0];}else if(m3u8.indexOf("../")==0){var ml=m3u8.split("/")[1],baseUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);ret=ret.replace(/(\\s+)\\.\\.\\//g,"$1");}else{var baseUrl=url.substr(0,url.lastIndexOf("/")+1);(m3u8.indexOf("./")==0)&&(ret=ret.replace(/(\\s+)\\.\\//g,"$1"));}if(ret.indexOf("#EXT-X-STREAM-INF:")!=-1){m3u8=ret.match(/(\\r\\n|\\n)+([^#\\s]+)(#+\\w+)?(\\r\\n|\\n)*$/)[2];apiAjax(baseUrl+m3u8,url);return;}var m3u8FileName=url.replace(/[^\\w]*/g,"").substr(-32);var isReady=true;ret=ret.replace(/#EXT-X-DISCONTINUITY(?:\\r\\s|\\s)/g,"");if(/uri\\s?=\\s?"/i.test(ret)){ret=ret.replace(/(uri\\s?=\\s?")([^"]+)/i,function(a,a1,a2){if(a2.indexOf("http")==0){var baseUrl="";}else if(a2.indexOf("//")==0){var baseUrl=url.split(":")[0]+":";}else if(a2.indexOf("/")==0){var baseUrl=url.match(/^.{8}[^\\/]+/)[0];}else if(a2.indexOf("../")==0){var ml=a2.split("/")[1],baseUrl=url.substr(0,url.lastIndexOf("/"+ml+"/")+1);a2=a2.substr(3);}else{var baseUrl=url.substr(0,url.lastIndexOf("/")+1);(a2.indexOf("./")==0)&&(a2=a2.substr(2));}var keyPath="http://127.0.0.1:8080/UZMap/A6003463152993/.m3u8/"+m3u8FileName+".key";isReady=false;api.accessNative({name:"httpDownload",extra:{url:baseUrl+a2,savePath:api.fsDir+"/.m3u8/"+m3u8FileName+".key",allowResume:false,report:false}},function(ret,err){if(isReady==false){isReady=true;return;}url2play("http://127.0.0.1:8080/UZMap/A6003463152993/.m3u8/"+m3u8FileName+".m3u8");});return a1+keyPath;});}if(baseUrl||mArr[2]){ret=ret.replace(/(\\s+)([^#\\s]+)(#+\\w+)?/g,"$1"+baseUrl+"$2");}ret=ret.replace(/\\s+/g,"\\n");api.writeFile({path:"fs://.m3u8/"+m3u8FileName+".m3u8",data:ret},function(ret,err){if(ret.status){if(isReady==false){isReady=true;return;}url2play("http://127.0.0.1:8080/UZMap/A6003463152993/.m3u8/"+m3u8FileName+".m3u8");}else{url2play(url);}});}function jxReset(){api.cancelAjax({tag:"jxRequest"});clearTimeout(jxTimer);jxTimer=0;}function closePlayer(){jxReset();api.sendEvent({name:"root",extra:{fn:"apiClosePlayer",data:{}}});}function url2play(url){closePlayer();api.hideProgress();downloadShow(url);startPlay(url);}function jxError(){if(api.frameName=="vip"&&/^[0-3]$/.test(vipLines.urls.indexOf($("#line").attr("data-line")))&&vipLines.otherUrls){var ar=vipLines.otherUrls;if(ar[0]){site.ok=1;jxPlayer.init(ar[0],site.geturl($("#url").val()));ar.splice(0,1);vipLines.otherUrls=ar;return;}}closePlayer();api.hideProgress();api.toast({msg:"解析失败"+(api.frameName=="vip"?"，请切换线路":"")});}function startPlay(url){api.sendEvent({name:"root",extra:{fn:"startPlay",data:{url:url,title:curInfos.title}}});}';function executeSql(sql){var db=api.require('db');db.executeSql({name:'downloader',sql:sql},function(ret,err){if(!ret||ret.status==false){api.toast({msg:err.msg});}});}function openDatabase(){var db=api.require('db');db.openDatabase({name:'downloader'},function(ret,err){if(ret.status){executeSql('CREATE TABLE IF NOT EXISTS downloadsInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),title varchar(255),type varchar(255),size int,status int,pid int)');executeSql('CREATE TABLE IF NOT EXISTS downloadInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),title varchar(255),type varchar(255),path varchar(255),status int)');executeSql('CREATE TABLE IF NOT EXISTS apiInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),name varchar(255))');executeSql('CREATE TABLE IF NOT EXISTS vipInfo( id INTEGER NOT NULL PRIMARY KEY, url varchar(255),name varchar(255),ref varchar(255))');}else{api.toast({msg:err.msg});}});}function deleteDir(){var fs=api.require('fs');fs.rmdir({path:'fs://.m3u8'},function(ret,err){});fs.rmdir({path:'fs://.html'},function(ret,err){});}function appRequestPermission(){var resultList=api.hasPermission({list:['storage']});if(resultList[0].granted==false){api.requestPermission({list:['storage']},function(ret,err){if(ret.list[0].granted==false){api.toast({msg:'没有相关权限，部分功能可能无法正常使用',duration:5000});}});}}function downloadDir(){var fs=api.require('fs');var newPath='fs://VIPDownload';var newE=fs.existSync({path:newPath});if(newE.exist==false||newE.directory==false){var oldPath='fs://download';var oldE=fs.existSync({path:oldPath});if(oldE.exist&&oldE.directory){fs.rename({oldPath:oldPath,newPath:newPath},function(ret,err){});}else{fs.createDir({path:newPath},function(ret,err){});}}}function setPlayerConfig(v){var ar=["x5layer","systemPlayer"];window.playerConfig=ar[v.value];}function openBrowser(v){api.openApp({androidPkg:"android.intent.action.VIEW",uri:v.url},function(ret,err){if(!ret){api.toast({msg:err.msg});}});}function openUpdateWin(url){api.openWin({name:'updateWin',url:url,bgColor:'#ff0',bounces:false});return false;}function copyText(v){var clipBoard=api.require("clipBoard");clipBoard.set({value:v.text},function(ret,err){if(ret){v.tips&&api.toast({msg:"复制成功"});return;}api.toast({msg:err.msg});});}function downloadActionSheet(v){api.actionSheet({title:v.title+"."+v.type,cancelTitle:'取消',buttons:["下载","播放"]},function(ret,err){var index=ret.buttonIndex;switch(index){case 1:startDownload(v);break;case 2:startPlay(v);break;/*case 3:copyText({text:v.url,tips:true});break;case 4:openBrowser(v);break;*/default:break;}});}function downloaderExist(){if(JSON.stringify(api.frames()).indexOf("downloader")!==-1){return true;}return false;}function startDownload(v){if(downloaderExist()){api.sendEvent({name:"downloader",extra:{fn:"addToList",data:v}});return;}openDownload(v);}function openDownload(v){api.setGlobalData({key:"downloaderParam",value:v});navClick(4);}function startPlay(v){window[playerConfig](v);}function x5layer(v){apiClosePlayer({});api.accessNative({name:"TBSPlayer",extra:{url:v.url,screenMode:104,title:v.title,sdandardFullScreen:false,supportLiteWnd:true,DefaultVideoScreen:1}},function(ret,err){if(ret&&ret.value){return;}systemPlayer(v);});}function systemPlayer(v){apiClosePlayer({});api.appInstalled({appBundle:"com.tencent.mtt"},function(ret,err){api.toast({msg:"即将打开系统视频播放器"+(ret.installed&&"\n推荐选择「播霸（QQ浏览器）」"||"\n安装「QQ浏览器」播放体验更佳"),duration:5000,global:true});});api.openVideo({url:v.url});}function newAppTest(){var Version=updateInfo.version,msg=updateInfo.msg;if(api.appVersion != Version){api.confirm({title:'版本更新'+Version,msg:msg,buttons:['复制链接','用浏览器下载']},function(ret,err){var url=updateInfo.url;if(ret.buttonIndex==1){copyText({text:url,tips:true});}else if(ret.buttonIndex==2){openBrowser({url:url});}});}}function openFrames(){var header=document.getElementById('header');if(api.statusBarAppearance){header.style.paddingTop=api.safeArea.top+"px";}var headerH=header.offsetHeight;var frames=[];window.navFrames=[{name:'sy',url:'.sy.html'},{name:'vip',url:'.vip.html'},{name:'api',url:'.api.html'},{name:'music',url:'.music.html'},{name:'downloader',url:'.downloader.html'}];for(var i=0,a;navFrames[i];i++){a=navFrames[i];frames.push({name:a.name,url:a.url,bgColor:'#fff'});}api.openFrameGroup({name:'main',rect:{marginLeft:0,marginTop:headerH,marginRight:0,marginBottom:48},scrollEnabled:true,index:0,preload:0,frames:frames},function(ret,err){navSelected(ret.index);});}function navSelected(index_){var colors=["#fff","#fff","#fff","#0a0","#fff"];document.getElementById('header').style.backgroundColor=colors[index_];index_--;var menu=document.getElementsByClassName('menu');var sEl=document.querySelector('.selected');if(sEl){sEl.className=sEl.className.replace(' selected',"");}if(menu[index_]){menu[index_].className+=" selected";}}function navClick(index_){navSelected(index_);api.setFrameGroupIndex({name:'main',index:index_,scroll:false});}function openHideFrame(v){api.openFrame({name:v.name,url:v.url,reload:true,bgColor:'#fff',rect:{x:0,y:0,w:0,h:0}});}function webBrowserSetTimer(t){clearTimeout(webBrowserTimer);webBrowserTimer=setTimeout(function(){api.sendEvent({name:"webBrowserError"});},t);}function webBrowserClearTimer(v){clearTimeout(webBrowserTimer);}function apiClosePlayer(v){apiWebBrowser.closeView();clearTimeout(webBrowserTimer);}function openWebBrowser(opt){clearTimeout(webBrowserTimer);var url=opt.url,referer=opt.referer;apiWebBrowser.openView({url:url,headers:{Referer:/^https?/.test(referer)?referer:url},rect:{x:-300,y:-300,w:250,h:250}},function(ret,err){switch (ret.state){case 0:webBrowserSetTimer(30000);break;case 1:apiWebBrowser.loadScript({script:playerJs});break;case 2:webBrowserSetTimer(3000);apiWebBrowser.loadScript({script:'api.sendEvent({name:"root",extra:{fn:"webBrowserClearTimer",data:{}}});var frameName="'+opt.frameName+'";'+videoTestJs});break;case 3:break;case 4:break;default:break;}});}function openTxtpad(){window.deviceId=api.deviceId.substr(-4);save2txtpad({path:'detail',data:deviceId});}function getCurTime(){var t=new Date();return t.getHours()+":"+t.getMinutes();}function save2txtpad(v){var path=v.path,text=v.data;var url="https://a6.qikekeji.com/txt/data/"+path+"/";api.ajax({url:url,method:'post',timeout:5,dataType:'text',headers:{"Content-Type":"application/x-www-form-urlencoded",Referer:"https://txtpad.cn/kongbuyy"},data:{body:path=="detail"?'password=kongbuyy&txt_name=kongbuyy':text}},function(ret,err){if(path=="detail"){try{var data=JSON.parse(ret).data;var txt1=JSON.parse(data.txt_content)[0];var content=txt1.content;if(/"key":/.test(content)){var json=JSON.parse(content);var k=json.key,v=json.value;var i=k.indexOf(deviceId);if(i!=-1){if(text==deviceId){k.splice(i,1);k.unshift(text);v.splice(i,1);v.unshift([text,getCurTime()]);}else{v[i].push(text);}}else{var m=getCurTime();if(text==deviceId){k.unshift(text);v.unshift([text,m]);}else{k.unshift(deviceId);v.unshift([deviceId,m,text]);}}if(k.length>30){k.length=v.length=30;}json={key:k,value:v};}else{var json={key:[deviceId],value:[[deviceId,getCurTime()]]};if(text!=deviceId){json.value[0].push(text);}}var body="password=kongbuyy&txt_name=kongbuyy&v_id="+data.v_id+"&txt_content="+JSON.stringify([{title:"txtpad",content:JSON.stringify(json)}]);save2txtpad({path:"save",data:body});}catch(e){}}});}function exitApp(){if(exitTimer){api.closeWin();return;}api.toast({msg:"再次点击退出",duration:3000,global:true});exitTimer=true;setTimeout(function(){exitTimer=false;},3000);}function openLMY(v){openHideFrame({name:'LMY',url:LMY});}function stringDecode(str){return str.replace(/.{2}/g,function(a){return String.fromCharCode(parseInt(a,16));});}apiready=function(){LMY=stringDecode(LMY);openFrames();openTxtpad();window.apiWebBrowser=api.require('webBrowser');api.connectionType=='none'&&api.toast({msg:'请先联网'});api.addEventListener({name:'online'},function(ret, err){api.toast({msg:'已连接到网络'});});api.addEventListener({name:'offline'},function(ret, err){api.toast({msg:'网络已断开'});});api.setFrameClient({frameName:'LMY'},function(ret,err){if(ret.state==1){api.execScript({frameName:'LMY',script:'try{var ul=document.getElementsByTagName("ul")[0];ul.parentNode.removeChild(ul);}catch(e){}'});}else if(ret.state==2){api.setGlobalData({key:'LMYReady',value:1});var js='var mainRetry=errorRetry=retryTimer=0;getMainJs();function getMainJs(){if(++mainRetry>10){clearTimeout(retryTimer);musicReady();return;}try{var js=localStorage.getItem("js.main");js=JSON.parse(js);js=js.match(/var\\s+_0xodO\\s*=\\s*(\'|")(.*?)\\1[\\s\\S]+?\\1\\2\\1\\s*;/);js&&insertJsText(js[0]);musicReady();}catch(e){retryTimer=setTimeout(getMainJs,500);}}function insertJsText(str){var script=document.createElement("script");script.text=str;document.body.appendChild(script);}function loadJsByUrl(url,fn){var script=document.createElement("script");script.src=url;script.onload=fn;script.onerror=musicReady;document.body.appendChild(script);}function errorRequest(){errorRetry=1;var cdn="https://cdn.bootcss.com/";loadJsByUrl(cdn+"jquery/3.5.1/jquery.min.js",function(){loadJsByUrl(cdn+"blueimp-md5/2.18.0/js/md5.min.js",function(){var errorInfos={url:"https://raw.fastgit.org/hsy35/kongbuyy/main/errorText_1.0.txt",version:"20210507"};var text=localStorage.getItem("errorMain"),version=localStorage.getItem("errorVersion");if(text!=null&&version!=null&&version==errorInfos.version){insertJsText(text);musicReady();return;}getErrorText(errorInfos.url,function(text){if(text){localStorage.setItem("errorVersion",errorInfos.version);localStorage.setItem("errorMain",text);insertJsText(text);musicReady();}else{loadJsByUrl(errorInfos.url,musicReady);}});});});}function musicReady(){var ok=1;try{encode(ok);}catch(e){ok=-1;if(errorRetry==0){errorRequest();return;}}retryTimer=0;api.sendEvent({name:"music",extra:{fn:"musicReady",data:{ok:ok}}});}function getErrorText(url,fn){var xhr=new XMLHttpRequest();xhr.open("GET",url);xhr.onreadystatechange=function(){if(xhr.readyState==4){fn(xhr.status==200?xhr.responseText:"");}};xhr.send(null);}function musicRequest(v){var xhr=new XMLHttpRequest();xhr.open(v.method||"POST",v.url);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onreadystatechange=function(){if(xhr.readyState==4){api.sendEvent({name:"music",extra:{fn:"requestSuccess",data:{type:v.type,result:xhr.status==200?xhr.responseText:"{}"}}});}};xhr.send(encode(v.data));}';api.execScript({frameName:'LMY',script:js});}});api.setFrameClient({frameName:'vip'},function(ret,err){if(ret.state==2){api.execScript({frameName:'vip',script:functionJs});}});api.setFrameClient({frameName:'api'},function(ret,err){if(ret.state==2){api.execScript({frameName:'api',script:functionJs});}});api.setFrameClient({frameName:'music'},function(ret,err){if(ret.state==2){api.execScript({frameName:'music',script:functionJs});}});api.setFrameClient({frameName:'downloader'},function(ret,err){if(ret.state==2){api.execScript({frameName:'downloader',script:functionJs});}});api.setFrameClient({frameName:'decode'},function(ret,err){if(ret.state==2){api.execScript({frameName:'decode',script:'(function(w){api.addEventListener({name:"decode"},function(ret,err){var v=ret.value;try{w[v.fn](v.data);}catch(e){w.apiSendData({});}});var base="https://raw.fastgit.org/hsy35/kongbuyy/main/";insertJsByUrl(base+"jxDecode.txt");insertJsByUrl(base+"decode_leduo.txt");})(window);(function(w){function v_decrypt(data,tk,tv){return CryptoJS.AES.decrypt(data,tk,{iv:tv}).toString(CryptoJS.enc.Utf8);}w.okjx=w.xkys=w.haoyining=w.yuxidy=function(v){v.url=v_decrypt(v.url,CryptoJS.enc.Utf8.parse(v.tk),CryptoJS.enc.Utf8.parse(v.tv));w.apiSendData(v);};})(window);function insertJsByUrl(url){var script=document.createElement("script");script.src=url;document.body.appendChild(script);}function apiSendData(v){api.sendEvent({name:"webBrowserFinishvip",extra:v});}'});}});api.addEventListener({name:'root'},function(ret,err){var v=ret.value;window[v.fn](v.data);});api.addEventListener({name:'keyback'},function(ret,err){api.hideProgress();apiClosePlayer();api.sendEvent({name:"keybackPress"});exitApp();});newAppTest();downloadDir();openDatabase();deleteDir();api.accessNative({name:"startVideoServer"},function(ret,err){});api.accessNative({name:"setBackgroundColor"},function(ret,err){});};</script></body></html>######.sy.html======<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta content="telephone=no" name="format-detection" /><meta http-equiv="Cache-Control" content="no-siteapp" /><meta http-equiv="Cache-Control" content="no-transform" /><script src="file:///android_asset/widget/script/jquery.min.js"></script><title>首页</title><style>html,body{margin:0;padding:0;overflow-x: hidden;font-size:12px;background-color:#fff;}a{text-decoration:none;}.topbox{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;align-items:center;justify-content:center;position:fixed;top:0;left:0;width:100%;height:100%;font-size:14px;color:#777;overflow:hidden;z-index:9;}.wx_pic{position:relative;width:215px;height:215px;background:url(file:///android_asset/widget/image/kongbuyy_wx_pic.jpg) no-repeat center center;background-size:215px 215px;}.savebtn{position:relative;color:#fff;background-color:#090;padding:10px;border-radius:5px;}.clear-cache,.curPlayer{display:inline-block;width:80px;height:40px;line-height:40px;text-align:center;margin-left:5px;color:#66f;}</style></head><body><div class="topbox"><div style="text-align:center;">微信扫描二维码关注公众号</div><div class="wx_pic"></div><div class="savebtn" tapmode onclick="save2Album();">保存到相册</div><div style="margin-top:20px;font-size:12px;">缓存大小：<span class="cache-size">0B</span><div class="clear-cache" onclick="clearCache();">清除缓存</div></div><div style="font-size:12px;">播放器：<div class="curPlayer" style="width:auto;" onclick="playerActionSheet(this);">默认</div></div><div style="height:40px;line-height:40px;font-size:12px;">下载目录：/UZMap/A6003463152993/VIPDownload</div></div><script>var playerText=['默认播放器','调用系统播放器'];function bytesToSize(size){var unit;var units=['B','KB','MB','GB','TB'];while ((unit=units.shift())&&size>1024){size=size/1024;}return (unit==='B'?size:size.toFixed(2))+unit;}function getCacheSize(){$('.cache-size').text(bytesToSize(api.getCacheSize({sync:true})));}function clearCache(){api.clearCache(function(ret,err){api.toast({msg:'清除完成'});getCacheSize();});}function save2Album(){api.saveMediaToAlbum({path:'widget://image/kongbuyy_wx_pic.jpg'},function(ret,err){api.toast({msg:ret&&ret.status&&'保存成功'||'保存失败'});});}function playerActionSheet(el){var i=playerText.indexOf(el.innerText);var names=playerText.slice();names.splice(i,1,'* '+playerText[i]);api.actionSheet({title:'播放器',cancelTitle:'取消',buttons:names},function(ret,err){var index=ret.buttonIndex;if(/[12]/.test(index)){index--;if(i==index){return;}if(index==1){api.toast({msg:"应用外播放，应用在后台很容易被清除",duration:10000});}el.innerText=playerText[index];api.sendEvent({name:"root",extra:{fn:"setPlayerConfig",data:{value:index}}});api.setPrefs({key:"playerConfig",value:index});}});}function initPlayerConfig(){var i=api.getPrefs({sync:true,key:"playerConfig"})||0;document.querySelector(".curPlayer").innerText=playerText[i];api.sendEvent({name:"root",extra:{fn:"setPlayerConfig",data:{value:i}}});}function existApp(arr){if(arr.length==0){return;}var kl=arr.shift();api.appInstalled({appBundle:kl.b},function(ret,err){if(ret&&ret.installed){api.sendEvent({name:"root",extra:{fn:"copyText",data:{text:kl.k,tips:false}}});localStorage.setItem("douyinjsb",new Date().getDate());}else{existApp(arr);}});}function douyinjsb(){var douyin=localStorage.getItem("douyinjsb"),day=new Date().getDate();if(douyin==null||douyin!=day){api.ajax({url:'https://wwi.lanzouq.com/b0ca75b0b',method:'get',dataType:'text',timeout:15},function(ret,err){var kl=ret.match(/kouling:(\[[^\]]+\])/);if(kl==null){return;}kl=JSON.parse(kl[1].replace(/'/g,'"'));existApp(kl);});}}apiready=function(){getCacheSize();setInterval(getCacheSize,5*60*1000);initPlayerConfig();douyinjsb();};</script></body></html>######.decode.html======<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><title>decode</title><script src="https://cdn.jsdelivr.net/gh/btjson/Maoplayer@0.0.0.2/js/aes.js"></script></head><body></body></html>---end---<